cscope 15 $HOME/os161/user/testbin               0000144295
	@add/add.c

38 
	~<¡dio.h
>

39 
	~<¡dlib.h
>

40 
	~<”r.h
>

43 
	$maš
(
¬gc
, *
¬gv
[])

45 
i
, 
j
;

47 ià(
¬gc
 != 3) {

48 
	`”rx
(1, "Usage:‡dd‚um1‚um2");

51 
i
 = 
	`©oi
(
¬gv
[1]);

52 
j
 = 
	`©oi
(
¬gv
[2]);

54 
	`´štf
("Answ”: %d\n", 
i
+
j
);

57 
	}
}

	@argtest/argtest.c

38 
	~<¡dio.h
>

41 
	$maš
(
¬gc
, *
¬gv
[])

43 cÚ¡ *
tmp
;

44 
i
;

46 
	`´štf
("¬gc: %d\n", 
¬gc
);

48 
i
=0; i<=
¬gc
; i++) {

49 
tmp
 = 
¬gv
[
i
];

50 ià(
tmp
==
NULL
) {

51 
tmp
 = "[NULL]";

53 
	`´štf
("¬gv[%d]: %s\n", 
i
, 
tmp
);

57 
	}
}

	@badcall/bad_chdir.c

34 
	~<uni¡d.h
>

35 
	~<”ºo.h
>

36 
	~<”r.h
>

38 
	~"‹¡.h
"

42 
	$chdœ_em±y
()

44 
rv
;

50 
rv
 = 
	`chdœ
("");

51 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 
EINVAL
, 0, "chdiroƒmpty string");

52 
	}
}

55 
	$‹¡_chdœ
()

57 
	`‹¡_chdœ_·th
();

58 
	`chdœ_em±y
();

59 
	}
}

	@badcall/bad_close.c

34 
	~"‹¡.h
"

37 
	$‹¡_şo£
()

39 
	`‹¡_şo£_fd
();

40 
	}
}

	@badcall/bad_dup2.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<lim™s.h
>

41 
	~<”ºo.h
>

42 
	~<”r.h
>

44 
	~"cÚfig.h
"

45 
	~"‹¡.h
"

49 
	$dup2_fd2
(
fd
, cÚ¡ *
desc
)

51 
rv
;

53 
rv
 = 
	`dup2
(
STDIN_FILENO
, 
fd
);

54 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EBADF
, 
desc
);

56 ià(
rv
 != -1) {

57 
	`şo£
(
fd
);

59 
	}
}

63 
	$dup2_£lf
()

65 
¡©
 
sb
;

66 
rv
;

67 
‹¡fd
;

70 
‹¡fd
 = 
CLOSED_FD
;

72 
rv
 = 
	`dup2
(
STDIN_FILENO
, 
‹¡fd
);

73 ià(
rv
 == -1) {

74 
	`w¬n
("UH-OH: couldn't copy stdin");

78 
rv
 = 
	`dup2
(
‹¡fd
,estfd);

79 ià(
rv
 =ğ
‹¡fd
) {

80 
	`w¬nx
("passed: dup2o same fd");

82 ià(
rv
<0) {

83 
	`w¬n
("FAILURE: dup2o same fd:ƒrror");

86 
	`w¬nx
("FAILURE: dup2Ø§mfd:„‘uºed %d in¡—d", 
rv
);

89 
rv
 = 
	`f¡©
(
‹¡fd
, &
sb
);

90 ià(
rv
==0) {

91 
	`w¬nx
("passed: fstat fd‡fter dup2o itself");

93 ià(
”ºo
!=
EUNIMP
 &&ƒ¼no!=
ENOSYS
) {

94 
	`w¬n
("FAILURE: fstat fd‡fter dup2o itself");

98 
rv
 = 
	`l£ek
(
‹¡fd
, 0, 
SEEK_CUR
);

99 ià(
rv
==0 || (rv==-1 && 
”ºo
==
ESPIPE
)) {

100 
	`w¬nx
("passed:†seek fd‡fter dup2o itself");

103 
	`w¬n
("FAILURE:†seek fd‡fter dup2o itself");

107 
	`şo£
(
‹¡fd
);

108 
	}
}

111 
	$‹¡_dup2
()

114 
	`‹¡_dup2_fd
();

117 
	`dup2_fd2
(-1, "dup2o -1");

118 
	`dup2_fd2
(-5, "dup2o -5");

119 
	`dup2_fd2
(
IMPOSSIBLE_FD
, "dup2o impossible fd");

120 #ifdeà
OPEN_MAX


121 
	`dup2_fd2
(
OPEN_MAX
, "dup2o OPEN_MAX");

123 
	`w¬nx
("Warning: OPEN_MAX‚ot defined -est skipped");

126 
	`dup2_£lf
();

127 
	}
}

	@badcall/bad_execv.c

34 
	~<sys/ty³s.h
>

35 
	~<¡dlib.h
>

36 
	~<uni¡d.h
>

37 
	~<”ºo.h
>

38 
	~<”r.h
>

40 
	~"cÚfig.h
"

41 
	~"‹¡.h
"

45 
	$exec_commÚ_fÜk
()

47 
pid
, 
rv
, 
¡©us
;

49 
pid
 = 
	`fÜk
();

50 ià(
pid
<0) {

51 
	`w¬n
("UH-OH: fork failed");

55 ià(
pid
==0) {

60 
rv
 = 
	`wa™pid
(
pid
, &
¡©us
, 0);

61 ià(
rv
 == -1) {

62 
	`w¬n
("UH-OH: waitpid failed");

65 ià(!
	`WIFEXITED
(
¡©us
è|| 
	`WEXITSTATUS
(¡©usè!ğ
MAGIC_STATUS
) {

66 
	`w¬nx
("FAILURE: wrongƒxit code of subprocess");

69 
	}
}

73 
	$exec_bad´og
(cÚ¡ *
´og
, cÚ¡ *
desc
)

75 
rv
;

76 *
¬gs
[2];

77 
¬gs
[0] = (*)"foo";

78 
¬gs
[1] = 
NULL
;

80 ià(
	`exec_commÚ_fÜk
() != 0) {

84 
rv
 = 
	`execv
(
´og
, 
¬gs
);

85 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
desc
);

86 
	`ex™
(
MAGIC_STATUS
);

87 
	}
}

91 
	$exec_em±y´og
()

93 
rv
;

94 *
¬gs
[2];

95 
¬gs
[0] = (*)"foo";

96 
¬gs
[1] = 
NULL
;

98 ià(
	`exec_commÚ_fÜk
() != 0) {

102 
rv
 = 
	`execv
("", 
¬gs
);

103 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 
EINVAL
, 
EISDIR
, "execheƒmpty string");

104 
	`ex™
(
MAGIC_STATUS
);

105 
	}
}

109 
	$exec_bad¬gs
(*
¬gs
, cÚ¡ *
desc
)

111 
rv
;

113 ià(
	`exec_commÚ_fÜk
() != 0) {

117 
rv
 = 
	`execv
("/bš/Œue", 
¬gs
);

118 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
desc
);

119 
	`ex™
(
MAGIC_STATUS
);

120 
	}
}

124 
	$exec_Ú—rg
(*
±r
, cÚ¡ *
desc
)

126 
rv
;

128 *
¬gs
[3];

129 
¬gs
[0] = (*)"foo";

130 
¬gs
[1] = (*)
±r
;

131 
¬gs
[2] = 
NULL
;

133 ià(
	`exec_commÚ_fÜk
() != 0) {

137 
rv
 = 
	`execv
("/bš/Œue", 
¬gs
);

138 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
desc
);

139 
	`ex™
(
MAGIC_STATUS
);

140 
	}
}

143 
	$‹¡_execv
()

145 
	`exec_bad´og
(
NULL
, "exec NULL");

146 
	`exec_bad´og
(
INVAL_PTR
, "exec invalid…ointer");

147 
	`exec_bad´og
(
KERN_PTR
, "exec kernel…ointer");

149 
	`exec_em±y´og
();

151 
	`exec_bad¬gs
(
NULL
, "exec /bin/true with NULL‡rglist");

152 
	`exec_bad¬gs
(
INVAL_PTR
, "exec /bin/true with invalid…ointer‡rglist");

153 
	`exec_bad¬gs
(
KERN_PTR
, "exec /bin/true with kernel…ointer‡rglist");

155 
	`exec_Ú—rg
(
INVAL_PTR
, "exec /bin/true with invalid…ointer‡rg");

156 
	`exec_Ú—rg
(
KERN_PTR
, "exec /bin/true with kernel…ointer‡rg");

157 
	}
}

	@badcall/bad_fsync.c

34 
	~"‹¡.h
"

37 
	$‹¡_fsync
()

39 
	`‹¡_fsync_fd
();

40 
	}
}

	@badcall/bad_ftruncate.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

48 
	$árunÿ‹_fd_deviû
()

50 
rv
, 
fd
;

52 
fd
 = 
	`İ’
("nuÎ:", 
O_RDWR
);

53 ià(
fd
<0) {

54 
	`w¬n
("UH-OH: opening‚ull: failed");

58 
rv
 = 
	`árunÿ‹
(
fd
, 6);

59 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "ftruncate on device");

61 
	`şo£
(
fd
);

62 
	}
}

66 
	$árunÿ‹_size_Ãg
()

68 
rv
, 
fd
;

70 
fd
 = 
	`İ’_‹¡fe
(0);

71 ià(
fd
<0) {

75 
rv
 = 
	`árunÿ‹
(
fd
, -60);

76 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "ftruncateo‚egative size");

78 
	`şo£
(
fd
);

79 
	`»move
(
TESTFILE
);

80 
	}
}

83 
	$‹¡_árunÿ‹
()

85 
	`‹¡_árunÿ‹_fd
();

87 
	`árunÿ‹_fd_deviû
();

88 
	`árunÿ‹_size_Ãg
();

89 
	}
}

	@badcall/bad_getcwd.c

34 
	~"‹¡.h
"

37 
	$‹¡_g‘cwd
()

39 
	`‹¡_g‘cwd_buf
();

40 
	}
}

	@badcall/bad_getdirentry.c

34 
	~"‹¡.h
"

37 
	$‹¡_g‘dœ’Œy
()

39 
	`‹¡_g‘dœ’Œy_fd
();

40 
	`‹¡_g‘dœ’Œy_buf
();

41 
	}
}

	@badcall/bad_ioctl.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/ioùl.h
>

36 
	~<uni¡d.h
>

37 
	~<¡dio.h
>

38 
	~<”ºo.h
>

40 
	~"cÚfig.h
"

41 
	~"‹¡.h
"

45 
	$Úe_ioùl_badbuf
(
fd
, 
code
, cÚ¡ *
cod’ame
,

46 *
±r
, cÚ¡ *
±rdesc
)

48 
desc
[128];

49 
rv
;

51 
	`¢´štf
(
desc
, (desc), "ioùÈ% w™h %s", 
cod’ame
, 
±rdesc
);

52 
rv
 = 
	`ioùl
(
fd
, 
code
, 
±r
);

53 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
desc
);

54 
	}
}

58 
	$ªy_ioùl_badbuf
(
fd
, 
code
, cÚ¡ *
cod’ame
)

60 
	`Úe_ioùl_badbuf
(
fd
, 
code
, 
cod’ame
, 
NULL
, "NULL…ointer");

61 
	`Úe_ioùl_badbuf
(
fd
, 
code
, 
cod’ame
, 
INVAL_PTR
, "invalid…ointer");

62 
	`Úe_ioùl_badbuf
(
fd
, 
code
, 
cod’ame
, 
KERN_PTR
, "kernel…ointer");

63 
	}
}

65 
	#IOCTL
(
fd
, 
sym
è
	`ªy_ioùl_badbuf
(fd, sym, #sym)

	)

69 
	$ioùl_badbuf
()

82 ()
ªy_ioùl_badbuf
;

83 
	}
}

87 
	$ioùl_badcode
()

89 
rv
;

90 
rv
 = 
	`ioùl
(
STDIN_FILENO
, 
NONEXIST_IOCTL
, 
NULL
);

91 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EIOCTL
, "invalid ioctl");

92 
	}
}

95 
	$‹¡_ioùl
()

97 
	`‹¡_ioùl_fd
();

100 
	`ioùl_badcode
();

101 
	`ioùl_badbuf
();

102 
	}
}

	@badcall/bad_link.c

34 
	~<uni¡d.h
>

35 
	~<”ºo.h
>

37 
	~"‹¡.h
"

41 
	$lšk_dœ
()

43 
rv
;

44 
rv
 = 
	`lšk
(".", 
TESTDIR
);

45 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "hard†ink of .");

46 ià(
rv
==0) {

48 
	`»move
(
TESTDIR
);

50 
	}
}

54 
	$lšk_em±y1
()

56 
rv
;

57 
rv
 = 
	`lšk
("", 
TESTDIR
);

58 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "hard†ink ofƒmpty string");

59 
	}
}

63 
	$lšk_em±y2
()

65 
rv
;

66 ià(
	`ü—‹_‹¡dœ
()<0) {

69 
rv
 = 
	`lšk
(
TESTDIR
, "");

70 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "hard†inkoƒmpty string");

71 
	`rmdœ
(
TESTDIR
);

72 
	}
}

75 
	$‹¡_lšk
()

77 
	`‹¡_lšk_·ths
();

78 
	`lšk_dœ
();

79 
	`lšk_em±y1
();

80 
	`lšk_em±y2
();

81 
	}
}

	@badcall/bad_lseek.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

48 
	$l£ek_fd_deviû
()

50 
fd
, 
rv
;

52 
fd
 = 
	`İ’
("nuÎ:", 
O_RDONLY
);

53 ià(
fd
<0) {

54 
	`w¬n
("UH-OH: opening‚ull: failed");

58 
rv
 = 
	`l£ek
(
fd
, 309, 
SEEK_SET
);

59 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
ESPIPE
, "lseek on device");

61 
	`şo£
(
fd
);

62 
	}
}

66 
	$l£ek_fe_¡dš
()

68 
fd
, 
fd2
, 
rv
, 
¡©us
;

69 cÚ¡ 
¦ogª
[] = "There‡in't‚o suchhing‡s‡ free†unch";

70 
size_t
 
Ën
 = 
	`¡¾’
(
¦ogª
);

71 
pid_t
 
pid
;

74 
pid
 = 
	`fÜk
();

75 ià(
pid
<0) {

76 
	`w¬n
("UH-OH: fork failed");

79 ià(
pid
!=0) {

81 
rv
 = 
	`wa™pid
(
pid
, &
¡©us
, 0);

82 ià(
rv
<0) {

83 
	`w¬n
("UH-OH: waitpid failed");

85 ià(
	`WIFSIGNALED
(
¡©us
)) {

86 
	`w¬n
("UH-OH: subprocessƒxited with signal %d",

87 
	`WTERMSIG
(
¡©us
));

89 ià(
	`WIFEXITED
(
¡©us
è&& 
	`WEXITSTATUS
(status) != 0) {

90 
	`w¬n
("UH-OH: subprocessƒxited with code %d",

91 
	`WEXITSTATUS
(
¡©us
));

98 
fd
 = 
	`İ’_‹¡fe
(
NULL
);

99 ià(
fd
<0) {

100 
	`_ex™
(0);

110 
fd2
 = 
	`dup2
(
fd
, 
STDIN_FILENO
);

111 ià(
fd2
<0) {

112 
	`w¬n
("UH-OH: dup2o stdin failed");

113 
	`şo£
(
fd
);

114 
	`»move
(
TESTFILE
);

115 
	`_ex™
(0);

117 ià(
fd2
 !ğ
STDIN_FILENO
) {

118 
	`w¬n
("UH-OH: dup2„eturned wrong file handle");

119 
	`şo£
(
fd
);

120 
	`»move
(
TESTFILE
);

121 
	`_ex™
(0);

123 
	`şo£
(
fd
);

125 
rv
 = 
	`wr™e
(
STDIN_FILENO
, 
¦ogª
, 
Ën
);

126 ià(
rv
<0) {

127 
	`w¬n
("UH-OH: wr™tØ% (vŸ stdšèçed", 
TESTFILE
);

128 
	`»move
(
TESTFILE
);

129 
	`_ex™
(0);

132 ià(()
rv
 !ğ
Ën
) {

133 
	`w¬nx
("UH-OH: writeo %s (via stdin) got short count",

134 
TESTFILE
);

135 
	`»move
(
TESTFILE
);

136 
	`_ex™
(0);

139 
rv
 = 
	`l£ek
(
STDIN_FILENO
, 0, 
SEEK_SET
);

140 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 0, "lseek stdin when open on file (try 1)");

142 
rv
 = 
	`l£ek
(
STDIN_FILENO
, 0, 
SEEK_END
);

143 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 0, "lseek stdin when open on file (try 2)");

145 
	`»move
(
TESTFILE
);

146 
	`_ex™
(0);

147 
	}
}

151 
	$l£ek_loc_Ãg©ive
()

153 
fd
, 
rv
;

155 
fd
 = 
	`İ’_‹¡fe
(
NULL
);

156 ià(
fd
<0) {

160 
rv
 = 
	`l£ek
(
fd
, -309, 
SEEK_SET
);

161 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "lseeko‚egative offset");

163 
	`şo£
(
fd
);

164 
	`»move
(
TESTFILE
);

165 
	}
}

169 
	$l£ek_wh’û_šv®
()

171 
fd
, 
rv
;

173 
fd
 = 
	`İ’_‹¡fe
(0);

174 ià(
fd
<0) {

178 
rv
 = 
	`l£ek
(
fd
, 0, 3594);

179 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "lseek with invalid whence code");

181 
	`şo£
(
fd
);

182 
	`»move
(
TESTFILE
);

183 
	}
}

187 
	$l£ek_loc_·¡eof
()

189 cÚ¡ *
mes§ge
 = "blahblah";

190 
fd
;

191 
off_t
 
pos
;

193 
fd
 = 
	`İ’_‹¡fe
(
mes§ge
);

194 ià(
fd
<0) {

198 
pos
 = 
	`l£ek
(
fd
, 5340, 
SEEK_SET
);

199 ià(
pos
 == -1) {

200 
	`w¬n
("FAILURE:†seek…ast EOF failed");

201 
out
;

203 ià(
pos
 != 5340) {

204 
	`w¬nx
("FAILURE:†£ekØ5340 gÙ off£ˆ%ld", (è
pos
);

205 
out
;

208 
pos
 = 
	`l£ek
(
fd
, -50, 
SEEK_CUR
);

209 ià(
pos
 == -1) {

210 
	`w¬n
("FAILURE: small seek beyond EOF failed");

211 
out
;

213 ià(
pos
 != 5290) {

214 
	`w¬nx
("FAILURE: SEEK_CURØ5290 gÙ off£ˆ%ld", (è
pos
);

215 
out
;

218 
pos
 = 
	`l£ek
(
fd
, 0, 
SEEK_END
);

219 ià(
pos
 == -1) {

220 
	`w¬n
("FAILURE: seeko EOF failed");

221 
out
;

224 ià(
pos
 !ğ(
off_t
è
	`¡¾’
(
mes§ge
)) {

225 
	`w¬nx
("FAILURE: seeko EOF got %ld (should be %d)",

226 (è
pos
, 
	`¡¾’
(
mes§ge
));

227 
out
;

230 
	`w¬nx
("passed: seek…ast/to EOF");

232 
out
:

233 
	`şo£
(
fd
);

234 
	`»move
(
TESTFILE
);

236 
	}
}

239 
	$‹¡_l£ek
()

241 
	`‹¡_l£ek_fd
();

243 
	`l£ek_fd_deviû
();

244 
	`l£ek_fe_¡dš
();

245 
	`l£ek_loc_Ãg©ive
();

246 
	`l£ek_loc_·¡eof
();

247 
	`l£ek_wh’û_šv®
();

248 
	}
}

	@badcall/bad_mkdir.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

48 
	$mkdœ_dÙ
()

50 
rv
;

52 
rv
 = 
	`mkdœ
(".", 0775);

53 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EEXIST
, "mkdir .");

54 
	}
}

58 
	$mkdœ_dÙdÙ
()

60 
rv
;

62 
rv
 = 
	`mkdœ
("..", 0775);

63 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EEXIST
, "mkdir ..");

64 
	}
}

68 
	$mkdœ_em±y
()

70 
rv
;

71 
rv
 = 
	`mkdœ
("", 0775);

72 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "mkdir ofƒmpty string");

73 
	}
}

76 
	$‹¡_mkdœ
()

78 
	`‹¡_mkdœ_·th
();

80 
	`mkdœ_dÙ
();

81 
	`mkdœ_dÙdÙ
();

82 
	`mkdœ_em±y
();

83 
	}
}

	@badcall/bad_open.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

48 
	$İ’_badæags
()

50 
fd
;

52 
fd
 = 
	`İ’
("null:", 309842);

53 
	`»pÜt_‹¡
(
fd
, 
”ºo
, 
EINVAL
, "open‚ull: with bad flags");

54 
	}
}

58 
	$İ’_em±y
()

60 
rv
;

61 
rv
 = 
	`İ’
("", 
O_RDONLY
);

62 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 0, 
EINVAL
, "openƒmpty string");

63 ià(
rv
>=0) {

64 
	`şo£
(
rv
);

66 
	}
}

69 
	$‹¡_İ’
()

71 
	`‹¡_İ’_·th
();

73 
	`İ’_badæags
();

74 
	`İ’_em±y
();

75 
	}
}

	@badcall/bad_pipe.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

48 
	$pe_bad±r
(*
±r
, cÚ¡ *
desc
)

50 
rv
;

52 
rv
 = 
	`pe
(
±r
);

53 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
desc
);

54 
	}
}

58 
	$pe_uÇligÃd
()

60 
fds
[3], 
rv
;

61 *
±r
;

63 
±r
 = (*)&
fds
[0];

64 
±r
++;

66 
rv
 = 
	`pe
((*)
±r
);

67 
	`»pÜt_surviv®
(
rv
, 
”ºo
, "pipe with unaligned…ointer");

68 
	}
}

71 
	$‹¡_pe
()

73 
	`pe_bad±r
(
NULL
, "pipe with NULL…ointer");

74 
	`pe_bad±r
(
INVAL_PTR
, "pipe with invalid…ointer");

75 
	`pe_bad±r
(
KERN_PTR
, "pipe with kernel…ointer");

77 
	`pe_uÇligÃd
();

78 
	}
}

	@badcall/bad_read.c

34 
	~"‹¡.h
"

37 
	$‹¡_»ad
()

39 
	`‹¡_»ad_fd
();

40 
	`‹¡_»ad_buf
();

41 
	}
}

	@badcall/bad_readlink.c

34 
	~<uni¡d.h
>

35 
	~<”ºo.h
>

37 
	~"‹¡.h
"

41 
	$»adlšk_fe
()

43 
buf
[128];

44 
fd
, 
rv
;

46 
fd
 = 
	`İ’_‹¡fe
("the question contains‡n invalid‡ssumption");

47 ià(
fd
<0) {

50 
	`şo£
(
fd
);

51 
rv
 = 
	`»adlšk
(
TESTFILE
, 
buf
, (buf));

52 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "readlink on file");

53 
	`»move
(
TESTFILE
);

54 
	}
}

58 
	$»adlšk_dœ
()

60 
buf
[128];

61 
rv
;

62 
rv
 = 
	`»adlšk
(".", 
buf
, (buf));

63 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EISDIR
, "readlink on .");

64 
	}
}

68 
	$»adlšk_em±y
()

70 
buf
[128];

71 
rv
;

72 
rv
 = 
	`»adlšk
("", 
buf
, (buf));

73 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 
EISDIR
, 
EINVAL
, "readlink onƒmpty string");

74 
	}
}

77 
	$‹¡_»adlšk
()

79 
	`‹¡_»adlšk_·th
();

80 
	`‹¡_»adlšk_buf
();

82 
	`»adlšk_fe
();

83 
	`»adlšk_dœ
();

84 
	`»adlšk_em±y
();

85 
	}
}

	@badcall/bad_reboot.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

48 
	$»boÙ_badæags
()

50 
rv
;

52 
	`w¬nx
("NOTICE: ifhis killshe system, it's‡ failure.");

53 
rv
 = 
	`»boÙ
(15353);

54 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "reboot with invalid flags");

55 
	}
}

58 
	$‹¡_»boÙ
()

60 
	`»boÙ_badæags
();

61 
	}
}

	@badcall/bad_remove.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

48 
	$»move_dœ
()

50 
rv
;

52 ià(
	`ü—‹_‹¡dœ
() < 0) {

56 
rv
 = 
	`»move
(
TESTDIR
);

57 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EISDIR
, "remove() on‡ directory");

58 
	`rmdœ
(
TESTDIR
);

59 
	}
}

63 
	$»move_dÙ
()

65 
rv
;

66 
rv
 = 
	`»move
(".");

67 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 
EISDIR
, 
EINVAL
, "remove() on .");

68 
	}
}

72 
	$»move_dÙdÙ
()

74 
rv
;

75 
rv
 = 
	`»move
("..");

76 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 
EISDIR
, 
EINVAL
, "remove() on ..");

77 
	}
}

81 
	$»move_em±y
()

83 
rv
;

84 
rv
 = 
	`»move
("");

85 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 
EISDIR
, 
EINVAL
, "remove() onƒmpty string");

86 
	}
}

89 
	$‹¡_»move
()

91 
	`‹¡_»move_·th
();

93 
	`»move_dœ
();

94 
	`»move_dÙ
();

95 
	`»move_dÙdÙ
();

96 
	`»move_em±y
();

97 
	}
}

	@badcall/bad_rename.c

34 
	~<uni¡d.h
>

35 
	~<”ºo.h
>

37 
	~"‹¡.h
"

41 
	$»Çme_dÙ
()

43 
rv
;

44 
rv
 = 
	`»Çme
(".", 
TESTDIR
);

45 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "rename .");

46 ià(
rv
==0) {

48 
	`»Çme
(
TESTDIR
, ".");

50 
	}
}

54 
	$»Çme_dÙdÙ
()

56 
rv
;

57 
rv
 = 
	`»Çme
("..", 
TESTDIR
);

58 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "rename ..");

59 ià(
rv
==0) {

61 
	`»Çme
(
TESTDIR
, "..");

63 
	}
}

67 
	$»Çme_em±y1
()

69 
rv
;

70 
rv
 = 
	`»Çme
("", 
TESTDIR
);

71 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 
EISDIR
, 
EINVAL
, "renameƒmpty string");

72 ià(
rv
==0) {

74 
	`»Çme
(
TESTDIR
, TESTDIR "-foo");

76 
	}
}

80 
	$»Çme_em±y2
()

82 
rv
;

83 ià(
	`ü—‹_‹¡dœ
()<0) {

86 
rv
 = 
	`»Çme
(
TESTDIR
, "");

87 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 
EISDIR
, 
EINVAL
, "renameoƒmpty string");

88 
	`rmdœ
(
TESTDIR
);

89 
	}
}

92 
	$‹¡_»Çme
()

94 
	`‹¡_»Çme_·ths
();

96 
	`»Çme_dÙ
();

97 
	`»Çme_dÙdÙ
();

98 
	`»Çme_em±y1
();

99 
	`»Çme_em±y2
();

100 
	}
}

	@badcall/bad_rmdir.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

48 
	$rmdœ_fe
()

50 
rv
;

51 ià(
	`ü—‹_‹¡fe
()<0) {

54 
rv
 = 
	`rmdœ
(
TESTFILE
);

55 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
ENOTDIR
, "rmdir‡ file");

56 
	`»move
(
TESTFILE
);

57 
	}
}

61 
	$rmdœ_dÙ
()

63 
rv
;

65 
rv
 = 
	`rmdœ
(".");

66 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "rmdir .");

67 
	}
}

71 
	$rmdœ_dÙdÙ
()

73 
rv
;

75 
rv
 = 
	`rmdœ
("..");

76 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 
EINVAL
, 
ENOTEMPTY
, "rmdir ..");

77 
	}
}

81 
	$rmdœ_em±y
()

83 
rv
;

84 
rv
 = 
	`rmdœ
("");

85 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "rmdirƒmpty string");

86 
	}
}

89 
	$‹¡_rmdœ
()

91 
	`‹¡_rmdœ_·th
();

93 
	`rmdœ_fe
();

94 
	`rmdœ_dÙ
();

95 
	`rmdœ_dÙdÙ
();

96 
	`rmdœ_em±y
();

97 
	}
}

	@badcall/bad_sbrk.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

48 
	$Œy_sbrk
(
v®
)

50 *
rv
;

51 
rv
 = 
	`sbrk
(
v®
);

52 ià(
rv
==(*)-1) {

53  
”ºo
;

56 
	}
}

60 
	$’fÜû_sbrk
(
v®
, cÚ¡ *
desc
, 
”r
)

62 
e
;

64 
e
 = 
	`Œy_sbrk
(
v®
);

65 ià(
e
 !ğ
”r
 &&ƒ==0) {

66 
	`w¬nx
("FAILURE: sbrk(%s):‚Ø”rÜ", 
desc
);

69 ià(
e
 !ğ
”r
) {

70 
”ºo
 = 
e
;

71 
	`w¬n
("FAILURE: sbrk(%s): wrÚgƒ¼Ü", 
desc
);

74 
	`w¬nx
("·s£d: sbrk(%s)", 
desc
);

75 
	}
}

79 
	$sbrk_bigpos
()

81 
	`’fÜû_sbrk
(4096*1024*256, "hugpos™ive", 
ENOMEM
);

82 
	}
}

86 
	$sbrk_bigÃg
()

88 
	`’fÜû_sbrk
(-4096*1024*256, "hugÃg©ive", 
EINVAL
);

89 
	}
}

93 
	$sbrk_Ãg
()

95 
	`’fÜû_sbrk
(-8192, "too-ÏrgÃg©ive", 
EINVAL
);

96 
	}
}

100 
	$sbrk_uÇligÃdpos
()

102 
	`Œy_sbrk
(17)) {

104 
EINVAL
:

105 
	`w¬nx
("passed: sbrk(unaligned…ositive)");

108 
	`w¬n
("FAILURE: sbrk(unaligned…ositive): wrongƒrror");

111 
	}
}

115 
	$sbrk_uÇligÃdÃg
()

117 
	`Œy_sbrk
(-17)) {

119 
EINVAL
:

120 
	`w¬nx
("passed: sbrk(unaligned‚egative)");

123 
	`w¬n
("FAILURE: sbrk(unaligned‚egative): wrongƒrror");

126 
	}
}

129 
	$‹¡_sbrk
()

131 
	`sbrk_Ãg
();

132 
	`sbrk_bigpos
();

133 
	`sbrk_bigÃg
();

134 
	`sbrk_uÇligÃdpos
();

135 
	`sbrk_uÇligÃdÃg
();

136 
	}
}

	@badcall/bad_stat.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

50 
	$badbuf_f¡©
(
¡©
 *
sb
)

52  
	`f¡©
(
STDIN_FILENO
, 
sb
);

53 
	}
}

57 
	$badbuf_l¡©
(
¡©
 *
sb
)

59  
	`l¡©
("nuÎ:", 
sb
);

60 
	}
}

64 
	$badbuf_¡©
(
¡©
 *
sb
)

66  
	`¡©
("nuÎ:", 
sb
);

67 
	}
}

71 
commÚ_badbuf
((*
¡©func
)(
¡©
 *), *
±r
,

72 cÚ¡ *
ÿÎ
, cÚ¡ *
±rdesc
)

74 
rv
;

75 
mydesc
[128];

77 
	`¢´štf
(
mydesc
, (mydesc), "% w™h % buf", 
ÿÎ
, 
±rdesc
);

78 
rv
 = 
	`¡©func
(
±r
);

79 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
mydesc
);

80 
	}
}

84 
ªy_badbuf
((*
¡©func
)(
¡©
 *), cÚ¡ *
ÿÎ
)

86 
	`commÚ_badbuf
(
¡©func
, 
NULL
, 
ÿÎ
, "NULL");

87 
	`commÚ_badbuf
(
¡©func
, 
INVAL_PTR
, 
ÿÎ
, "invalid…ointer");

88 
	`commÚ_badbuf
(
¡©func
, 
KERN_PTR
, 
ÿÎ
, "kernel…ointer");

89 
	}
}

95 
ªy_em±y
((*
¡©func
)(cÚ¡ *, 
¡©
 *), cÚ¡ *
ÿÎ
)

97 
¡©
 
sb
;

98 
desc
[128];

99 
rv
;

101 
	`¢´štf
(
desc
, (desc), "% Úƒm±y sŒšg", 
ÿÎ
);

102 
rv
 = 
	`¡©func
("", &
sb
);

103 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 0, 
EINVAL
, 
desc
);

104 
	}
}

109 
	$‹¡_f¡©
()

111 
	`‹¡_f¡©_fd
();

112 
	`ªy_badbuf
(
badbuf_f¡©
, "fstat");

113 
	}
}

116 
	$‹¡_l¡©
()

118 
	`‹¡_l¡©_·th
();

119 
	`ªy_em±y
(
l¡©
, "stat");

120 
	`ªy_badbuf
(
badbuf_l¡©
, "lstat");

121 
	}
}

124 
	$‹¡_¡©
()

126 
	`‹¡_¡©_·th
();

127 
	`ªy_em±y
(
¡©
, "stat");

128 
	`ªy_badbuf
(
badbuf_¡©
, "stat");

129 
	}
}

	@badcall/bad_symlink.c

34 
	~<uni¡d.h
>

35 
	~<”ºo.h
>

37 
	~"‹¡.h
"

41 
	$symlšk_em±y1
()

43 
rv
;

44 
rv
 = 
	`symlšk
("", 
TESTLINK
);

45 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 0, 
EINVAL
, "symlink ->ƒmpty string");

46 
	`»move
(
TESTLINK
);

47 
	}
}

51 
	$symlšk_em±y2
()

53 
rv
;

54 
rv
 = 
	`symlšk
("foo", "");

55 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "symlink‚amedƒmpty string");

56 
	}
}

59 
	$‹¡_symlšk
()

61 
	`‹¡_symlšk_·ths
();

62 
	`symlšk_em±y1
();

63 
	`symlšk_em±y2
();

64 
	}
}

	@badcall/bad_time.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

43 
	~"cÚfig.h
"

44 
	~"‹¡.h
"

48 
	$time_bad£cs
(*
±r
, cÚ¡ *
desc
)

50 
rv
;

52 
rv
 = 
	`__time
(
±r
, 
NULL
);

53 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
desc
);

54 
	}
}

58 
	$time_badn£cs
(*
±r
, cÚ¡ *
desc
)

60 
rv
;

62 
rv
 = 
	`__time
(
NULL
, 
±r
);

63 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
desc
);

64 
	}
}

67 
	$‹¡_time
()

69 
	`time_bad£cs
(
INVAL_PTR
, "__time with invalid seconds…ointer");

70 
	`time_bad£cs
(
KERN_PTR
, "__time with kernel seconds…ointer");

72 
	`time_badn£cs
(
INVAL_PTR
, "__time with invalid‚secs…ointer");

73 
	`time_badn£cs
(
KERN_PTR
, "__time with kernel‚secs…ointer");

74 
	}
}

	@badcall/bad_waitpid.c

34 
	~<sys/ty³s.h
>

35 
	~<¡dlib.h
>

36 
	~<uni¡d.h
>

37 
	~<”ºo.h
>

38 
	~<”r.h
>

40 
	~"cÚfig.h
"

41 
	~"‹¡.h
"

45 
	$wa™_badpid
(
pid
, cÚ¡ *
desc
)

47 
rv
, 
x
;

48 
rv
 = 
	`wa™pid
(
pid
, &
x
, 0);

49 
	`»pÜt_‹¡2
(
rv
, 
”ºo
, 
EINVAL
, 
NOSUCHPID_ERROR
, 
desc
);

50 
	}
}

54 
	$wa™_bad¡©us
(*
±r
, cÚ¡ *
desc
)

56 
rv
, 
pid
, 
x
;

58 
pid
 = 
	`fÜk
();

59 ià(
pid
<0) {

60 
	`w¬n
("UH-OH: fork failed");

63 ià(
pid
==0) {

64 
	`ex™
(0);

67 
rv
 = 
	`wa™pid
(
pid
, 
±r
, 0);

68 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
desc
);

69 
	`wa™pid
(
pid
, &
x
, 0);

70 
	}
}

74 
	$wa™_uÇligÃd
()

76 
rv
, 
pid
, 
x
;

77 
¡©us
[2];

78 *
±r
;

80 
pid
 = 
	`fÜk
();

81 ià(
pid
<0) {

82 
	`w¬n
("UH-OH: fork failed");

85 ià(
pid
==0) {

86 
	`ex™
(0);

90 
±r
 = (*)(&
¡©us
[0]);

93 
±r
++;

95 
rv
 = 
	`wa™pid
(
pid
, (*)
±r
, 0);

96 
	`»pÜt_surviv®
(
rv
, 
”ºo
, "wait with unaligned status");

97 ià(
rv
<0) {

98 
	`wa™pid
(
pid
, &
x
, 0);

100 
	}
}

104 
	$wa™_badæags
()

106 
rv
, 
x
, 
pid
;

108 
pid
 = 
	`fÜk
();

109 ià(
pid
<0) {

110 
	`w¬n
("UH-OH: fork failed");

113 ià(
pid
==0) {

114 
	`ex™
(0);

117 
rv
 = 
	`wa™pid
(
pid
, &
x
, 309429);

118 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EINVAL
, "wait with bad flags");

119 
	`wa™pid
(
pid
, &
x
, 0);

120 
	}
}

124 
	$wa™_£lf
()

126 
rv
, 
x
;

127 
rv
 = 
	`wa™pid
(
	`g‘pid
(), &
x
, 0);

128 
	`»pÜt_surviv®
(
rv
, 
”ºo
, "wait for self");

129 
	}
}

133 
	$wa™_·»Á
()

135 
mypid
, 
chdpid
, 
rv
, 
x
;

137 
mypid
 = 
	`g‘pid
();

138 
chdpid
 = 
	`fÜk
();

139 ià(
chdpid
<0) {

140 
	`w¬n
("UH-OH: can't fork");

143 ià(
chdpid
==0) {

145 
rv
 = 
	`wa™pid
(
mypid
, &
x
, 0);

146 
	`»pÜt_surviv®
(
rv
, 
”ºo
, "wait for…arent (from child)");

147 
	`_ex™
(0);

149 
rv
 = 
	`wa™pid
(
chdpid
, &
x
, 0);

150 
	`»pÜt_surviv®
(
rv
, 
”ºo
, "wait for…arentest (from…arent)");

151 
	}
}

157 
	$wa™_siblšgs_chd
()

159 
pids
[2], 
mypid
, 
Ùh”pid
, 
fd
, 
rv
, 
x
;

161 
mypid
 = 
	`g‘pid
();

163 
fd
 = 
	`İ’
(
TESTFILE
, 
O_RDONLY
);

164 ià(
fd
<0) {

165 
	`w¬n
("UH-OH: child…rocess (pid %d) can't open %s",

166 
mypid
, 
TESTFILE
);

175 
rv
 = 
	`l£ek
(
fd
, 0, 
SEEK_SET
);

176 ià(
rv
<0) {

177 
	`w¬n
("UH-OH: child…rocess (pid %d)†seekƒrror",

178 
mypid
);

181 
rv
 = 
	`»ad
(
fd
, 
pids
, (pids));

182 ià(
rv
<0) {

183 
	`w¬n
("UH-OH: child…rocess (pid %d)„eadƒrror",

184 
mypid
);

187 } 
rv
 < ()(
pids
));

189 ià(
mypid
==
pids
[0]) {

190 
Ùh”pid
 = 
pids
[1];

192 ià(
mypid
==
pids
[1]) {

193 
Ùh”pid
 = 
pids
[0];

196 
	`w¬n
("UH-OH: child…rocess (pid %d) got garbage in comm file",

197 
mypid
);

200 
	`şo£
(
fd
);

202 
rv
 = 
	`wa™pid
(
Ùh”pid
, &
x
, 0);

203 
	`»pÜt_surviv®
(
rv
, 
”ºo
, "sibling wait");

204 
	}
}

208 
	$wa™_siblšgs
()

210 
pids
[2], 
fd
, 
rv
, 
x
;

214 
fd
 = 
	`İ’_‹¡fe
(
NULL
);

215 ià(
fd
<0) {

219 
pids
[0] = 
	`fÜk
();

220 ià(
pids
[0]<0) {

221 
	`w¬n
("UH-OH: can't fork");

224 ià(
pids
[0]==0) {

225 
	`şo£
(
fd
);

226 
	`wa™_siblšgs_chd
();

227 
	`_ex™
(0);

230 
pids
[1] = 
	`fÜk
();

231 ià(
pids
[1]<0) {

232 
	`w¬n
("UH-OH: can't fork");

236 ià(
pids
[1]==0) {

237 
	`şo£
(
fd
);

238 
	`wa™_siblšgs_chd
();

239 
	`_ex™
(0);

242 
rv
 = 
	`wr™e
(
fd
, 
pids
, (pids));

243 ià(
rv
 < 0) {

244 
	`w¬n
("UH-OH: wr™”rÜ oÀ%s", 
TESTFILE
);

248 ià(
rv
 !ğ()(
pids
)) {

249 
	`w¬nx
("UH-OH: wr™”rÜ oÀ%s: shÜˆcouÁ", 
TESTFILE
);

254 
rv
 = 
	`wa™pid
(
pids
[0], &
x
, 0);

255 ià(
rv
<0) {

256 
	`w¬n
("UH-OH:ƒ¼Ü wa™šg fÜ chd 0 (pid %d)", 
pids
[0]);

258 
rv
 = 
	`wa™pid
(
pids
[1], &
x
, 0);

259 ià(
rv
<0) {

260 
	`w¬n
("UH-OH:ƒ¼Ü wa™šg fÜ chd 1 (pid %d)", 
pids
[1]);

262 
	`w¬nx
("passed: siblings wait forƒach other");

263 
	`şo£
(
fd
);

264 
	`»move
(
TESTFILE
);

265 
	}
}

270 
	$‹¡_wa™pid
()

272 
	`wa™_badpid
(-8, "wait for…id -8");

273 
	`wa™_badpid
(-1, "wait for…id -1");

274 
	`wa™_badpid
(0, "pid zero");

275 
	`wa™_badpid
(
NONEXIST_PID
, "nonexistent…id");

277 
	`wa™_bad¡©us
(
NULL
, "wait with NULL status");

278 
	`wa™_bad¡©us
(
INVAL_PTR
, "wait with invalid…ointer status");

279 
	`wa™_bad¡©us
(
KERN_PTR
, "wait with kernel…ointer status");

281 
	`wa™_uÇligÃd
();

283 
	`wa™_badæags
();

285 
	`wa™_£lf
();

286 
	`wa™_·»Á
();

287 
	`wa™_siblšgs
();

288 
	}
}

	@badcall/bad_write.c

34 
	~"‹¡.h
"

37 
	$‹¡_wr™e
()

39 
	`‹¡_wr™e_fd
();

40 
	`‹¡_wr™e_buf
();

41 
	}
}

	@badcall/common_buf.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<lim™s.h
>

41 
	~<”ºo.h
>

42 
	~<”r.h
>

44 
	~"cÚfig.h
"

45 
	~"‹¡.h
"

47 
	gbuf_fd
;

49 
	sbuáe¡
 {

50 (*
	m£tup
)();

51 (*
	mİ
)(*);

52 (*
	mş—nup
)();

53 cÚ¡ *
	mÇme
;

60 
	$»ad_£tup
()

62 
buf_fd
 = 
	`İ’_‹¡fe
("i do‚ot†ike greenƒggs‡nd ham");

63 ià(
buf_fd
<0) {

67 
	}
}

71 
	$»ad_badbuf
(*
buf
)

73  
	`»ad
(
buf_fd
, 
buf
, 128);

74 
	}
}

78 
	$»ad_ş—nup
()

80 
	`şo£
(
buf_fd
);

81 
	`»move
(
TESTFILE
);

82 
	}
}

88 
	$wr™e_£tup
()

90 
buf_fd
 = 
	`İ’_‹¡fe
(
NULL
);

91 ià(
buf_fd
<0) {

95 
	}
}

99 
	$wr™e_badbuf
(*
±r
)

101  
	`wr™e
(
buf_fd
, 
±r
, 128);

102 
	}
}

106 
	$wr™e_ş—nup
()

108 
	`şo£
(
buf_fd
);

109 
	`»move
(
TESTFILE
);

110 
	}
}

116 
	$g‘dœ’Œy_£tup
()

118 
buf_fd
 = 
	`İ’
(".", 
O_RDONLY
);

119 ià(
buf_fd
 < 0) {

120 
	`w¬n
("UH-OH: couldn't open .");

124 
	}
}

128 
	$g‘dœ’Œy_badbuf
(*
±r
)

130  
	`g‘dœ’Œy
(
buf_fd
, 
±r
, 1024);

131 
	}
}

135 
	$g‘dœ’Œy_ş—nup
()

137 
	`şo£
(
buf_fd
);

138 
	}
}

144 
	$»adlšk_£tup
()

146  
	`ü—‹_‹¡lšk
();

147 
	}
}

151 
	$»adlšk_badbuf
(*
buf
)

153  
	`»adlšk
(
TESTLINK
, 
buf
, 168);

154 
	}
}

158 
	$»adlšk_ş—nup
()

160 
	`»move
(
TESTLINK
);

161 
	}
}

165 
	$g‘cwd_£tup
(è{  0; 
	}
}

166 
	$g‘cwd_ş—nup
(è{
	}
}

170 
	$g‘cwd_badbuf
(*
buf
)

172  
	`__g‘cwd
(
buf
, 408);

173 
	}
}

179 
	$commÚ_badbuf
(
buáe¡
 *
šfo
, *
buf
, cÚ¡ *
bufdesc
)

181 
mydesc
[128];

182 
rv
;

184 
	`¢´štf
(
mydesc
, (mydesc), "%s with %s buffer",

185 
šfo
->
Çme
, 
bufdesc
);

186 
šfo
->
	`£tup
();

187 
rv
 = 
šfo
->
	`İ
(
buf
);

188 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
mydesc
);

189 
šfo
->
	`ş—nup
();

190 
	}
}

194 
	$ªy_badbuf
(
buáe¡
 *
šfo
)

196 
	`commÚ_badbuf
(
šfo
, 
NULL
, "NULL");

197 
	`commÚ_badbuf
(
šfo
, 
INVAL_PTR
, "invalid");

198 
	`commÚ_badbuf
(
šfo
, 
KERN_PTR
, "kernel-space");

199 
	}
}

203 
	#T
(
ÿÎ
) \

205 
‹¡_
##
ÿÎ
##
	`_buf
() \

207 
buáe¡
 
šfo
 = { \

208 
ÿÎ
##
_£tup
, \

209 
ÿÎ
##
_badbuf
, \

210 
ÿÎ
##
_ş—nup
, \

213 
	`ªy_badbuf
(&
šfo
); \

214 }

	)

216 
T
(
»ad
);

217 
T
(
wr™e
);

218 
T
(
g‘dœ’Œy
);

219 
T
(
»adlšk
);

220 
T
(
g‘cwd
);

	@badcall/common_fds.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<lim™s.h
>

41 
	~<”ºo.h
>

42 
	~<”r.h
>

44 
	~"cÚfig.h
"

45 
	~"‹¡.h
"

50 
	$»ad_badfd
(
fd
)

52 
buf
[128];

53  
	`»ad
(
fd
, 
buf
, (buf));

54 
	}
}

58 
	$wr™e_badfd
(
fd
)

60 
buf
[128];

61 
	`mem£t
(
buf
, 'a', (buf));

62  
	`wr™e
(
fd
, 
buf
, (buf));

63 
	}
}

68 
	$şo£_badfd
(
fd
)

70  
	`şo£
(
fd
);

71 
	}
}

75 
	$ioùl_badfd
(
fd
)

77  
	`ioùl
(
fd
, 0, 
NULL
);

78 
	}
}

82 
	$l£ek_badfd
(
fd
)

84  
	`l£ek
(
fd
, 0, 
SEEK_SET
);

85 
	}
}

89 
	$fsync_badfd
(
fd
)

91  
	`fsync
(
fd
);

92 
	}
}

96 
	$árunÿ‹_badfd
(
fd
)

98  
	`árunÿ‹
(
fd
, 60);

99 
	}
}

103 
	$f¡©_badfd
(
fd
)

105 
¡©
 
sb
;

106  
	`f¡©
(
fd
, &
sb
);

107 
	}
}

111 
	$g‘dœ’Œy_badfd
(
fd
)

113 
buf
[32];

114  
	`g‘dœ’Œy
(
fd
, 
buf
, (buf));

115 
	}
}

119 
	$dup2_badfd
(
fd
)

122  
	`dup2
(
fd
, 
CLOSED_FD
+1);

123 
	}
}

127 
	$dup2_ş—nup
()

129 
	`şo£
(
CLOSED_FD
+1);

130 
	}
}

136 
ªy_badfd
((*
func
)(
fd
), (*
ş—nup
)(), cÚ¡ *
ÿÎÇme
,

137 
fd
, cÚ¡ *
fddesc
)

139 
fuÎdesc
[128];

140 
rv
;

142 
	`¢´štf
(
fuÎdesc
, (fuÎdesc), "% usšg %s", 
ÿÎÇme
, 
fddesc
);

143 
rv
 = 
	`func
(
fd
);

144 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EBADF
, 
fuÎdesc
);

145 ià(
ş—nup
) {

146 
	`ş—nup
();

148 
	}
}

152 
ruÁe¡
((*
func
)(
fd
), (*
ş—nup
)(), cÚ¡ *
ÿÎÇme
)

159 
	`ªy_badfd
(
func
, 
ş—nup
, 
ÿÎÇme
, -1, "fd -1");

162 
	`ªy_badfd
(
func
, 
ş—nup
, 
ÿÎÇme
, -5, "fd -5");

165 
	`ªy_badfd
(
func
, 
ş—nup
, 
ÿÎÇme
, 
CLOSED_FD
, "closed fd");

168 
	`ªy_badfd
(
func
, 
ş—nup
, 
ÿÎÇme
, 
IMPOSSIBLE_FD
, "impossible fd");

171 #ifdeà
OPEN_MAX


172 
	`ªy_badfd
(
func
, 
ş—nup
, 
ÿÎÇme
, 
OPEN_MAX
, "fd OPEN_MAX");

174 
	`w¬nx
("Warning: OPEN_MAX‚ot defined,est skipped");

176 
	}
}

180 
	#T
(
ÿÎ
) \

182 
‹¡_
##
ÿÎ
##
	`_fd
() \

184 
	`ruÁe¡
(
ÿÎ
##
_badfd
, 
NULL
, #call); \

185 }

	)

187 
	#TC
(
ÿÎ
) \

189 
‹¡_
##
ÿÎ
##
	`_fd
() \

191 
	`ruÁe¡
(
ÿÎ
##
_badfd
, c®l##
_ş—nup
, #call);\

192 }

	)

194 
T
(
»ad
);

195 
T
(
wr™e
);

196 
T
(
şo£
);

197 
T
(
ioùl
);

198 
T
(
l£ek
);

199 
T
(
fsync
);

200 
T
(
árunÿ‹
);

201 
T
(
f¡©
);

202 
T
(
g‘dœ’Œy
);

203 
TC
(
dup2
);

	@badcall/common_path.c

34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<¡dio.h
>

37 
	~<¡dlib.h
>

38 
	~<¡ršg.h
>

39 
	~<uni¡d.h
>

40 
	~<lim™s.h
>

41 
	~<”ºo.h
>

42 
	~<”r.h
>

44 
	~"cÚfig.h
"

45 
	~"‹¡.h
"

49 
	$İ’_bad·th
(cÚ¡ *
·th
)

51  
	`İ’
(
·th
, 
O_RDONLY
);

52 
	}
}

56 
	$»move_bad·th
(cÚ¡ *
·th
)

58  
	`»move
(
·th
);

59 
	}
}

63 
	$»Çme_bad·th1
(cÚ¡ *
·th
)

65  
	`»Çme
(
·th
, 
TESTFILE
);

66 
	}
}

70 
	$»Çme_bad·th2
(cÚ¡ *
·th
)

72  
	`»Çme
(
TESTFILE
, 
·th
);

73 
	}
}

77 
	$lšk_bad·th1
(cÚ¡ *
·th
)

79  
	`lšk
(
·th
, 
TESTFILE
);

80 
	}
}

84 
	$lšk_bad·th2
(cÚ¡ *
·th
)

86  
	`lšk
(
TESTFILE
, 
·th
);

87 
	}
}

91 
	$mkdœ_bad·th
(cÚ¡ *
·th
)

93  
	`mkdœ
(
·th
, 0775);

94 
	}
}

98 
	$rmdœ_bad·th
(cÚ¡ *
·th
)

100  
	`rmdœ
(
·th
);

101 
	}
}

105 
	$chdœ_bad·th
(cÚ¡ *
·th
)

107  
	`chdœ
(
·th
);

108 
	}
}

112 
	$symlšk_bad·th1
(cÚ¡ *
·th
)

114  
	`symlšk
(
·th
, 
TESTFILE
);

115 
	}
}

119 
	$symlšk_bad·th2
(cÚ¡ *
·th
)

121  
	`symlšk
(
TESTFILE
, 
·th
);

122 
	}
}

126 
	$»adlšk_bad·th
(cÚ¡ *
·th
)

128 
buf
[128];

129  
	`»adlšk
(
·th
, 
buf
, (buf));

130 
	}
}

134 
	$l¡©_bad·th
(cÚ¡ *
Çme
)

136 
¡©
 
sb
;

137  
	`l¡©
(
Çme
, &
sb
);

138 
	}
}

142 
	$¡©_bad·th
(cÚ¡ *
Çme
)

144 
¡©
 
sb
;

145  
	`¡©
(
Çme
, &
sb
);

146 
	}
}

152 
commÚ_bad·th
((*
func
)(cÚ¡ *
·th
), 
mk
, 
rm
, const *path,

153 cÚ¡ *
ÿÎ
, cÚ¡ *
·thdesc
)

155 
mydesc
[128];

156 
rv
;

158 ià(
mk
) {

159 ià(
	`ü—‹_‹¡fe
()<0) {

164 
	`¢´štf
(
mydesc
, (mydesc), "% w™h % ·th", 
ÿÎ
, 
·thdesc
);

165 
rv
 = 
	`func
(
·th
);

166 
	`»pÜt_‹¡
(
rv
, 
”ºo
, 
EFAULT
, 
mydesc
);

168 ià(
mk
 || 
rm
) {

169 
	`»move
(
TESTFILE
);

171 
	}
}

175 
ªy_bad·th
((*
func
)(cÚ¡ *
·th
), cÚ¡ *
ÿÎ
, 
mk
, 
rm
)

177 
	`commÚ_bad·th
(
func
, 
mk
, 
rm
, 
NULL
, 
ÿÎ
, "NULL");

178 
	`commÚ_bad·th
(
func
, 
mk
, 
rm
, 
INVAL_PTR
, 
ÿÎ
, "invalid-pointer");

179 
	`commÚ_bad·th
(
func
, 
mk
, 
rm
, 
KERN_PTR
, 
ÿÎ
, "kernel-pointer");

180 
	}
}

185 
	#T
(
ÿÎ
) \

187 
‹¡_
##
ÿÎ
##
	`_·th
() \

189 
	`ªy_bad·th
(
ÿÎ
##
_bad·th
, #call, 0, 0); \

190 }

	)

192 
T
(
İ’
);

193 
T
(
»move
);

194 
T
(
mkdœ
);

195 
T
(
rmdœ
);

196 
T
(
chdœ
);

197 
T
(
»adlšk
);

198 
T
(
¡©
);

199 
T
(
l¡©
);

202 
	#T2
(
ÿÎ
) \

204 
‹¡_
##
ÿÎ
##
	`_·ths
() \

206 
	`ªy_bad·th
(
ÿÎ
##
_bad·th1
, #call "(arg1)", 0, 1); \

207 
	`ªy_bad·th
(
ÿÎ
##
_bad·th2
, #call "(arg2)", 1, 1); \

208 }

	)

210 
T2
(
»Çme
);

211 
T2
(
lšk
);

212 
T2
(
symlšk
);

	@badcall/config.h

37 #ià
defšed
(
__ms__
)

38 
	#KERN_PTR
 ((*)0x80000000è

	)

39 
	#INVAL_PTR
 ((*)0x40000000è

	)

48 
	#CLOSED_FD
 10

	)

51 
	#IMPOSSIBLE_FD
 1234567890

	)

54 
	#NONEXIST_PID
 34000

	)

57 #ifdeà
ESRCH


58 
	#NOSUCHPID_ERROR
 
ESRCH


	)

60 
	#NOSUCHPID_ERROR
 
EINVAL


	)

64 
	#MAGIC_STATUS
 107

	)

67 
	#NONEXIST_IOCTL
 12345

	)

	@badcall/driver.c

30 
	~<sys/ty³s.h
>

31 
	~<sys/¡©.h
>

32 
	~<¡dio.h
>

33 
	~<¡dlib.h
>

34 
	~<¡ršg.h
>

35 
	~<uni¡d.h
>

36 
	~<”ºo.h
>

37 
	~<”r.h
>

39 
	~"cÚfig.h
"

40 
	~"‹¡.h
"

46 
	$fšd”rÜ
(
rv
, 
”rÜ
)

48 ià(
rv
==-1) {

49  
”rÜ
;

54 
	}
}

57 
	$»pÜt_surviv®
(
rv
, 
”rÜ
, cÚ¡ *
desc
)

60 
”ºo
 = 
	`fšd”rÜ
(
rv
, 
”rÜ
);

61 
	`w¬n
("·s£d: %s", 
desc
);

62 
	}
}

65 
	$»pÜt_‹¡
(
rv
, 
”rÜ
, 
right_”rÜ
, cÚ¡ *
desc
)

67 
gÙ”rÜ
 = 
	`fšd”rÜ
(
rv
, 
”rÜ
);

69 ià(
gÙ”rÜ
 =ğ
right_”rÜ
) {

70 
	`w¬nx
("·s£d: %s", 
desc
);

72 ià(
gÙ”rÜ
 =ğ
EUNIMP
 || gÙ”rÜ =ğ
ENOSYS
) {

73 
	`w¬nx
("------: % (unim¶em’‹d)", 
desc
);

76 
”ºo
 = 
gÙ”rÜ
;

77 
	`w¬n
("FAILURE: %s", 
desc
);

79 
	}
}

82 
	$»pÜt_‹¡2
(
rv
, 
”rÜ
, 
ok”r1
, 
ok”r2
, cÚ¡ *
desc
)

84 
gÙ”rÜ
 = 
	`fšd”rÜ
(
rv
, 
”rÜ
);

85 ià(
gÙ”rÜ
 =ğ
ok”r1
 || gÙ”rÜ =ğ
ok”r2
) {

86 
	`w¬nx
("·s£d: %s", 
desc
);

88 ià(
gÙ”rÜ
 =ğ
EUNIMP
 || gÙ”rÜ =ğ
ENOSYS
) {

89 
	`w¬nx
("------: % (unim¶em’‹d)", 
desc
);

92 
”ºo
 = 
gÙ”rÜ
;

93 
	`w¬n
("FAILURE: %s", 
desc
);

95 
	}
}

100 
	$İ’_‹¡fe
(cÚ¡ *
¡ršg
)

102 
fd
, 
rv
;

103 
size_t
 
Ën
;

105 
fd
 = 
	`İ’
(
TESTFILE
, 
O_RDWR
|
O_CREAT
|
O_TRUNC
);

106 ià(
fd
<0) {

107 
	`w¬n
("UH-OH: c»©šg %s: faed", 
TESTFILE
);

111 ià(
¡ršg
) {

112 
Ën
 = 
	`¡¾’
(
¡ršg
);

113 
rv
 = 
	`wr™e
(
fd
, 
¡ršg
, 
Ën
);

114 ià(
rv
<0) {

115 
	`w¬n
("UH-OH: wr™tØ% çed", 
TESTFILE
);

116 
	`şo£
(
fd
);

117 
	`»move
(
TESTFILE
);

120 ià(()
rv
 !ğ
Ën
) {

121 
	`w¬nx
("UH-OH: wr™tØ% gÙ shÜˆcouÁ", 
TESTFILE
);

122 
	`şo£
(
fd
);

123 
	`»move
(
TESTFILE
);

126 
rv
 = 
	`l£ek
(
fd
, 0, 
SEEK_SET
);

127 ià(
rv
<0) {

128 
	`w¬n
("UH-OH:„ewšd oà% çed", 
TESTFILE
);

129 
	`şo£
(
fd
);

130 
	`»move
(
TESTFILE
);

134  
fd
;

135 
	}
}

138 
	$ü—‹_‹¡fe
()

140 
fd
, 
rv
;

142 
fd
 = 
	`İ’_‹¡fe
(
NULL
);

143 ià(
fd
<0) {

147 
rv
 = 
	`şo£
(
fd
);

148 ià(
rv
<0) {

149 
	`w¬n
("UH-OH: closšg % çed", 
TESTFILE
);

154 
	}
}

157 
	$ü—‹_‹¡dœ
()

159 
rv
;

160 
rv
 = 
	`mkdœ
(
TESTDIR
, 0775);

161 ià(
rv
<0) {

162 
	`w¬n
("UH-OH: mkdœ % çed", 
TESTDIR
);

166 
	}
}

169 
	$ü—‹_‹¡lšk
()

171 
rv
;

172 
rv
 = 
	`symlšk
("bÏhbÏh", 
TESTLINK
);

173 ià(
rv
<0) {

174 
	`w¬n
("UH-OH: makšg symlšk % çed", 
TESTLINK
);

178 
	}
}

184 
	mch
;

185 
	mas¡
;

186 cÚ¡ *
	mÇme
;

187 (*
	mf
)();

188 } 
	gİs
[] = {

189 { 'a', 2, "execv", 
‹¡_execv
 },

190 { 'b', 2, "wa™pid", 
‹¡_wa™pid
 },

191 { 'c', 2, "İ’", 
‹¡_İ’
 },

192 { 'd', 2, "»ad", 
‹¡_»ad
 },

193 { 'e', 2, "wr™e", 
‹¡_wr™e
 },

194 { 'f', 2, "şo£", 
‹¡_şo£
 },

195 { 'g', 0, "»boÙ", 
‹¡_»boÙ
 },

196 { 'h', 3, "sbrk", 
‹¡_sbrk
 },

197 { 'i', 5, "ioùl", 
‹¡_ioùl
 },

198 { 'j', 2, "l£ek", 
‹¡_l£ek
 },

199 { 'k', 4, "fsync", 
‹¡_fsync
 },

200 { 'l', 4, "árunÿ‹", 
‹¡_árunÿ‹
 },

201 { 'm', 4, "f¡©", 
‹¡_f¡©
 },

202 { 'n', 4, "»move", 
‹¡_»move
 },

203 { 'o', 4, "»Çme", 
‹¡_»Çme
 },

204 { 'p', 5, "lšk", 
‹¡_lšk
 },

205 { 'q', 4, "mkdœ", 
‹¡_mkdœ
 },

206 { 'r', 4, "rmdœ", 
‹¡_rmdœ
 },

207 { 's', 2, "chdœ", 
‹¡_chdœ
 },

208 { 't', 4, "g‘dœ’Œy", 
‹¡_g‘dœ’Œy
 },

209 { 'u', 5, "symlšk", 
‹¡_symlšk
 },

210 { 'v', 5, "»adlšk", 
‹¡_»adlšk
 },

211 { 'w', 2, "dup2", 
‹¡_dup2
 },

212 { 'x', 5, "pe", 
‹¡_pe
 },

213 { 'y', 5, "__time", 
‹¡_time
 },

214 { 'z', 2, "__g‘cwd", 
‹¡_g‘cwd
 },

215 { '{', 5, "¡©", 
‹¡_¡©
 },

216 { '|', 5, "l¡©", 
‹¡_l¡©
 },

217 { 0, 0, 
NULL
, NULL }

220 
	#LOWEST
 'a'

	)

221 
	#HIGHEST
 '|'

	)

225 
	$m’u
()

227 
i
;

228 
i
=0; 
İs
[i].
Çme
; i++) {

229 
	`´štf
("[%c] %-24s", 
İs
[
i
].
ch
, ops[i].
Çme
);

230 ià(
i
%2==1) {

231 
	`´štf
("\n");

234 ià(
i
%2==1) {

235 
	`´štf
("\n");

237 
	`´štf
("[1] %-24s", "asst1");

238 
	`´štf
("[2] %-24s\n", "asst2");

239 
	`´štf
("[3] %-24s", "asst3");

240 
	`´štf
("[4] %-24s\n", "asst4");

241 
	`´štf
("[*] %-24s", "all");

242 
	`´štf
("[!] %-24s\n", "quit");

243 
	}
}

247 
	$run™
(
İ
)

249 
i
, 
k
;

251 ià(
İ
=='!') {

252 
	`ex™
(0);

255 ià(
İ
=='?') {

256 
	`m’u
();

260 ià(
İ
=='*') {

261 
i
=0; 
İs
[i].
Çme
; i++) {

262 
	`´štf
("[%s]\n", 
İs
[
i
].
Çme
);

263 
İs
[
i
].
	`f
();

268 ià(
İ
>='1' && op <= '4') {

269 
k
 = 
İ
-'0';

270 
i
=0; 
İs
[i].
Çme
; i++) {

271 ià(
İs
[
i
].
as¡
 <ğ
k
) {

272 
	`´štf
("[%s]\n", 
İs
[
i
].
Çme
);

273 
İs
[
i
].
	`f
();

279 ià(
İ
 < 
LOWEST
 || o°> 
HIGHEST
) {

280 
	`´štf
("Inv®id„eque¡ %c\n", 
İ
);

284 
İs
[
İ
-'a'].
	`f
();

285 
	}
}

288 
	$maš
(
¬gc
, **
¬gv
)

290 
İ
, 
i
, 
j
;

292 
	`´štf
("[%c-%c, 1-4, *, ?=m’u, !=qu™]\n", 
LOWEST
, 
HIGHEST
);

294 ià(
¬gc
 > 1) {

295 
i
=1; i<
¬gc
; i++) {

296 
j
=0; 
¬gv
[
i
][j]; j++) {

297 
	`´štf
("Choose: %c\n",

298 
¬gv
[
i
][
j
]);

299 
	`run™
(
¬gv
[
i
][
j
]);

304 
	`m’u
();

306 
	`´štf
("Choose: ");

307 
İ
 = 
	`g‘ch¬
();

308 ià(
İ
==
EOF
) {

311 
	`´štf
("%c\n", 
İ
);

312 
	`run™
(
İ
);

317 
	}
}

	@badcall/test.h

30 
	#TESTFILE
 "badÿÎfe"

	)

31 
	#TESTDIR
 "badÿÎdœ"

	)

32 
	#TESTLINK
 "badÿÎlšk"

	)

35 
»pÜt_surviv®
(
rv
, 
”rÜ
, cÚ¡ *
desc
);

36 
»pÜt_‹¡
(
rv
, 
”rÜ
, 
right_”rÜ
, cÚ¡ *
desc
);

37 
»pÜt_‹¡2
(
rv
, 
”rÜ
, 
ok”r1
, 
ok”r2
, cÚ¡ *
desc
);

38 
İ’_‹¡fe
(cÚ¡ *
¡r
);

39 
ü—‹_‹¡fe
();

40 
ü—‹_‹¡dœ
();

41 
ü—‹_‹¡lšk
();

44 
‹¡_»ad_buf
();

45 
‹¡_wr™e_buf
();

46 
‹¡_g‘dœ’Œy_buf
();

47 
‹¡_g‘cwd_buf
();

48 
‹¡_»adlšk_buf
();

51 
‹¡_»ad_fd
();

52 
‹¡_wr™e_fd
();

53 
‹¡_şo£_fd
();

54 
‹¡_ioùl_fd
();

55 
‹¡_l£ek_fd
();

56 
‹¡_fsync_fd
();

57 
‹¡_árunÿ‹_fd
();

58 
‹¡_f¡©_fd
();

59 
‹¡_g‘dœ’Œy_fd
();

60 
‹¡_dup2_fd
();

63 
‹¡_İ’_·th
();

64 
‹¡_»move_·th
();

65 
‹¡_»Çme_·ths
();

66 
‹¡_lšk_·ths
();

67 
‹¡_mkdœ_·th
();

68 
‹¡_rmdœ_·th
();

69 
‹¡_chdœ_·th
();

70 
‹¡_symlšk_·ths
();

71 
‹¡_»adlšk_·th
();

72 
‹¡_¡©_·th
();

73 
‹¡_l¡©_·th
();

76 
‹¡_execv
();

77 
‹¡_wa™pid
();

78 
‹¡_İ’
();

79 
‹¡_»ad
();

80 
‹¡_wr™e
();

81 
‹¡_şo£
();

82 
‹¡_»boÙ
();

83 
‹¡_sbrk
();

84 
‹¡_ioùl
();

85 
‹¡_l£ek
();

86 
‹¡_fsync
();

87 
‹¡_árunÿ‹
();

88 
‹¡_f¡©
();

89 
‹¡_»move
();

90 
‹¡_»Çme
();

91 
‹¡_lšk
();

92 
‹¡_mkdœ
();

93 
‹¡_rmdœ
();

94 
‹¡_chdœ
();

95 
‹¡_g‘dœ’Œy
();

96 
‹¡_symlšk
();

97 
‹¡_»adlšk
();

98 
‹¡_dup2
();

99 
‹¡_pe
();

100 
‹¡_time
();

101 
‹¡_g‘cwd
();

102 
‹¡_¡©
();

103 
‹¡_l¡©
();

	@bigfile/bigfile.c

39 
	~<¡dlib.h
>

40 
	~<¡dio.h
>

41 
	~<¡ršg.h
>

42 
	~<uni¡d.h
>

43 
	~<”r.h
>

45 
	gbufãr
[100];

48 
	$maš
(
¬gc
, *
¬gv
[])

50 cÚ¡ *
f’ame
;

51 
i
, 
size
;

52 
feid
;

53 
Ën
;

55 ià(
¬gc
 != 3) {

56 
	`”rx
(1, "Usage: bigfile <filename> <size>");

59 
f’ame
 = 
¬gv
[1];

60 
size
 = 
	`©oi
(
¬gv
[2]);

62 
	`´štf
("C»©šg‡ foàsiz%d\n", 
size
);

64 
feid
 = 
	`İ’
(
f’ame
, 
O_WRONLY
|
O_CREAT
|
O_TRUNC
);

65 ià(
feid
 < 0) {

66 
	`”r
(1, "%s: c»©e", 
f’ame
);

69 
i
=0;

70 
i
<
size
) {

71 
	`¢´štf
(
bufãr
, (bufãr), "%-10d", 
i
);

72 
Ën
 = 
	`wr™e
(
feid
, 
bufãr
, 
	`¡¾’
(buffer));

73 ià(
Ën
<0) {

74 
	`”r
(1, "%s: wr™e", 
f’ame
);

76 
i
 +ğ
Ën
;

79 
	`şo£
(
feid
);

82 
	}
}

	@conman/conman.c

37 
	~<uni¡d.h
>

38 
	~<”r.h
>

41 
	$maš
() {

42 
ch
=0;

43 
Ën
;

45 
ch
!='q') {

46 
Ën
 = 
	`»ad
(
STDIN_FILENO
, &
ch
, 1);

47 ià(
Ën
 < 0) {

48 
	`”r
(1, "stdin:„ead");

50 ià(
Ën
==0) {

54 
	`wr™e
(
STDOUT_FILENO
, &
ch
, 1);

57 
	}
}

	@crash/crash.c

44 
	~<¡dio.h
>

45 
	~<¡dšt.h
>

46 
	~<uni¡d.h
>

47 
	~<”r.h
>

49 #ià
defšed
(
__ms__
)

50 
	#KERNEL_ADDR
 0x80000000

	)

51 
	#INVAL_ADDR
 0x40000000

	)

52 
	#INSN_TYPE
 
ušt32_t


	)

53 
	#INVAL_INSN
 0x0000003f

	)

58 (*
	tfunc
)();

62 
	$»ad_äom_nuÎ
()

64 *
nuÎ
 = 
NULL
;

65 vŞ©
x
;

66 
x
 = *
nuÎ
;

67 
	}
}

71 
	$»ad_äom_šv®
()

73 *
±r
 = (*è
INVAL_ADDR
;

74 vŞ©
x
;

75 
x
 = *
±r
;

76 
	}
}

80 
	$»ad_äom_k”Ãl
()

82 *
±r
 = (*è
KERNEL_ADDR
;

83 vŞ©
x
;

84 
x
 = *
±r
;

85 
	}
}

89 
	$wr™e_to_nuÎ
()

91 *
nuÎ
 = 
NULL
;

92 *
nuÎ
 = 6;

93 
	}
}

97 
	$wr™e_to_šv®
()

99 *
±r
 = (*è
INVAL_ADDR
;

100 *
±r
 = 8;

101 
	}
}

105 
	$wr™e_to_code
()

107 
INSN_TYPE
 *
x
 = (INSN_TYPE *)
wr™e_to_code
;

108 *
x
 = 
INVAL_INSN
;

109 
	}
}

113 
	$wr™e_to_k”Ãl
()

115 *
±r
 = (*è
KERNEL_ADDR
;

116 *
±r
 = 8;

117 
	}
}

121 
	$jump_to_nuÎ
()

123 
func
 
f
 = 
NULL
;

124 
	`f
();

125 
	}
}

129 
	$jump_to_šv®
()

131 
func
 
f
 = (funcè
INVAL_ADDR
;

132 
	`f
();

133 
	}
}

137 
	$jump_to_k”Ãl
()

139 
func
 
f
 = (funcè
KERNEL_ADDR
;

140 
	`f
();

141 
	}
}

146 
	$Ëg®_š¡ruùiÚ
()

148 #ià
	`defšed
(
__ms__
)

149 
	`asm
(".long 0x0000003f");

153 
	}
}

157 
	$®ignm’t_”rÜ
()

159 
x
;

160 *
±r
 = &
x
;

161 *
bad±r
 = (*)(((*)
±r
)+1);

163 vŞ©
j
;

164 
j
 = *
bad±r
;

165 
	}
}

169 
	$divide_by_z”o
()

171 vŞ©
x
 = 6;

172 vŞ©
z
 = 0;

173 vŞ©
a
;

175 
a
 = 
x
/
z
;

176 
	}
}

180 
	$mod_by_z”o
()

182 vŞ©
x
 = 6;

183 vŞ©
z
 = 0;

184 vŞ©
a
;

186 
a
 = 
x
%
z
;

187 
	}
}

191 
	$»cur£_šf
()

193 vŞ©
buf
[16];

194 
buf
[0] = 0;

195 
	`»cur£_šf
();

196 
buf
[0] = 1;

197 
	}
}

202 
	mch
;

203 cÚ¡ *
	mÇme
;

204 
func
 
	mf
;

205 } 
	gİs
[] = {

206 { 'a', "»ad from NULL", 
»ad_äom_nuÎ
 },

207 { 'b', "»ad from inv®id‡dd»ss", 
»ad_äom_šv®
 },

208 { 'c', "»ad from k”ÃÈadd»ss", 
»ad_äom_k”Ãl
 },

209 { 'd', "wr™tØNULL", 
wr™e_to_nuÎ
 },

210 { 'e', "wr™tØšv®id‡dd»ss", 
wr™e_to_šv®
 },

211 { 'f', "wr™tØcod£gm’t", 
wr™e_to_code
 },

212 { 'g', "wr™tØk”ÃÈadd»ss", 
wr™e_to_k”Ãl
 },

213 { 'h', "jum°tØNULL", 
jump_to_nuÎ
 },

214 { 'i', "jum°tØšv®id‡dd»ss", 
jump_to_šv®
 },

215 { 'j', "jum°tØk”ÃÈadd»ss", 
jump_to_k”Ãl
 },

216 { 'k', "®ignm’ˆ”rÜ", 
®ignm’t_”rÜ
 },

217 { 'l', "Ëg® in¡ruùiÚ", 
Ëg®_š¡ruùiÚ
 },

218 { 'm', "dividby z”o", 
divide_by_z”o
 },

219 { 'n', "mod by z”o", 
mod_by_z”o
 },

220 { 'o', "Recur£ infš™–y", 
»cur£_šf
 },

221 { 0, 
NULL
, NULL }

225 
	$maš
(
¬gc
, **
¬gv
)

227 
İ
, 
i
, 
¡©us
;

228 
pid_t
 
pid
;

230 ià(
¬gc
 == 2) {

231 
İ
 = 
¬gv
[1][0];

234 
i
=0; 
İs
[i].
Çme
; i++) {

235 
	`´štf
("[%c] %s\n", 
İs
[
i
].
ch
, ops[i].
Çme
);

237 
	`´štf
("[*] Runƒverything (in subprocesses)\n");

238 
	`´štf
("Note: [f] may‚ot cause‡nƒxception on some "

241 
	`´štf
("Choose: ");

242 
İ
 = 
	`g‘ch¬
();

245 ià(
İ
=='*') {

246 
i
=0; 
İs
[i].
Çme
; i++) {

247 
	`´štf
("RuÂšg: [%c] %s\n", 
İs
[
i
].
ch
, ops[i].
Çme
);

248 
pid
 = 
	`fÜk
();

249 ià(
pid
<0) {

251 
	`w¬n
("fork");

253 ià(
pid
==0) {

255 
İs
[
i
].
	`f
();

256 
	`´štf
("I wasn't killed -est fails!\n");

257 
	`_ex™
(1);

259 
	`wa™pid
(
pid
, &
¡©us
, 0);

260 ià(
	`WIFSIGNALED
(
¡©us
)) {

261 
	`´štf
("SigÇÈ%d\n", 
	`WTERMSIG
(
¡©us
));

264 
	`´štf
("Ex™ %d\n", 
	`WEXITSTATUS
(
¡©us
));

270 
İs
[
İ
-'a'].
	`f
();

272 
	`´štf
("I wasn't killed -est fails!\n");

276 
	}
}

	@ctest/ctest.c

39 
	~<¡dio.h
>

40 
	~<¡dlib.h
>

47 
	#SIZE
 (1024*1024/(
’Œy
))

	)

48 
	#DEFAULT
 477

	)

50 
	s’Œy
 {

51 
’Œy
 *
	me
;

54 
’Œy
 
	g¬¿y
[
SIZE
];

57 
	$maš
(
¬gc
, **
¬gv
)

59 vŞ©
’Œy
 *
e
;

60 
i
, 
¡ride
;

62 
¡ride
 = 
DEFAULT
;

63 ià(
¬gc
 == 2) {

64 
¡ride
 = 
	`©oi
(
¬gv
[1]);

66 ià(
¡ride
 <ğ0 || 
¬gc
 > 2) {

67 
	`´štf
("Usage: ctest [stridesize]\n");

68 
	`´štf
(" stridesize should‚ot be‡ multiple of 2.\n");

72 
	`´štf
("S¹šg c‹¡: sŒid%d\n", 
¡ride
);

81 
i
=0; i<
SIZE
; i++) {

82 
¬¿y
[
i
].
e
 = &¬¿y[(i+
¡ride
è% 
SIZE
];

91 
e
 = &
¬¿y
[0];

92 
i
=0; i<
SIZE
; i++) {

93 ià(
i
 % 
¡ride
 == 0) {

94 
	`putch¬
('.');

96 
e
 =ƒ->e;

99 
	`´štf
("\nDone!\n");

101 
	}
}

	@dirconc/dirconc.c

37 
	~<sys/ty³s.h
>

38 
	~<sys/wa™.h
>

39 
	~<sys/¡©.h
>

40 
	~<”ºo.h
>

41 
	~<¡dio.h
>

42 
	~<uni¡d.h
>

43 
	~<¡dlib.h
>

44 
	~<¡d¬g.h
>

45 
	~<¡ršg.h
>

47 
	#NTRIES
 100

	)

48 
	#NPROCS
 5

	)

50 
	#TESTDIR
 "dœcÚc"

	)

51 
	#NNAMES
 4

	)

52 
	#NAMESIZE
 32

	)

56 cÚ¡ *cÚ¡ 
	gÇmes
[
NNAMES
] = {

65 
	$choo£_Çme
(*
buf
, 
size_t
 
Ën
)

67 cÚ¡ *
a
, *
b
, *
c
;

69 
a
 = 
Çmes
[
	`¿ndom
()%
NNAMES
];

70 ià(
	`¿ndom
()%2==0) {

71 
	`¢´štf
(
buf
, 
Ën
, "%s", 
a
);

74 
b
 = 
Çmes
[
	`¿ndom
()%
NNAMES
];

75 ià(
	`¿ndom
()%2==0) {

76 
	`¢´štf
(
buf
, 
Ën
, "%s/%s", 
a
, 
b
);

79 
c
 = 
Çmes
[
	`¿ndom
()%
NNAMES
];

80 
	`¢´štf
(
buf
, 
Ën
, "%s/%s/%s", 
a
, 
b
, 
c
);

81 
	}
}

91 #ifdeà
__GNUC__


92 
__©Œibu‹__
((
	$__fÜm©__
(
__´štf__
, 1, 2)))

94 
	$§y
(cÚ¡ *
fmt
, ...)

96 
buf
[512];

97 
va_li¡
 
­
;

98 
	`va_¡¬t
(
­
, 
fmt
);

99 
	`v¢´štf
(
buf
, (buf), 
fmt
, 
­
);

100 
	`va_’d
(
­
);

101 
	`wr™e
(
STDOUT_FILENO
, 
buf
, 
	`¡¾’
(buf));

102 
	}
}

108 
	$dÜ’ame
(cÚ¡ *
Çme1
, cÚ¡ *
Çme2
)

110 ià(
	`»Çme
(
Çme1
, 
Çme2
) < 0) {

111 
”ºo
) {

112 
ENOENT
:

113 
ENOTEMPTY
:

114 
EINVAL
:

117 
	`§y
("pid %d:„ename %s -> %s: %s\n",

118 
	`g‘pid
(), 
Çme1
, 
Çme2
, 
	`¡»¼Ü
(
”ºo
));

122 
	}
}

126 
	$domkdœ
(cÚ¡ *
Çme
)

128 ià(
	`mkdœ
(
Çme
, 0775)<0) {

129 
”ºo
) {

130 
ENOENT
:

131 
EEXIST
:

134 
	`§y
("pid %d: mkdir %s: %s\n",

135 
	`g‘pid
(), 
Çme
, 
	`¡»¼Ü
(
”ºo
));

139 
	}
}

143 
	$dÜmdœ
(cÚ¡ *
Çme
)

145 ià(
	`rmdœ
(
Çme
)<0) {

146 
”ºo
) {

147 
ENOENT
:

148 
ENOTEMPTY
:

151 
	`§y
("pid %d:„mdir %s: %s\n",

152 
	`g‘pid
(), 
Çme
, 
	`¡»¼Ü
(
”ºo
));

156 
	}
}

160 
	$ş—nup_rmdœ
(cÚ¡ *
Çme
)

162 ià(
	`rmdœ
(
Çme
)<0) {

163 
”ºo
) {

164 
ENOENT
:

167 
	`§y
("cleanup (pid %d):„mdir %s: %s\n",

168 
	`g‘pid
(), 
Çme
, 
	`¡»¼Ü
(
”ºo
));

172 
	}
}

178 
	$»Çme_´oc
()

180 
Çme1
[
NAMESIZE
], 
Çme2
[NAMESIZE];

181 
ù
;

183 
ù
=0; ct<
NTRIES
; ct++) {

184 
	`choo£_Çme
(
Çme1
, (name1));

185 
	`choo£_Çme
(
Çme2
, (name2));

186 
	`§y
("pid %2d:„’am% -> %s\n", ()
	`g‘pid
(), 
Çme1
, 
Çme2
);

187 
	`dÜ’ame
(
Çme1
, 
Çme2
);

189 
	}
}

193 
	$mkdœ_´oc
()

195 
Çme
[
NAMESIZE
];

196 
ù
;

198 
ù
=0; ct<
NTRIES
; ct++) {

199 
	`choo£_Çme
(
Çme
, (name));

200 
	`§y
("pid %2d: mkdœ %s\n", ()
	`g‘pid
(), 
Çme
);

201 
	`domkdœ
(
Çme
);

203 
	}
}

207 
	$rmdœ_´oc
()

209 
Çme
[
NAMESIZE
];

210 
ù
;

212 
ù
=0; ct<
NTRIES
; ct++) {

213 
	`choo£_Çme
(
Çme
, (name));

214 
	`§y
("pid %2d:„mdœ %s\n", ()
	`g‘pid
(), 
Çme
);

215 
	`dÜmdœ
(
Çme
);

217 
	}
}

222 
pid_t


223 
dofÜk
((*
func
)())

225 
pid_t
 
pid
;

227 
pid
 = 
	`fÜk
();

228 ià(
pid
 < 0) {

229 
	`§y
("fÜk: %s\n", 
	`¡»¼Ü
(
”ºo
));

232 ià(
pid
 == 0) {

234 
	`func
();

235 
	`ex™
(0);

237  
pid
;

238 
	}
}

242 
	$run
()

244 
pid_t
 
pids
[
NPROCS
*4], 
wp
;

245 
i
, 
¡©us
;

247 
i
=0; i<
NPROCS
; i++) {

248 
pids
[
i
*4] = 
	`dofÜk
(
mkdœ_´oc
);

249 
pids
[
i
*4+1] = 
	`dofÜk
(
mkdœ_´oc
);

250 
pids
[
i
*4+2] = 
	`dofÜk
(
»Çme_´oc
);

251 
pids
[
i
*4+3] = 
	`dofÜk
(
rmdœ_´oc
);

254 
i
=0; i<
NPROCS
*4; i++) {

255 ià(
pids
[
i
]>=0) {

256 
wp
 = 
	`wa™pid
(
pids
[
i
], &
¡©us
, 0);

257 ià(
wp
<0) {

258 
	`§y
("wa™pid %d: %s\n", (è
pids
[
i
],

259 
	`¡»¼Ü
(
”ºo
));

261 ià(
	`WIFSIGNALED
(
¡©us
)) {

262 
	`§y
("pid %d: sigÇÈ%d\n", (è
pids
[
i
],

263 
	`WTERMSIG
(
¡©us
));

265 ià(
	`WIFEXITED
(
¡©us
è&& 
	`WEXITSTATUS
(status)!=0) {

266 
	`§y
("pid %d:ƒx™ %d\n", (è
pids
[
i
],

267 
	`WEXITSTATUS
(
¡©us
));

271 
	}
}

277 
	$£tup
(cÚ¡ *
fs
)

279 ià(
	`chdœ
(
fs
)<0) {

280 
	`§y
("chdœ: %s: %s\n", 
fs
, 
	`¡»¼Ü
(
”ºo
));

281 
	`ex™
(1);

283 ià(
	`mkdœ
(
TESTDIR
, 0775)<0) {

284 
	`§y
("mkdœ: %s: %s\n", 
TESTDIR
, 
	`¡»¼Ü
(
”ºo
));

285 
	`ex™
(1);

287 ià(
	`chdœ
(
TESTDIR
)<0) {

288 
	`§y
("chdœ: %s: %s\n", 
TESTDIR
, 
	`¡»¼Ü
(
”ºo
));

289 
	`ex™
(1);

291 
	}
}

295 
	$»cursive_ş—nup
(cÚ¡ *
soçr
, 
d•th
)

297 
buf
[
NAMESIZE
*32];

298 
i
;

300 
i
=0; i<
NNAMES
; i++) {

301 
	`¢´štf
(
buf
, (buf), "%s/%s", 
soçr
, 
Çmes
[
i
]);

302 ià(
	`rmdœ
(
buf
)<0) {

303 ià(
”ºo
==
ENOTEMPTY
) {

304 
	`»cursive_ş—nup
(
buf
, 
d•th
+1);

305 
	`ş—nup_rmdœ
(
buf
);

307 ià(
”ºo
!=
ENOENT
) {

308 
	`§y
("cleanup (pid %d):„mdir %s: %s\n",

309 
	`g‘pid
(), 
buf
, 
	`¡»¼Ü
(
”ºo
));

313 
	}
}

317 
	$ş—nup
()

319 
	`»cursive_ş—nup
(".", 0);

321 
	`chdœ
("..");

322 
	`ş—nup_rmdœ
(
TESTDIR
);

323 
	}
}

328 
	$maš
(
¬gc
, *
¬gv
[])

330 cÚ¡ *
fs
;

331 
£ed
 = 0;

333 
	`§y
("Concurrent directory opsest\n");

335 ià(
¬gc
==0 || 
¬gv
==
NULL
) {

336 
	`§y
("Warning:‡rgc is 0 -‡ssuming you meano„un on†hd1: "

338 
fs
 = "lhd1:";

340 ià(
¬gc
==2) {

341 
fs
 = 
¬gv
[1];

343 ià(
¬gc
==3) {

344 
fs
 = 
¬gv
[1];

345 
£ed
 = 
	`©oi
(
¬gv
[2]);

348 
	`§y
("Usage: dirconc filesystem [random-seed]\n");

349 
	`ex™
(1);

352 
	`¤ªdom
(
£ed
);

353 
	`£tup
(
fs
);

354 
	`§y
("S¹šg iÀ%s/%s\n", 
fs
, 
TESTDIR
);

356 
	`run
();

358 
	`§y
("Cleaning up\n");

359 
	`ş—nup
();

362 
	}
}

	@dirseek/dirseek.c

49 
	~<sys/ty³s.h
>

50 
	~<sys/¡©.h
>

51 
	~<uni¡d.h
>

52 
	~<¡ršg.h
>

53 
	~<¡dio.h
>

54 
	~<¡dlib.h
>

55 
	~<”r.h
>

57 
	#TESTDIR
 "£ek‹¡dœ"

	)

60 cÚ¡ *
	mÇme
;

61 
	mmake_™
;

62 
off_t
 
	mpos
;

63 } 
	g‹¡fes
[] = {

84 { 
NULL
, 0, 0 }

91 
	gdœfd
;

95 
	$fšd’Œy
(cÚ¡ *
Çme
)

97 
i
;

99 
i
=0; 
‹¡fes
[i].
Çme
; i++) {

100 ià(!
	`¡rcmp
(
‹¡fes
[
i
].
Çme
,‚ame)) {

101  
i
;

105 
	}
}

109 
	$İ’™
()

111 
dœfd
 = 
	`İ’
(".", 
O_RDONLY
);

112 ià(
dœfd
 < 0) {

113 
	`”r
(1, ".: open");

115 
	}
}

119 
	$şo£™
()

121 ià(
	`şo£
(
dœfd
)<0) {

122 
	`”r
(1, ".: close");

124 
dœfd
 = -1;

125 
	}
}

129 
	$»ad™
()

131 
buf
[4096];

132 
off_t
 
pos
;

133 
Ën
;

134 
n
, 
i
, 
ix
;

136 
i
=0; 
‹¡fes
[i].
Çme
; i++) {

137 
‹¡fes
[
i
].
pos
 = -1;

140 
pos
 = 
	`l£ek
(
dœfd
, 0, 
SEEK_CUR
);

141 ià(
pos
 < 0) {

142 
	`”r
(1, ".:†seek(0, SEEK_CUR)");

144 
n
 = 0;

146 (
Ën
 = 
	`g‘dœ’Œy
(
dœfd
, 
buf
, (buf)-1)) > 0) {

148 ià(()
Ën
 >ğ(
buf
)-1) {

149 
	`”rx
(1, ".:ƒntry %d: getdirentry„eturned "

150 "šv®id†’gth %d", 
n
, 
Ën
);

152 
buf
[
Ën
] = 0;

153 
ix
 = 
	`fšd’Œy
(
buf
);

154 ià(
ix
 < 0) {

155 
	`”rx
(1, ".:ƒntry %d: getdirentry„eturned "

156 "uÃx³ùed‚am%s", 
n
, 
buf
);

159 ià(
‹¡fes
[
ix
].
pos
 >= 0) {

160 
	`”rx
(1, ".:ƒntry %d: getdirentry„eturned "

161 "% ¨£cÚdime", 
n
, 
buf
);

164 
‹¡fes
[
ix
].
pos
 =…os;

166 
pos
 = 
	`l£ek
(
dœfd
, 0, 
SEEK_CUR
);

167 ià(
pos
 < 0) {

168 
	`”r
(1, ".:†seek(0, SEEK_CUR)");

170 
n
++;

172 ià(
Ën
<0) {

173 
	`”r
(1, ".:ƒÁry %d: g‘dœ’Œy", 
n
);

176 
i
=0; 
‹¡fes
[i].
Çme
; i++) {

177 ià(
‹¡fes
[
i
].
pos
 < 0) {

178 
	`”rx
(1, ".: getdirentry failedo„eturn %s",

179 
‹¡fes
[
i
].
Çme
);

182 ià(
i
!=
n
) {

189 
	`”rx
(1, ".: getdirentry„eturned %d‚ames,‚ot %d (huh...?)",

190 
n
, 
i
);

192 
	}
}

196 
	$fœ¡»ad
()

198 
off_t
 
pos
;

200 
pos
 = 
	`l£ek
(
dœfd
, 0, 
SEEK_CUR
);

201 ià(
pos
 < 0) {

202 
	`”r
(1, ".:†seek(0, SEEK_CUR)");

204 ià(
pos
 != 0) {

205 
	`”rx
(1, ".: File…osition‡fter open‚ot 0");

208 
	`´štf
("Scanning directory...\n");

210 
	`»ad™
();

211 
	}
}

215 
	$dÜ—d©0
()

217 
off_t
 
pos
;

219 
	`´štf
("Rewinding directory‡nd„eading it‡gain...\n");

221 
pos
 = 
	`l£ek
(
dœfd
, 0, 
SEEK_SET
);

222 ià(
pos
 < 0) {

223 
	`”r
(1, ".:†seek(0, SEEK_SET)");

225 ià(
pos
 != 0) {

226 
	`”rx
(1, ".:†£ek(0, SEEK_SETè»tuºed %ld", (è
pos
);

229 
	`»ad™
();

230 
	}
}

234 
	$»adÚe
(cÚ¡ *
shouldbe
)

236 
buf
[4096];

237 
Ën
;

239 
Ën
 = 
	`g‘dœ’Œy
(
dœfd
, 
buf
, (buf)-1);

240 ià(
Ën
 < 0) {

241 
	`”r
(1, ".: getdirentry");

243 ià(()
Ën
 >ğ(
buf
)-1) {

244 
	`”rx
(1, ".: g‘dœ’Œy„‘uºed inv®id†’gth %d", 
Ën
);

246 
buf
[
Ën
] = 0;

248 ià(
	`¡rcmp
(
buf
, 
shouldbe
)) {

249 
	`”rx
(1, ".: getdirentry„eturned %s (expected %s)",

250 
buf
, 
shouldbe
);

252 
	}
}

256 
	$dÜ—dÚe
(
which
)

258 
off_t
 
pos
;

259 
pos
 = 
	`l£ek
(
dœfd
, 
‹¡fes
[
which
].pos, 
SEEK_SET
);

260 ià(
pos
<0) {

261 
	`”r
(1, ".:†£ek(%ld, SEEK_SET)", (è
‹¡fes
[
which
].
pos
);

263 ià(
pos
 !ğ
‹¡fes
[
which
].pos) {

264 
	`”rx
(1, ".:†seek(%ld, SEEK_SET)„eturned %ld",

265 (è
‹¡fes
[
which
].
pos
, ()…os);

268 
	`»adÚe
(
‹¡fes
[
which
].
Çme
);

269 
	}
}

273 
	$»ad®lÚebyÚe
()

275 
i
;

277 
	`´štf
("Tryingo„eadƒachƒntry‡gain...\n");

278 
i
=0; 
‹¡fes
[i].
Çme
; i++) {

279 
	`dÜ—dÚe
(
i
);

281 
	}
}

285 
	$»ad®Ìªdomly
()

287 
n
, 
i
, 
x
;

289 
	`´štf
("Tryingo„ead‡ bunch ofƒntries„andomly...\n");

291 
i
=0; 
‹¡fes
[i].
Çme
; i++);

292 
n
 = 
i
;

294 
	`¤ªdom
(39584);

295 
i
=0; i<512; i++) {

296 
x
 = ()(
	`¿ndom
()%
n
);

297 
	`dÜ—dÚe
(
x
);

299 
	}
}

303 
	$»ad©eof
()

305 
buf
[4096];

306 
Ën
;

308 
Ën
 = 
	`g‘dœ’Œy
(
dœfd
, 
buf
, (buf)-1);

309 ià(
Ën
 < 0) {

310 
	`”r
(1, ".:‡t EOF: getdirentry");

312 ià(
Ën
==0) {

315 ià(()
Ën
 >ğ(
buf
)-1) {

316 
	`”rx
(1, ".:‡t EOF: getdirentry„eturned "

317 "šv®id†’gth %d", 
Ën
);

319 
buf
[
Ën
] = 0;

320 
	`”rx
(1, ".:‡ˆEOF: gÙ uÃx³ùed‚am%s", 
buf
);

321 
	}
}

325 
	$dÜ—d©eof
()

327 
off_t
 
pos
;

328 
i
;

330 
	`´štf
("Tryingo„ead‡fter goingo EOF...\n");

332 
pos
 = 
	`l£ek
(
dœfd
, 0, 
SEEK_END
);

333 ià(
pos
<0) {

334 
	`”r
(1, ".:†seek(0, SEEK_END)");

337 
i
=0; 
‹¡fes
[i].
Çme
; i++) {

338 ià(
pos
 <ğ
‹¡fes
[
i
].pos) {

339 
	`”rx
(1, ".: EOF…osition %ld below…osition %ld of %s",

340 
pos
, 
‹¡fes
[
i
].pos,e¡fes[i].
Çme
);

344 
	`»ad©eof
();

345 
	}
}

349 
	$šv®_»ad
()

351 
buf
[4096];

352 
Ën
;

354 
Ën
 = 
	`g‘dœ’Œy
(
dœfd
, 
buf
, (buf)-1);

357 ()
Ën
;

358 
	}
}

362 
	$dobad»ads
()

364 
off_t
 
pos
, 
pos2
, 
eof
;

365 
v®id
, 
i
, 
k
=0;

367 
	`´štf
("Trying some…ossibly invalid„eads...\n");

369 
eof
 = 
	`l£ek
(
dœfd
, 0, 
SEEK_END
);

370 ià(
eof
 < 0) {

371 
	`”r
(1, ".:†seek(0, SEEK_END)");

374 
pos
=0;…o < 
eof
;…os++) {

375 
v®id
 = 0;

376 
i
=0; 
‹¡fes
[i].
Çme
; i++) {

377 ià(
pos
==
‹¡fes
[
i
].pos) {

378 
v®id
 = 1;

381 ià(
v®id
) {

386 
pos2
 = 
	`l£ek
(
dœfd
, 
pos
, 
SEEK_SET
);

387 ià(
pos2
 < 0) {

391 
	`šv®_»ad
();

392 
k
++;

396 ià(
k
>0) {

397 
	`´štf
("Survived %d inv®id„—ds...\n", 
k
);

400 
	`´štf
("Couldn't find‡ny invalid offsetsory...\n");

403 
	`´štf
("Tryingo„ead beyond EOF...\n");

404 
pos2
 = 
	`l£ek
(
dœfd
, 
eof
 + 1000, 
SEEK_SET
);

405 ià(
pos2
 < 0) {

409 
	`šv®_»ad
();

411 
	}
}

415 
	$dÙe¡
()

417 
	`´štf
("Opening directory...\n");

418 
	`İ’™
();

420 
	`´štf
("Runningests...\n");

423 
	`fœ¡»ad
();

426 
	`»ad©eof
();

429 
	`»ad®lÚebyÚe
();

432 
	`dÜ—d©eof
();

435 
	`»ad®Ìªdomly
();

438 
	`dÜ—d©0
();

441 
	`dobad»ads
();

444 
	`dÜ—d©0
();

446 
	`´štf
("Closing directory...\n");

447 
	`şo£™
();

448 
	}
}

456 
	$mkfe
(cÚ¡ *
Çme
)

458 
fd
, 
i
, 
r
;

459 cÚ¡ 
mes§ge
[] = "Theurtle moves!\n";

460 
buf
[32*(
mes§ge
)+1];

462 
buf
[0]=0;

463 
i
=0; i<32; i++) {

464 
	`¡rÿt
(
buf
, 
mes§ge
);

468 
fd
 = 
	`İ’
(
Çme
, 
O_WRONLY
|
O_CREAT
|
O_EXCL
, 0664);

469 ià(
fd
<0) {

470 
	`”r
(1, "%s: c»©e", 
Çme
);

473 
r
 = 
	`wr™e
(
fd
, 
buf
, 
	`¡¾’
(buf));

474 ià(
r
<0) {

475 
	`”r
(1, "%s: wr™e", 
Çme
);

477 ià(()
r
 !ğ
	`¡¾’
(
buf
)) {

478 
	`”rx
(1, "%s: shÜˆwr™(%d by‹s)", 
Çme
, 
r
);

481 ià(
	`şo£
(
fd
)<0) {

482 
	`”r
(1, "%s: clo£", 
Çme
);

484 
	}
}

488 
	$£tup
()

490 
i
;

492 
	`´štf
("Makšg dœeùÜy %s...\n", 
TESTDIR
);

495 ià(
	`mkdœ
(
TESTDIR
, 0775)<0) {

496 
	`”r
(1, "%s: mkdœ", 
TESTDIR
);

500 ià(
	`chdœ
(
TESTDIR
)<0) {

501 
	`”r
(1, "%s: chdœ", 
TESTDIR
);

504 
	`´štf
("Making some files...\n");

507 
i
=0; 
‹¡fes
[i].
Çme
; i++) {

508 ià(
‹¡fes
[
i
].
make_™
) {

509 
	`mkfe
(
‹¡fes
[
i
].
Çme
);

511 
‹¡fes
[
i
].
pos
 = -1;

513 
	}
}

517 
	$ş—nup
()

519 
i
;

521 
	`´štf
("Cleaning up...\n");

524 
i
=0; 
‹¡fes
[i].
Çme
; i++) {

525 ià(
‹¡fes
[
i
].
make_™
) {

526 ià(
	`»move
(
‹¡fes
[
i
].
Çme
)<0) {

527 
	`”r
(1, "%s:„emove", 
‹¡fes
[
i
].
Çme
);

533 ià(
	`chdœ
("..")<0) {

534 
	`”r
(1, "..: chdir");

538 ià(
	`rmdœ
(
TESTDIR
)<0) {

539 
	`”r
(1, "%s:„mdœ", 
TESTDIR
);

541 
	}
}

545 
	$maš
()

547 
	`£tup
();

550 
	`dÙe¡
();

551 
	`dÙe¡
();

553 
	`ş—nup
();

555 
	}
}

	@dirtest/dirtest.c

42 
	~<sys/ty³s.h
>

43 
	~<sys/¡©.h
>

44 
	~<¡dio.h
>

45 
	~<uni¡d.h
>

46 
	~<¡ršg.h
>

47 
	~<”r.h
>

49 
	#MAXLEVELS
 5

	)

52 
	$maš
()

54 
i
;

55 cÚ¡ *
Ú’ame
 = "testdir";

56 
dœÇme
[512];

58 
	`¡rıy
(
dœÇme
, 
Ú’ame
);

60 
i
=0; i<
MAXLEVELS
; i++) {

61 
	`´štf
("C»©šg dœeùÜy: %s\n", 
dœÇme
);

63 ià(
	`mkdœ
(
dœÇme
, 0755)) {

64 
	`”r
(1, "%s: mkdœ", 
dœÇme
);

67 
	`¡rÿt
(
dœÇme
, "/");

68 
	`¡rÿt
(
dœÇme
, 
Ú’ame
);

71 
	`´štf
("Passed directory creationest.\n");

73 
i
=0; i<
MAXLEVELS
; i++) {

74 
dœÇme
[
	`¡¾’
(dœÇmeè- sŒËn(
Ú’ame
) - 1] = 0;

76 
	`´štf
("Removšg dœeùÜy: %s\n", 
dœÇme
);

78 ià(
	`rmdœ
(
dœÇme
)) {

79 
	`”r
(1, "%s:„mdœ", 
dœÇme
);

82 
	`´štf
("Passed directory„emovalest.\n");

85 
	}
}

	@f_test/f_hdr.h

30 
sub´oc_»ad
();

31 
sub´oc_wr™e
();

	@f_test/f_read.c

44 
	#SeùÜSize
 512

	)

46 
	#TMULT
 50

	)

47 
	#FSIZE
 ((
SeùÜSize
 + 1è* 
TMULT
)

	)

49 
	#FNAME
 "f-‹¡fe"

	)

50 
	#READCHAR
 'r'

	)

51 
	#WRITECHAR
 'w'

	)

53 
	~<¡dio.h
>

54 
	~<uni¡d.h
>

55 
	~<”r.h
>

56 
	~"f_hdr.h
"

58 
	gbufãr
[
SeùÜSize
 + 1];

62 
	$check_bufãr
()

64 
i
;

65 
ch
 = 
bufãr
[0];

67 
i
 = 1; i < 
SeùÜSize
 + 1; i++) {

68 ià(
bufãr
[
i
] !ğ
ch
) {

69 
	`”rx
(1, "R—dƒ¼Ü: %s", 
bufãr
);

73 
	`putch¬
(
ch
);

74 
	}
}

77 
	$sub´oc_»ad
()

79 
fd
;

80 
i
, 
»s
;

82 
	`´štf
("File Reader starting ...\n\n");

84 
fd
 = 
	`İ’
(
FNAME
, 
O_RDONLY
);

85 ià(
fd
 < 0) {

86 
	`”r
(1, "%s: o³n", 
FNAME
);

89 
i
=0; i<
TMULT
; i++) {

90 
»s
 = 
	`»ad
(
fd
, 
bufãr
, 
SeùÜSize
 + 1);

91 ià(
»s
 < 0) {

92 
	`”r
(1, "%s:„—d", 
FNAME
);

97 ià(
»s
 !ğ
SeùÜSize
 + 1) {

98 
	`”rx
(1, "%s:„—d: shÜˆcouÁ", 
FNAME
);

100 
	`check_bufãr
();

103 
	`şo£
(
fd
);

105 
	`´štf
("File Readƒxited successfully!\n");

106 
	}
}

	@f_test/f_test.c

43 
	~<sys/ty³s.h
>

44 
	~<sys/¡©.h
>

45 
	~<¡dio.h
>

46 
	~<¡ršg.h
>

47 
	~<uni¡d.h
>

48 
	~<”r.h
>

49 
	~"f_hdr.h
"

51 
	#SECTOR_SIZE
 512

	)

54 
	#BUFFER_SIZE
 (2 * 
SECTOR_SIZE
 + 1)

	)

55 
	#BIGFILE_SIZE
 (270 * 
BUFFER_SIZE
)

	)

56 
	#BIGFILE_NAME
 "Ïrge-f"

	)

58 
	#LETTER
(
x
è('a' + (x % 31))

	)

60 
	gfbufãr
[
BUFFER_SIZE
];

61 
	gibufãr
[32];

64 
	#DIR_DEPTH
 8

	)

65 
	#DIR_NAME
 "/t"

	)

66 
	#DIRFILE_NAME
 "a"

	)

69 
	#FNAME
 "f-‹¡fe"

	)

70 
	#TMULT
 50

	)

71 
	#FSIZE
 ((
SECTOR_SIZE
 + 1è* 
TMULT
)

	)

73 
	#READCHAR
 'r'

	)

74 
	#WRITECHAR
 'w'

	)

76 
	gcbufãr
[
SECTOR_SIZE
 + 1];

84 
pid_t


85 
fÜkoff
((*
func
)())

87 
pid_t
 
pid
 = 
	`fÜk
();

88 
pid
) {

90 
	`w¬n
("fork");

93 
	`func
();

94 
	`_ex™
(0);

97  
pid
;

98 
	}
}

102 
	$dowa™
(
pid
)

104 
¡©us
;

106 ià(
	`wa™pid
(
pid
, &
¡©us
, 0)<0) {

107 
	`w¬n
("wa™pid fÜ %d", 
pid
);

109 ià(
	`WIFSIGNALED
(
¡©us
)) {

110 
	`w¬nx
("pid %d: sigÇÈ%d", 
pid
, 
	`WTERMSIG
(
¡©us
));

112 ià(
	`WEXITSTATUS
(
¡©us
) != 0) {

113 
	`w¬nx
("pid %d:ƒx™ %d", 
pid
, 
	`WEXITSTATUS
(
¡©us
));

115 
	}
}

123 
	$big_fe
(
size
)

125 
i
, 
j
, 
feid
;

127 
	`´štf
("[BIGFILE]est starting :\n");

128 
	`´štf
("\tC»©šg‡ foàsize: %d\n", 
size
);

130 
feid
 = 
	`İ’
(
BIGFILE_NAME
, 
O_WRONLY
|
O_CREAT
|
O_TRUNC
, 0664);

131 ià(
feid
 < 0) {

132 
	`”r
(1, "[BIGFILE]: %s: o³ÀfÜ wr™e", 
BIGFILE_NAME
);

135 
i
 = 0; i < 
BUFFER_SIZE
; i++) {

136 
fbufãr
[
i
] = 
	`LETTER
(i);

139 
	`´štf
("\tWritingo file.\n");

140 
i
 = 0; i < 
size
; i +ğ
BUFFER_SIZE
) {

141 
	`wr™e
(
feid
, 
fbufãr
, 
BUFFER_SIZE
);

143 ià(!(
i
 % (10 * 
BUFFER_SIZE
))) {

144 
	`´štf
("\rBW : %d", 
i
);

148 
	`´štf
("\n\tReading from file.\n");

149 
	`şo£
(
feid
);

151 
feid
 = 
	`İ’
(
BIGFILE_NAME
, 
O_RDONLY
);

152 ià(
feid
 < 0) {

153 
	`”r
(1, "[BIGFILE]: %s: o³ÀfÜ„—d", 
BIGFILE_NAME
);

156 
i
 = 0; i < 
size
; i +ğ
BUFFER_SIZE
) {

157 
j
 = 
	`»ad
(
feid
, 
fbufãr
, 
BUFFER_SIZE
);

158 ià(
j
<0) {

159 
	`”r
(1, "[BIGFILE]:„ead");

161 ià(
j
 !ğ
BUFFER_SIZE
) {

162 
	`”rx
(1, "[BIGFILE]:„—d: oÆy %d by‹s", 
j
);

166 ià(!(
i
 % (10 * 
BUFFER_SIZE
))) {

167 
	`´štf
("\rBR : %d", 
i
);

171 
j
 = 0; j < 
BUFFER_SIZE
; j++) {

172 ià(
fbufãr
[
j
] !ğ
	`LETTER
(j)) {

173 
	`”rx
(1, "[BIGFILE] : Failed„ead check : "

174 "šcÚsi¡’ˆd©¨»ad: %d", 
i
+
j
);

179 
	`şo£
(
feid
);

180 ià(
	`»move
(
BIGFILE_NAME
)) {

181 
	`”r
(1, "[BIGFILE]: %s:„emove", 
BIGFILE_NAME
);

184 
	`´štf
("\n[BIGFILE] : Success!\n");

185 
	}
}

193 
	$cÚcur
()

195 
i
, 
fd
;

196 
r1
, 
r2
, 
w1
;

198 
	`´štf
("Spawning 2„eaders, 1 writer.\n");

201 
fd
 = 
	`İ’
(
FNAME
, 
O_WRONLY
|
O_CREAT
|
O_TRUNC
, 0664);

202 ià(
fd
 < 0) {

203 
	`”r
(1, "[CONCUR]: %s: o³n", 
FNAME
);

206 
	`´štf
("Initializingest file: ");

208 
i
 = 0; i < 
SECTOR_SIZE
 + 1; i++) {

209 
cbufãr
[
i
] = 
READCHAR
;

212 
i
 = 0; i < 
TMULT
; i++) {

213 
	`wr™e
(
fd
, 
cbufãr
, 
SECTOR_SIZE
 + 1);

217 
	`şo£
(
fd
);

219 
	`´štf
("Done initializing. Starting…rocesses...\n");

221 
r1
 = 
	`fÜkoff
(
sub´oc_»ad
);

222 
w1
 = 
	`fÜkoff
(
sub´oc_wr™e
);

223 
r2
 = 
	`fÜkoff
(
sub´oc_»ad
);

225 
	`´štf
("Waiting for…rocesses.\n");

227 
	`dowa™
(
r1
);

228 
	`dowa™
(
r2
);

229 
	`dowa™
(
w1
);

231 ià(
	`»move
(
FNAME
)) {

232 
	`”r
(1, "[CONCUR]: %s:„emove", 
FNAME
);

235 
	`´štf
("[CONCUR] Done!\n");

236 
	}
}

244 
	$dœ_‹¡
(
d•th
)

246 
i
, 
fd
;

247 
tmp
[] = 
DIR_NAME
;

248 
fmp
[] = 
DIRFILE_NAME
;

249 
dœÇme
[64];

251 
	`¡rıy
(
dœÇme
, ".");

253 
i
 = 0; i < 
d•th
; i++) {

254 
	`¡rÿt
(
dœÇme
, 
tmp
);

256 
	`´štf
("\tC»©šg dœ : %s\n", 
dœÇme
);

258 ià(
	`mkdœ
(
dœÇme
, 0775) < 0) {

259 
	`”r
(1, "[DIRTEST]: %s: mkdœ", 
dœÇme
);

262 
	`¡rÿt
(
dœÇme
, 
fmp
);

263 
	`´štf
("\tC»©šg fe: %s\n", 
dœÇme
);

265 
fd
 = 
	`İ’
(
dœÇme
, 
O_WRONLY
|
O_CREAT
|
O_TRUNC
, 0664);

266 ià(
fd
<0) {

267 
	`”r
(1, "[DIRTEST]: %s: o³n", 
dœÇme
);

270 
dœÇme
[
	`¡¾’
(dœÇmeè- sŒËn(
fmp
)] = '\0';

273 
	`´štf
("[DIRTEST] : Passed directory creationest.\n");

275 
i
 = 0; i < 
d•th
; i++) {

276 
	`¡rÿt
(
dœÇme
, 
fmp
);

278 
	`´štf
("\tD–‘šg fe: %s\n", 
dœÇme
);

280 ià(
	`»move
(
dœÇme
)) {

281 
	`”r
(1, "[DIRTEST]: %s:„emove", 
dœÇme
);

284 
dœÇme
[
	`¡¾’
(dœÇmeè- sŒËn(
fmp
)] = '\0';

285 
	`´štf
("\tRemovšg dœ : %s\n", 
dœÇme
);

287 ià(
	`rmdœ
(
dœÇme
)) {

288 
	`”r
(1, "[DIRTEST]: %s:„mdœ", 
dœÇme
);

291 
dœÇme
[
	`¡¾’
(dœÇmeè- sŒËn(
tmp
)] = '\0';

294 
	`´štf
("[DIRTEST] : Passed directory„emovalest.\n");

295 
	`´štf
("[DIRTEST] : Success!\n");

296 
	}
}

302 
	#RUNBIGFILE
 0x1

	)

303 
	#RUNDIRTEST
 0x2

	)

304 
	#RUNCONCUR
 0x4

	)

305 
	#RUNTHEMALL
 (
RUNBIGFILE
 | 
RUNDIRTEST
 | 
RUNCONCUR
)

	)

308 
	$maš
(
¬gc
, * 
¬gv
[])

310 
tv
 = 0;

312 ià(
¬gc
 > 1) {

313 ià(*
¬gv
[1]=='1') {

314 
tv
 = 
RUNBIGFILE
;

316 ià(*
¬gv
[1]=='2') {

317 
tv
 = 
RUNDIRTEST
;

319 ià(*
¬gv
[1]=='3') {

320 
tv
 = 
RUNCONCUR
;

324 
tv
 = 
RUNTHEMALL
;

327 ià(
tv
 & 
RUNBIGFILE
) {

328 
	`´štf
("[BIGFILE] : Run #1\n");

329 
	`big_fe
(
BIGFILE_SIZE
);

330 
	`´štf
("[BIGFILE] : Run #2\n");

331 
	`big_fe
(
BIGFILE_SIZE
);

334 ià(
tv
 & 
RUNDIRTEST
) {

335 
	`´štf
("[DIRTEST] : Run #1\n");

336 
	`dœ_‹¡
(
DIR_DEPTH
);

337 
	`´štf
("[DIRTEST] : Run #2\n");

338 
	`dœ_‹¡
(
DIR_DEPTH
);

341 ià(
tv
 & 
RUNCONCUR
) {

342 
	`´štf
("[CONCUR]\n");

343 
	`cÚcur
();

346 
	}
}

	@f_test/f_write.c

44 
	#SeùÜSize
 512

	)

46 
	#TMULT
 50

	)

47 
	#FSIZE
 ((
SeùÜSize
 + 1è* 
TMULT
)

	)

49 
	#FNAME
 "f-‹¡fe"

	)

50 
	#READCHAR
 'r'

	)

51 
	#WRITECHAR
 'w'

	)

53 
	~<uni¡d.h
>

54 
	~<¡dio.h
>

55 
	~<”r.h
>

56 
	~"f_hdr.h
"

58 
	gbufãr
[
SeùÜSize
 + 1];

61 
	$sub´oc_wr™e
()

63 
fd
;

64 
i
;

66 
i
=0; i < 
SeùÜSize
 + 1; i++) {

67 
bufãr
[
i
] = 
WRITECHAR
;

70 
	`´štf
("File Writer starting ...\n");

72 
fd
 = 
	`İ’
(
FNAME
, 
O_WRONLY
);

73 ià(
fd
 < 0) {

74 
	`”r
(1, "%s: o³n", 
FNAME
);

77 
i
=0; i<
TMULT
; i++) {

79 
	`wr™e
(
fd
, 
bufãr
, 
SeùÜSize
 + 1);

82 
	`şo£
(
fd
);

84 
	`´štf
("File Writeƒxited successfully!\n");

85 
	}
}

	@farm/farm.c

40 
	~<uni¡d.h
>

41 
	~<”r.h
>

43 *
	gh¬gv
[2] = { (*)"hog", 
NULL
 };

44 *
	gÿrgv
[3] = { (*)"ÿt", (*)"ÿtfe", 
NULL
 };

46 
	#MAXPROCS
 6

	)

47 
	gpids
[
MAXPROCS
], 
	gÅids
;

51 
	$¥awnv
(cÚ¡ *
´og
, **
¬gv
)

53 
pid
 = 
	`fÜk
();

54 
pid
) {

56 
	`”r
(1, "fork");

59 
	`execv
(
´og
, 
¬gv
);

60 
	`”r
(1, "%s", 
´og
);

63 
pids
[
Åids
++] = 
pid
;

66 
	}
}

70 
	$wa™®l
()

72 
i
, 
¡©us
;

73 
i
=0; i<
Åids
; i++) {

74 ià(
	`wa™pid
(
pids
[
i
], &
¡©us
, 0)<0) {

75 
	`w¬n
("wa™pid fÜ %d", 
pids
[
i
]);

77 ià(
	`WIFSIGNALED
(
¡©us
)) {

78 
	`w¬nx
("pid %d: sigÇÈ%d", 
pids
[
i
], 
	`WTERMSIG
(
¡©us
));

80 ià(
	`WEXITSTATUS
(
¡©us
) != 0) {

81 
	`w¬nx
("pid %d:ƒx™ %d", 
pids
[
i
], 
	`WEXITSTATUS
(
¡©us
));

84 
	}
}

88 
	$hog
()

90 
	`¥awnv
("/‹¡bš/hog", 
h¬gv
);

91 
	}
}

95 
	$ÿt
()

97 
	`¥awnv
("/bš/ÿt", 
ÿrgv
);

98 
	}
}

101 
	$maš
()

103 
	`hog
();

104 
	`hog
();

105 
	`hog
();

106 
	`ÿt
();

108 
	`wa™®l
();

111 
	}
}

	@faulter/faulter.c

39 
	~<¡dio.h
>

41 
	#REALLY_BIG_ADDRESS
 0x40000000

	)

44 
	$maš
()

46 vŞ©
i
;

48 
	`´štf
("\nEnteringhe faulter…rogram - I should die immediately\n");

49 
i
 = *(*)
REALLY_BIG_ADDRESS
;

50 
	`´štf
("I didn't get killed! Program has‡ bug\n");

52 
	}
}

	@filetest/filetest.c

41 
	~<¡dio.h
>

42 
	~<¡ršg.h
>

43 
	~<uni¡d.h
>

44 
	~<”r.h
>

47 
	$maš
(
¬gc
, *
¬gv
[])

49 
wr™ebuf
[40] = "Twiddle dee dee, Twiddle dum dum.......\n";

50 
»adbuf
[41];

52 
fd
, 
rv
;

54 ià(
¬gc
!=2) {

55 
	`”rx
(1, "Usage: filetest <filename>");

58 
fd
 = 
	`İ’
(
¬gv
[1], 
O_WRONLY
|
O_CREAT
|
O_TRUNC
, 0664);

59 ià(
fd
<0) {

60 
	`”r
(1, "%s: o³ÀfÜ wr™e", 
¬gv
[1]);

64 
rv
 = 
	`wr™e
(
fd
, 
wr™ebuf
, 40);

65 ià(
rv
<0) {

66 
	`”r
(1, "%s: wr™e", 
¬gv
[1]);

69 
rv
 = 
	`şo£
(
fd
);

70 ià(
rv
<0) {

71 
	`”r
(1, "%s: clo£ (1¡ime)", 
¬gv
[1]);

74 
fd
 = 
	`İ’
(
¬gv
[1], 
O_RDONLY
);

75 ià(
fd
<0) {

76 
	`”r
(1, "%s: o³ÀfÜ„—d", 
¬gv
[1]);

79 
rv
 = 
	`»ad
(
fd
, 
»adbuf
, 40);

80 ià(
rv
<0) {

81 
	`”r
(1, "%s:„—d", 
¬gv
[1]);

83 
rv
 = 
	`şo£
(
fd
);

84 ià(
rv
<0) {

85 
	`”r
(1, "%s: clo£ (2ndime)", 
¬gv
[1]);

88 
»adbuf
[40] = 0;

90 ià(
	`¡rcmp
(
»adbuf
, 
wr™ebuf
)) {

91 
	`”rx
(1, "Buffer data mismatch!");

94 
rv
 = 
	`»move
(
¬gv
[1]);

95 ià(
rv
<0) {

96 
	`”r
(1, "%s:„emove", 
¬gv
[1]);

98 
	`´štf
("Passed filetest.\n");

100 
	}
}

	@forkbomb/forkbomb.c

50 
	~<uni¡d.h
>

51 
	~<”r.h
>

53 vŞ©
	gpid
;

56 
	$maš
()

58 
i
;

61 
	`fÜk
();

63 
pid
 = 
	`g‘pid
();

66 
i
=0; i<300; i++) {

67 vŞ©
£’pid
;

68 
£’pid
 = 
pid
;

69 ià(
£’pid
 !ğ
	`g‘pid
()) {

70 
	`”rx
(1, "pid mismatch (%d, should be %d) "

72 
£’pid
, 
	`g‘pid
());

76 
	}
}

	@forktest/forktest.c

39 
	~<uni¡d.h
>

40 
	~<¡ršg.h
>

41 
	~<¡dlib.h
>

42 
	~<¡dio.h
>

43 
	~<”r.h
>

49 vŞ©
	gmypid
;

56 
	$dofÜk
()

58 
pid
;

59 
pid
 = 
	`fÜk
();

60 ià(
pid
 < 0) {

61 
	`w¬n
("fork");

63  
pid
;

64 
	}
}

73 
	$check
()

75 
i
;

77 
mypid
 = 
	`g‘pid
();

80 
i
=0; i<800; i++) {

81 vŞ©
£’pid
;

82 
£’pid
 = 
mypid
;

83 ià(
£’pid
 !ğ
	`g‘pid
()) {

84 
	`”rx
(1, "pid mismatch (%d, should be %d) "

86 
£’pid
, 
	`g‘pid
());

89 
	}
}

102 
	$dowa™
(
nowa™
, 
pid
)

104 
x
;

106 ià(
pid
<0) {

110 ià(
pid
==0) {

112 
	`ex™
(0);

115 ià(!
nowa™
) {

116 ià(
	`wa™pid
(
pid
, &
x
, 0)<0) {

117 
	`w¬n
("waitpid");

119 ià(
	`WIFSIGNALED
(
x
)) {

120 
	`w¬nx
("pid %d: sigÇÈ%d", 
pid
, 
	`WTERMSIG
(
x
));

122 ià(
	`WEXITSTATUS
(
x
) != 0) {

123 
	`w¬nx
("pid %d:ƒx™ %d", 
pid
, 
	`WEXITSTATUS
(
x
));

126 
	}
}

133 
	$‹¡
(
nowa™
)

135 
pid0
, 
pid1
, 
pid2
, 
pid3
;

144 
pid0
 = 
	`dofÜk
();

145 
	`putch¬
('0');

146 
	`check
();

147 
pid1
 = 
	`dofÜk
();

148 
	`putch¬
('1');

149 
	`check
();

150 
pid2
 = 
	`dofÜk
();

151 
	`putch¬
('2');

152 
	`check
();

153 
pid3
 = 
	`dofÜk
();

154 
	`putch¬
('3');

155 
	`check
();

161 
	`dowa™
(
nowa™
, 
pid3
);

162 
	`dowa™
(
nowa™
, 
pid2
);

163 
	`dowa™
(
nowa™
, 
pid1
);

164 
	`dowa™
(
nowa™
, 
pid0
);

166 
	`putch¬
('\n');

167 
	}
}

170 
	$maš
(
¬gc
, *
¬gv
[])

172 
nowa™
=0;

174 ià(
¬gc
==2 && !
	`¡rcmp
(
¬gv
[1], "-w")) {

175 
nowa™
=1;

177 ià(
¬gc
!=1 &&‡rgc!=0) {

178 
	`w¬nx
("usage: forktest [-w]");

181 
	`w¬nx
("Starting.");

183 
	`‹¡
(
nowa™
);

185 
	`w¬nx
("Complete.");

187 
	}
}

	@guzzle/guzzle.c

37 
	~<¡dio.h
>

38 
	~<uni¡d.h
>

40 
	#TOP
 1<<25

	)

46 
	$maš
(
¬gc
, *
¬gv
[])

48 vŞ©
i
;

49 
ch
 = '+';

51 ià(
¬gc
 == 2) {

52 
ch
 = 
¬gv
[1][0];

55 
i
=0; i<
TOP
; i++) {

57 iàĞ(
i
%10000) == 0) {

58 
	`putch¬
(
ch
);

62 
	}
}

	@hash/hash.c

41 
	~<¡dio.h
>

42 
	~<uni¡d.h
>

43 
	~<fú.h
>

44 
	~<”r.h
>

46 #ifdeà
HOST


47 
	~"ho¡com·t.h
"

50 
	#HASHP
 104729

	)

53 
	$maš
(
¬gc
, *
¬gv
[])

55 
fd
;

56 
»adbuf
[1];

57 
j
 = 0;

59 #ifdeà
HOST


60 
	`ho¡com·t_š™
(
¬gc
, 
¬gv
);

63 ià(
¬gc
 != 2) {

64 
	`”rx
(1, "Usage: hash filename");

67 
fd
 = 
	`İ’
(
¬gv
[1], 
O_RDONLY
, 0664);

69 ià(
fd
<0) {

70 
	`”r
(1, "%s", 
¬gv
[1]);

74 ià(
	`»ad
(
fd
, 
»adbuf
, 1) <= 0) ;

75 
j
 = ((j*8è+ (è
»adbuf
[0]è% 
HASHP
;

78 
	`şo£
(
fd
);

80 
	`´štf
("Hash : %d\n", 
j
);

83 
	}
}

	@hog/hog.c

38 
	$maš
()

40 vŞ©
i
;

42 
i
=0; i<50000; i++)

46 
	}
}

	@huge/huge.c

40 
	~<¡dio.h
>

41 
	~<¡dlib.h
>

43 
	#PageSize
 4096

	)

44 
	#NumPages
 512

	)

46 
	g¥¬£
[
NumPages
][
PageSize
];

49 
	$maš
()

51 
i
,
j
;

53 
	`´štf
("Enteringhe huge…rogram - I will stressest your VM\n");

56 
i
=0; i<
NumPages
; i++) {

57 
¥¬£
[
i
][0]=i;

60 
	`´štf
("stage [1] done\n");

63 
j
=0; j<5; j++) {

64 
i
=0; i<
NumPages
; i++) {

65 
¥¬£
[
i
][0]++;

67 
	`´štf
("¡ag[2.%d] dÚe\n", 
j
);

70 
	`´štf
("stage [2] done\n");

73 
i
=
NumPages
-1; i>=0; i--) {

74 ià(
¥¬£
[
i
][0]!=i+5) {

75 
	`´štf
("BAD NEWS!!! - your VM mechanism has‡ bug!\n");

76 
	`ex™
(1);

80 
	`´štf
("You…assed!\n");

83 
	}
}

	@kitchen/kitchen.c

38 
	~<uni¡d.h
>

39 
	~<”r.h
>

41 *
	g§rgv
[2] = { (*)"sšk", 
NULL
 };

43 
	#MAXPROCS
 6

	)

44 
	gpids
[
MAXPROCS
], 
	gÅids
;

48 
	$sšk
()

50 
pid
 = 
	`fÜk
();

51 
pid
) {

53 
	`”r
(1, "fork");

56 
	`execv
("/‹¡bš/sšk", 
§rgv
);

57 
	`”r
(1, "/testbin/sink");

60 
pids
[
Åids
++] = 
pid
;

63 
	}
}

67 
	$wa™®l
()

69 
i
, 
¡©us
;

70 
i
=0; i<
Åids
; i++) {

71 ià(
	`wa™pid
(
pids
[
i
], &
¡©us
, 0)<0) {

72 
	`w¬n
("wa™pid fÜ %d", 
pids
[
i
]);

74 ià(
	`WIFSIGNALED
(
¡©us
)) {

75 
	`w¬nx
("pid %d: sigÇÈ%d", 
pids
[
i
], 
	`WTERMSIG
(
¡©us
));

77 ià(
	`WEXITSTATUS
(
¡©us
) != 0) {

78 
	`w¬nx
("pid %d:ƒx™ %d", 
pids
[
i
], 
	`WEXITSTATUS
(
¡©us
));

81 
	}
}

85 
	$maš
()

87 
	`sšk
();

88 
	`sšk
();

89 
	`sšk
();

90 
	`sšk
();

92 
	`wa™®l
();

95 
	}
}

	@malloctest/malloctest.c

40 
	~<¡dšt.h
>

41 
	~<¡dio.h
>

42 
	~<¡dlib.h
>

43 
	~<uni¡d.h
>

44 
	~<fú.h
>

45 
	~<”r.h
>

48 
	#_PATH_RANDOM
 "¿ndom:"

	)

50 
	#SMALLSIZE
 72

	)

51 
	#MEDIUMSIZE
 896

	)

52 
	#BIGSIZE
 16384

	)

53 
	#HUGESIZE
 (1024 * 1024 * 1024)

	)

56 
	#OVERHEAD
 32

	)

59 
	#ABSURD_OVERHEAD
 256

	)

63 
	$g‘i
()

65 
v®
=0;

66 
ch
, 
dig™s
=0;

69 
ch
 = 
	`g‘ch¬
();

70 ià(
ch
=='\n' || ch=='\r') {

71 
	`putch¬
('\n');

74 ià((
ch
=='\b' || ch==127è&& 
dig™s
>0) {

75 
	`´štf
("\b \b");

76 
v®
 = val/10;

77 
dig™s
--;

79 ià(
ch
>='0' && ch<='9') {

80 
	`putch¬
(
ch
);

81 
v®
 = v®*10 + (
ch
-'0');

82 
dig™s
++;

85 
	`putch¬
('\a');

89 ià(
dig™s
==0) {

92  
v®
;

93 
	}
}

102 
	$m¬kblock
(vŞ©*
±r
, 
size_t
 
size
, 
bŸs
, 
dİršt
)

104 
size_t
 
n
, 
i
;

105 *
¶
;

106 
v®
;

108 
¶
 = (*)
±r
;

109 
n
 = 
size
 / ();

111 
i
=0; i<
n
; i++) {

112 
v®
 = (()
i
 ^ ()
bŸs
);

113 
¶
[
i
] = 
v®
;

114 ià(
dİršt
 && (
i
%64==63)) {

115 
	`´štf
(".");

118 ià(
dİršt
) {

119 
	`´štf
("\n");

121 
	}
}

128 
	$checkblock
(vŞ©*
±r
, 
size_t
 
size
, 
bŸs
, 
dİršt
)

130 
size_t
 
n
, 
i
;

131 *
¶
;

132 
v®
;

134 
¶
 = (*)
±r
;

135 
n
 = 
size
 / ();

137 
i
=0; i<
n
; i++) {

138 
v®
 = (()
i
 ^ ()
bŸs
);

139 ià(
¶
[
i
] !ğ
v®
) {

140 ià(
dİršt
) {

141 
	`´štf
("\n");

143 
	`´štf
("FAILED: data mismatch‡t offset %lu of block "

145 (è(
i
*()),

146 ()(
ušŒ_t
)
¶
,

147 
¶
[
i
], 
v®
);

150 ià(
dİršt
 && (
i
%64==63)) {

151 
	`´štf
(".");

154 ià(
dİršt
) {

155 
	`´štf
("\n");

159 
	}
}

172 
	$‹¡1
()

174 vŞ©*
x
;

176 
	`´štf
("*** Mallocest 1 ***\n");

177 
	`´štf
("AÎoÿtšg %u by‹s\n", 
BIGSIZE
);

178 
x
 = 
	`m®loc
(
BIGSIZE
);

179 ià(
x
==
NULL
) {

180 
	`´štf
("FAILED: malloc failed\n");

184 
	`m¬kblock
(
x
, 
BIGSIZE
, 0, 0);

185 ià(
	`checkblock
(
x
, 
BIGSIZE
, 0, 0)) {

186 
	`´štf
("FAILED: data corrupt\n");

190 
	`ä“
((*)
x
);

192 
	`´štf
("Passed mallocest 1.\n");

193 
	}
}

230 
	$‹¡2
()

232 vŞ©*
x
;

233 
size_t
 
size
;

235 
	`´štf
("Entering mallocest 2.\n");

236 
	`´štf
("Make sure you„ead‡nd understandhe comment in malloctest.c "

239 
	`´štf
("Testing how much memory we can‡llocate:\n");

241 
size
 = 
HUGESIZE
; (
x
 = 
	`m®loc
(size))==
NULL
; size = size/2) {

242 
	`´štf
(" %9lu by‹s: faed\n", (è
size
);

244 
	`´štf
(" %9lu by‹s: sucûeded\n", (è
size
);

246 
	`´štf
("Passed…art 1\n");

248 
	`´štf
("Touching‡llhe words inhe block.\n");

249 
	`m¬kblock
(
x
, 
size
, 0, 1);

251 
	`´štf
("Validatinghe words inhe block.\n");

252 ià(
	`checkblock
(
x
, 
size
, 0, 1)) {

253 
	`´štf
("FAILED: data corrupt\n");

256 
	`´štf
("Passed…art 2\n");

259 
	`´štf
("Freeinghe block\n");

260 
	`ä“
((*)
x
);

261 
	`´štf
("Passed…art 3\n");

262 
	`´štf
("Allocating‡nother block\n");

264 
x
 = 
	`m®loc
(
size
);

265 ià(
x
==
NULL
) {

266 
	`´štf
("FAILED: free didn't„eturnhe memory?\n");

269 
	`ä“
((*)
x
);

271 
	`´štf
("Passed mallocest 2.\n");

272 
	}
}

288 
	s‹¡3
 {

289 
‹¡3
 *
	mÃxt
;

290 
	mjunk
[(
SMALLSIZE
 - (
‹¡3
 *))];

295 
	$‹¡3
()

297 
‹¡3
 *
li¡
 = 
NULL
, *
tmp
;

298 
size_t
 
tÙ
=0;

299 
ù
=0, 
çed
=0;

300 *
x
;

302 
	`´štf
("Entering mallocest 3.\n");

303 
	`´štf
("Make sure you„ead‡nd understandhe comment in malloctest.c "

306 
	`´štf
("Testing how much memory we can‡llocate:\n");

308 (
tmp
 = 
	`m®loc
((
‹¡3
))è!ğ
NULL
) {

310 
tmp
->
Ãxt
 = 
li¡
;

311 
li¡
 = 
tmp
;

313 
tÙ
 +ğ(
‹¡3
);

315 
	`m¬kblock
(
li¡
->
junk
, Öi¡->junk), (
ušŒ_t
)list, 0);

317 
ù
++;

318 ià(
ù
%128==0) {

319 
	`´štf
(".");

323 
	`´štf
("AÎoÿ‹d %lu by‹s\n", (è
tÙ
);

325 
	`´štf
("Trying some more‡llocations which Iƒxpecto fail...\n");

327 
x
 = 
	`m®loc
(
SMALLSIZE
);

328 ià(
x
 !ğ
NULL
) {

329 
	`´štf
("FAILED: m®loc(%uèsucûeded\n", 
SMALLSIZE
);

333 
x
 = 
	`m®loc
(
MEDIUMSIZE
);

334 ià(
x
 !ğ
NULL
) {

335 
	`´štf
("FAILED: m®loc(%uèsucûeded\n", 
MEDIUMSIZE
);

339 
x
 = 
	`m®loc
(
BIGSIZE
);

340 ià(
x
 !ğ
NULL
) {

341 
	`´štf
("FAILED: m®loc(%uèsucûeded\n", 
BIGSIZE
);

345 
	`´štf
("Ok,‚ow I'm goingo freeƒverything...\n");

347 
li¡
 !ğ
NULL
) {

348 
tmp
 = 
li¡
->
Ãxt
;

350 ià(
	`checkblock
(
li¡
->
junk
, (list->junk),

351 (
ušŒ_t
)
li¡
, 0)) {

352 
çed
 = 1;

355 
	`ä“
(
li¡
);

356 
li¡
 = 
tmp
;

359 ià(
çed
) {

360 
	`´štf
("FAILED: data corruption\n");

364 
	`´štf
("Let me see if I can‡llocate some more‚ow...\n");

366 
x
 = 
	`m®loc
(
MEDIUMSIZE
);

367 ià(
x
 =ğ
NULL
) {

368 
	`´štf
("FAIL: Nope, I couldn't.\n");

371 
	`ä“
(
x
);

373 
	`´štf
("Passed mallocest 3\n");

374 
	}
}

389 
	$‹¡4
()

391 *
x
, *
y
, *
z
;

392 
lx
, 
ly
, 
lz
, 
ov”h—d
, 
zsize
;

394 
	`´štf
("Entering mallocest 4.\n");

395 
	`´štf
("Thisest is intended for first/best-fit based mallocs.\n");

396 
	`´štf
("Thisest may‚ot work correctly if„un‡fter otherests.\n");

398 
	`´štf
("Testing free†ist coalescing:\n");

400 
x
 = 
	`m®loc
(
SMALLSIZE
);

401 ià(
x
==
NULL
) {

402 
	`´štf
("FAILED: m®loc(%uèçed\n", 
SMALLSIZE
);

406 
y
 = 
	`m®loc
(
MEDIUMSIZE
);

407 ià(
y
==
NULL
) {

408 
	`´štf
("FAILED: m®loc(%uèçed\n", 
MEDIUMSIZE
);

413 
	`´štf
("Buh? I can't fit‡ void * in‡n unsigned†ong\n");

414 
	`´štf
("ENVIRONMENT FAILED...\n");

418 
lx
 = ()
x
;

419 
ly
 = ()
y
;

421 
	`´štf
("x i 0x%lx; y i 0x%lx\n", 
lx
, 
ly
);

432 ià(
lx
 =ğ
ly
) {

433 
	`´štf
("FAIL: x == y\n");

443 ià(
lx
 < 
ly
 &&†x + 
SMALLSIZE
 >†y) {

444 
	`´štf
("FAIL: y starts within x\n");

447 ià(
ly
 < 
lx
 &&†y + 
MEDIUMSIZE
 >†x) {

448 
	`´štf
("FAIL: x starts within y\n");

457 ià(
ly
 < 
lx
) {

458 
	`´štf
("TEST UNSUITABLE: y is below x\n");

465 
ov”h—d
 = 
ly
 - (
lx
 + 
SMALLSIZE
);

466 
	`´štf
("Aµ¬’ˆblock ov”h—d: %lu\n", 
ov”h—d
);

468 ià(
ov”h—d
 > 
ABSURD_OVERHEAD
) {

469 
	`´štf
("TEST UNSUITABLE: block overhead‡bsurdly†arge.\n");

472 ià(
ov”h—d
 > 
OVERHEAD
) {

473 
	`´štf
("FAIL: block overhead isoo†arge.\n");

477 
	`´štf
("Freeing blocks...\n");

478 
	`ä“
(
x
);

479 
	`ä“
(
y
);

481 
zsize
 = 
SMALLSIZE
 + 
MEDIUMSIZE
 + 
ov”h—d
;

483 
	`´štf
("Now‡Îoÿtšg %lu by‹s... should„eu£h¥aû.\n", 
zsize
);

484 
z
 = 
	`m®loc
(
zsize
);

485 ià(
z
 =ğ
NULL
) {

486 
	`´štf
("FAIL: Allocation failed...\n");

490 
lz
 = (è
z
;

492 
	`´štf
("z i 0x%lx (x wa 0x%lx, y 0x%lx)\n", 
lz
, 
lx
, 
ly
);

494 ià(
lz
==
lx
) {

495 
	`´štf
("Passed.\n");

498 
	`´štf
("Failed.\n");

501 
	`ä“
(
z
);

502 
	}
}

518 
	$‹¡567
(
‹¡no
, 
£ed
)

520 cÚ¡ 
sizes
[8] = { 13, 17, 69, 176, 433, 871, 1150, 6060 };

522 *
±rs
[32];

523 
psizes
[32];

524 
i
, 
n
, 
size
, 
çed
=0;

526 
	`¤ªdom
(
£ed
);

527 
	`´štf
("S“ded„ªdom‚umb” g’”©Ü w™h %lu.\n", 
£ed
);

529 
i
=0; i<32; i++) {

530 
±rs
[
i
] = 
NULL
;

531 
psizes
[
i
] = 0;

534 
i
=0; i<100000; i++) {

535 
n
 = 
	`¿ndom
()%32;

536 ià(
±rs
[
n
] =ğ
NULL
) {

537 
size
 = 
sizes
[
	`¿ndom
()%8];

538 
±rs
[
n
] = 
	`m®loc
(
size
);

539 
psizes
[
n
] = 
size
;

540 ià(
±rs
[
n
] =ğ
NULL
) {

541 
	`´štf
("\nm®loø%u faed\n", 
size
);

542 
çed
 = 1;

545 
	`m¬kblock
(
±rs
[
n
], 
size
,‚, 0);

548 
size
 = 
psizes
[
n
];

549 ià(
	`checkblock
(
±rs
[
n
], 
size
,‚, 0)) {

550 
çed
 = 1;

553 
	`ä“
(
±rs
[
n
]);

554 
±rs
[
n
] = 
NULL
;

555 
psizes
[
n
] = 0;

557 ià(
i
%256==0) {

558 
	`´štf
(".");

561 
	`´štf
("\n");

563 
i
=0; i<32; i++) {

564 ià(
±rs
[
i
] !ğ
NULL
) {

565 
	`ä“
(
±rs
[
i
]);

569 ià(
çed
) {

570 
	`´štf
("FAILED m®loø‹¡ %d\n", 
‹¡no
);

573 
	`´štf
("Pas£d m®loø‹¡ %d\n", 
‹¡no
);

575 
	}
}

579 
	$‹¡5
()

581 
	`´štf
("Beginning mallocest 5\n");

582 
	`‹¡567
(5, 0);

583 
	}
}

587 
	$‹¡6
()

589 
fd
, 
Ën
;

590 
£ed
;

592 
	`´štf
("Beginning mallocest 6\n");

594 
fd
 = 
	`İ’
(
_PATH_RANDOM
, 
O_RDONLY
);

595 ià(
fd
 < 0) {

596 
	`”r
(1, "%s", 
_PATH_RANDOM
);

598 
Ën
 = 
	`»ad
(
fd
, &
£ed
, (seed));

599 ià(
Ën
 < 0) {

600 
	`”r
(1, "%s", 
_PATH_RANDOM
);

602 ià(
Ën
 < ()(
£ed
)) {

603 
	`”rx
(1, "%s: ShÜˆ»ad", 
_PATH_RANDOM
);

605 
	`şo£
(
fd
);

607 
	`‹¡567
(6, 
£ed
);

608 
	}
}

612 
	$‹¡7
()

614 
£ed
;

616 
	`´štf
("Beginning mallocest 7\n");

618 
	`´štf
("Enter„andom seed: ");

619 
£ed
 = 
	`g‘i
();

621 
	`‹¡567
(7, 
£ed
);

622 
	}
}

627 
	mnum
;

628 cÚ¡ *
	mdesc
;

629 (*
	mfunc
)();

630 } 
	g‹¡s
[] = {

631 { 1, "Sim¶®loÿtiÚe¡", 
‹¡1
 },

632 { 2, "AÎoÿ‹‡Î memÜy iÀ¨big chunk", 
‹¡2
 },

633 { 3, "AÎoÿ‹‡Î memÜy iÀsm®Èchunks", 
‹¡3
 },

634 { 4, "F»li¡ cßËscšge¡ (fœ¡/Ãxt/be¡-f™ oÆy)", 
‹¡4
 },

635 { 5, "SŒes ‹¡", 
‹¡5
 },

636 { 6, "Rªdomized sŒes ‹¡", 
‹¡6
 },

637 { 7, "SŒes ‹¡ w™h…¬ticuÏ¸£ed", 
‹¡7
 },

638 { -1, 
NULL
, NULL }

643 
	$dÙe¡
(
Š
)

645 
i
;

646 
i
=0; 
‹¡s
[i].
num
>=0; i++) {

647 ià(
‹¡s
[
i
].
num
 =ğ
Š
) {

648 
‹¡s
[
i
].
	`func
();

653 
	}
}

656 
	$maš
(
¬gc
, *
¬gv
[])

658 
i
, 
Š
, 
m’u
=1;

660 ià(
¬gc
 > 1) {

661 
i
=1; i<
¬gc
; i++) {

662 
	`dÙe¡
(
	`©oi
(
¬gv
[
i
]));

668 ià(
m’u
) {

669 
i
=0; 
‹¡s
[i].
num
>=0; i++) {

670 
	`´štf
(" %2d %s\n", 
‹¡s
[
i
].
num
,

671 
‹¡s
[
i
].
desc
);

673 
m’u
 = 0;

675 
	`´štf
("malloctest: ");

676 
Š
 = 
	`g‘i
();

677 ià(
Š
 < 0) {

681 ià(
	`dÙe¡
(
Š
)) {

682 
m’u
 = 1;

687 
	}
}

	@matmult/matmult-orig.c

48 
	~<uni¡d.h
>

49 
	~<¡dio.h
>

51 
	#Dim
 360

	)

55 
	#RIGHT
 46397160

	)

57 
	gA
[
Dim
][Dim];

58 
	gB
[
Dim
][Dim];

59 
	gC
[
Dim
][Dim];

62 
	$maš
()

64 
i
, 
j
, 
k
, 
r
;

66 
i
 = 0; i < 
Dim
; i++)

67 
j
 = 0; j < 
Dim
; j++) {

68 
A
[
i
][
j
] = i;

69 
B
[
i
][
j
] = j;

70 
C
[
i
][
j
] = 0;

73 
i
 = 0; i < 
Dim
; i++)

74 
j
 = 0; j < 
Dim
; j++)

75 
k
 = 0; k < 
Dim
; k++)

76 
C
[
i
][
j
] +ğ
A
[i][
k
] * 
B
[k][j];

78 
	`´štf
("matmult-orig finished.\n");

79 
r
 = 
C
[
Dim
-1][Dim-1];

80 
	`´štf
("ªsw” is: %d (should b%d)\n", 
r
, 
RIGHT
);

81 ià(
r
 !ğ
RIGHT
) {

82 
	`´štf
("FAILED\n");

85 
	`´štf
("Passed.\n");

88 
	}
}

	@matmult/matmult.c

42 
	~<uni¡d.h
>

43 
	~<¡dio.h
>

45 
	#Dim
 72

	)

49 
	#RIGHT
 8772192

	)

51 
	gA
[
Dim
][Dim];

52 
	gB
[
Dim
][Dim];

53 
	gC
[
Dim
][Dim];

54 
	gT
[
Dim
][Dim][Dim];

57 
	$maš
()

59 
i
, 
j
, 
k
, 
r
;

61 
i
 = 0; i < 
Dim
; i++)

62 
j
 = 0; j < 
Dim
; j++) {

63 
A
[
i
][
j
] = i;

64 
B
[
i
][
j
] = j;

65 
C
[
i
][
j
] = 0;

68 
i
 = 0; i < 
Dim
; i++)

69 
j
 = 0; j < 
Dim
; j++)

70 
k
 = 0; k < 
Dim
; k++)

71 
T
[
i
][
j
][
k
] = 
A
[i][k] * 
B
[k][j];

73 
i
 = 0; i < 
Dim
; i++)

74 
j
 = 0; j < 
Dim
; j++)

75 
k
 = 0; k < 
Dim
; k++)

76 
C
[
i
][
j
] +ğ
T
[i][j][
k
];

78 
r
 = 0;

79 
i
 = 0; i < 
Dim
; i++)

80 
r
 +ğ
C
[
i
][i];

82 
	`´štf
("matmult finished.\n");

83 
	`´štf
("ªsw” is: %d (should b%d)\n", 
r
, 
RIGHT
);

84 ià(
r
 !ğ
RIGHT
) {

85 
	`´štf
("FAILED\n");

88 
	`´štf
("Passed.\n");

90 
	}
}

	@palin/palin.c

84 
	~<¡dio.h
>

85 
	~<¡ršg.h
>

87 
	g·lšdrome
[8000] =

174 
	$maš
()

176 *
¡¬t
, *
’d
;

178 
	`´štf
("Welcomeohe…alindromeester!\n");

179 
	`´štf
("I willake‡†arge…alindrome‡ndest it.\n");

180 
	`´štf
("Here it is:\n");

181 
	`´štf
("%s\n", 
·lšdrome
);

183 
	`´štf
("Testing...");

185 
’d
 = 
·lšdrome
+
	`¡¾’
(palindrome);

186 
’d
--;

188 
¡¬t
 = 
·lšdrome
; s¹ <ğ
’d
; start++,ƒnd--) {

189 
	`putch¬
('.');

190 ià(*
¡¬t
 !ğ*
’d
) {

191 
	`´štf
("NOT‡…alindrome\n");

196 
	`´štf
("IS‡…alindrome\n");

198 
	}
}

	@parallelvm/parallelvm.c

39 
	~<sys/ty³s.h
>

40 
	~<sys/wa™.h
>

41 
	~<¡d¬g.h
>

42 
	~<¡dio.h
>

43 
	~<¡ršg.h
>

44 
	~<¡dlib.h
>

45 
	~<uni¡d.h
>

46 
	~<”r.h
>

48 
	#NJOBS
 24

	)

50 
	#DIM
 35

	)

51 
	#NMATS
 11

	)

52 
	#JOBSIZE
 ((
NMATS
+1)*
DIM
*DIM*())

	)

54 cÚ¡ 
	gright_ªsw”s
[
NJOBS
] = {

83 
	sm©rix
 {

84 
	mm_d©a
[
DIM
][DIM];

95 
	$§y
(cÚ¡ *
fmt
, ...)

97 
buf
[256];

98 
va_li¡
 
­
;

99 
	`va_¡¬t
(
­
, 
fmt
);

100 
	`v¢´štf
(
buf
, (buf), 
fmt
, 
­
);

101 
	`va_’d
(
­
);

102 
	`wr™e
(
STDOUT_FILENO
, 
buf
, 
	`¡¾’
(buf));

103 
	}
}

109 
	$muÉly
(
m©rix
 *
»s
, cÚ¡ m©rix *
m1
, cÚ¡ m©rix *
m2
)

111 
i
, 
j
, 
k
;

113 
i
=0; i<
DIM
; i++) {

114 
j
=0; j<
DIM
; j++) {

115 
v®
=0;

116 
k
=0; k<
DIM
; k++) {

117 
v®
 +ğ
m1
->
m_d©a
[
i
][
k
]*
m2
->m_d©a[k][
j
];

119 
»s
->
m_d©a
[
i
][
j
] = 
v®
;

122 
	}
}

126 
	$addeq
(
m©rix
 *
m1
, cÚ¡ m©rix *
m2
)

128 
i
, 
j
;

129 
i
=0; i<
DIM
; i++) {

130 
j
=0; j<
DIM
; j++) {

131 
m1
->
m_d©a
[
i
][
j
] +ğ
m2
->m_data[i][j];

134 
	}
}

138 
	$Œaû
(cÚ¡ 
m©rix
 *
m1
)

140 
i
, 
t
=0;

141 
i
=0; i<
DIM
; i++) {

142 
t
 +ğ
m1
->
m_d©a
[
i
][i];

144  
t
;

145 
	}
}

149 
m©rix
 
	gm©s
[
NMATS
];

153 
	$pİuÏ‹_š™Ÿl_m©rixes
(
mynum
)

155 
i
,
j
;

156 
m©rix
 *
m
 = &
m©s
[0];

157 
i
=0; i<
DIM
; i++) {

158 
j
=0; j<
DIM
; j++) {

159 
m
->
m_d©a
[
i
][
j
] = 
mynum
+i-2*j;

163 
	`muÉly
(&
m©s
[1], &mats[0], &mats[0]);

164 
	}
}

168 
	$compu‹
(
n
)

170 
m©rix
 
tmp
;

171 
i
, 
j
;

173 
i
=0,
j
=
n
-1; i<j; i++,j--) {

174 
	`muÉly
(&
tmp
, &
m©s
[
i
], &m©s[
j
]);

175 
	`addeq
(&
m©s
[
n
], &
tmp
);

177 
	}
}

181 
	$compu‹®l
(
mynum
)

183 
i
;

184 
	`pİuÏ‹_š™Ÿl_m©rixes
(
mynum
);

185 
i
=2; i<
NMATS
; i++) {

186 
	`compu‹
(
i
);

188 
	}
}

192 
	$ªsw”
()

194  
	`Œaû
(&
m©s
[
NMATS
-1]);

195 
	}
}

199 
	$go
(
mynum
)

201 
r
;

203 
	`§y
("Proûs %d (pid %dè¡¬tšg computiÚ...\n", 
mynum
,

204 (è
	`g‘pid
());

206 
	`compu‹®l
(
mynum
);

207 
r
 = 
	`ªsw”
();

209 ià(
r
 !ğ
right_ªsw”s
[
mynum
]) {

210 
	`§y
("Process %d‡nswer %d: FAILED, should be %d\n",

211 
mynum
, 
r
, 
right_ªsw”s
[mynum]);

212 
	`ex™
(1);

214 
	`§y
("Proûs %d‡nsw” %d:…as£d\n", 
mynum
, 
r
);

215 
	`ex™
(0);

216 
	}
}

222 
	$¡©us_is_çu»
(
¡©us
)

225 ià(
	`WIFSIGNALED
(
¡©us
)) {

228 ià(!
	`WIFEXITED
(
¡©us
)) {

232 
¡©us
 = 
	`WEXITSTATUS
(status);

233  
¡©us
 != 0;

234 
	}
}

238 
	$mak•rocs
()

240 
i
, 
¡©us
, 
çcouÁ
;

241 
pid_t
 
pids
[
NJOBS
];

243 
	`´štf
("Job siz­´oxim©–y %lu by‹s\n", (è
JOBSIZE
);

244 
	`´štf
("FÜkšg %d jobs;Ù®†ßd %luk\n", 
NJOBS
,

245 (è(
NJOBS
 * 
JOBSIZE
)/1024);

247 
i
=0; i<
NJOBS
; i++) {

248 
pids
[
i
] = 
	`fÜk
();

249 ià(
pids
[
i
]<0) {

250 
	`w¬n
("fork");

252 ià(
pids
[
i
]==0) {

254 
	`go
(
i
);

258 
çcouÁ
=0;

259 
i
=0; i<
NJOBS
; i++) {

260 ià(
pids
[
i
]<0) {

261 
çcouÁ
++;

264 ià(
	`wa™pid
(
pids
[
i
], &
¡©us
, 0)<0) {

265 
	`”r
(1, "waitpid");

267 ià(
	`¡©us_is_çu»
(
¡©us
)) {

268 
çcouÁ
++;

273 ià(
çcouÁ
>0) {

274 
	`´štf
("%d sub´oûs£ çed\n", 
çcouÁ
);

275 
	`ex™
(1);

277 
	`´štf
("Test complete\n");

278 
	}
}

281 
	$maš
()

283 
	`mak•rocs
();

285 
	}
}

	@psort/psort.c

39 
	~<sys/ty³s.h
>

40 
	~<sys/¡©.h
>

41 
	~<sys/wa™.h
>

42 
	~<¡dio.h
>

43 
	~<¡d¬g.h
>

44 
	~<¡dlib.h
>

45 
	~<¡ršg.h
>

46 
	~<as£¹.h
>

47 
	~<uni¡d.h
>

48 
	~<fú.h
>

49 
	~<”ºo.h
>

51 #iâdeà
RANDOM_MAX


53 
	#RANDOM_MAX
 
RAND_MAX


	)

56 
	#PATH_KEYS
 "sÜtkeys"

	)

57 
	#PATH_SORTED
 "ouut"

	)

58 
	#PATH_TESTDIR
 "psÜtdœ"

	)

59 
	#PATH_RANDOM
 "¿nd:"

	)

61 
	#WORKNUM
 (128*1024)

	)

64 
	gwÜk¥aû
[
WORKNUM
];

66 cÚ¡ *
	g´ogÇme
;

68 
	gnum´ocs
 = 4;

69 
	gnumkeys
 = 10000;

70 
	g¿ndom£ed
 = 15432753;

72 
off_t
 
	gcÜ»ùsize
;

73 
	gchecksum
;

75 
	#NOBODY
 (-1)

	)

76 
	gme
 = 
NOBODY
;

82 
	$sÜtšts
(*
v
, 
num
)

84 
pivÙv®
, 
pivÙpošt
, 
pivÙcouÁ
;

85 
äÚos
, 
»adpos
, 
’dpos
, 
i
, 
j
;

86 
tmp
;

88 ià(
num
 < 2) {

92 
pivÙpošt
 = 
num
/2;

93 
pivÙv®
 = 
v
[
pivÙpošt
];

94 
pivÙcouÁ
 = 0;

96 
äÚos
 = 0;

97 
»adpos
 = 0;

98 
’dpos
 = 
num
;

99 
»adpos
 < 
’dpos
) {

100 ià(
v
[
»adpos
] < 
pivÙv®
) {

101 
v
[
äÚos
++] = v[
»adpos
++];

103 ià(
v
[
»adpos
] =ğ
pivÙv®
) {

104 
»adpos
++;

105 
pivÙcouÁ
++;

108 
tmp
 = 
v
[--
’dpos
];

109 
v
[
’dpos
] = v[
»adpos
];

110 
v
[
»adpos
] = 
tmp
;

113 
	`as£¹
(
»adpos
 =ğ
’dpos
);

114 
	`as£¹
(
äÚos
 + 
pivÙcouÁ
 =ğ
»adpos
);

116 
i
=
äÚos
; i<
’dpos
; i++) {

117 
v
[
i
] = 
pivÙv®
;

120 
i
=
’dpos
, 
j
=
num
-1; i<j; i++,j--) {

121 
tmp
 = 
v
[
i
];

122 
v
[
i
] = v[
j
];

123 
v
[
j
] = 
tmp
;

126 
	`sÜtšts
(
v
, 
äÚos
);

127 
	`sÜtšts
(&
v
[
’dpos
], 
num
-endpos);

128 
	}
}

134 
	$š™´ogÇme
(cÚ¡ *
av0
)

136 ià(
av0
) {

137 
´ogÇme
 = 
	`¡¼chr
(
av0
, '/');

138 ià(
´ogÇme
) {

139 
´ogÇme
++;

142 
´ogÇme
 = 
av0
;

146 
´ogÇme
 = "psort";

148 
	}
}

152 
	$vscom¶aš
(*
buf
, 
size_t
 
Ën
, cÚ¡ *
fmt
, 
va_li¡
 
­
, 
”r
)

154 
size_t
 
pos
;

156 ià(
me
 >= 0) {

157 
	`¢´štf
(
buf
, 
Ën
, "%s:…roø%d: ", 
´ogÇme
, 
me
);

160 
	`¢´štf
(
buf
, 
Ën
, "%s: ", 
´ogÇme
);

162 
pos
 = 
	`¡¾’
(
buf
);

164 
	`v¢´štf
(
buf
+
pos
, 
Ën
-pos, 
fmt
, 
­
);

165 
pos
 = 
	`¡¾’
(
buf
);

167 ià(
”r
 >= 0) {

168 
	`¢´štf
(
buf
+
pos
, 
Ën
-pos, ": %s\n", 
	`¡»¼Ü
(
”r
));

171 
	`¢´štf
(
buf
+
pos
, 
Ën
-pos, "\n");

173 
	}
}

177 
	$com¶ašx
(cÚ¡ *
fmt
, ...)

179 
rc
;

180 
buf
[256];

181 
va_li¡
 
­
;

183 
	`va_¡¬t
(
­
, 
fmt
);

184 
	`vscom¶aš
(
buf
, (buf), 
fmt
, 
­
, -1);

185 
	`va_’d
(
­
);

188 
rc
 = 
	`wr™e
(
STDERR_FILENO
, 
buf
, 
	`¡¾’
(buf));

191 ()
rc
;

192 
	}
}

196 
	$com¶aš
(cÚ¡ *
fmt
, ...)

198 
rc
;

199 
buf
[256];

200 
va_li¡
 
­
;

201 
”r
 = 
”ºo
;

203 
	`va_¡¬t
(
­
, 
fmt
);

204 
	`vscom¶aš
(
buf
, (buf), 
fmt
, 
­
, 
”r
);

205 
	`va_’d
(
­
);

208 
rc
 = 
	`wr™e
(
STDERR_FILENO
, 
buf
, 
	`¡¾’
(buf));

211 ()
rc
;

212 
	}
}

218 
	$doİ’
(cÚ¡ *
·th
, 
æags
, 
mode
)

220 
fd
;

222 
fd
 = 
	`İ’
(
·th
, 
æags
, 
mode
);

223 ià(
fd
<0) {

224 
	`com¶aš
("%s", 
·th
);

225 
	`ex™
(1);

227  
fd
;

228 
	}
}

232 
	$doşo£
(cÚ¡ *
·th
, 
fd
)

234 ià(
	`şo£
(
fd
)) {

235 
	`com¶aš
("%s: clo£", 
·th
);

236 
	`ex™
(1);

238 
	}
}

242 
	$doü—‹
(cÚ¡ *
·th
)

244 
fd
;

246 
fd
 = 
	`doİ’
(
·th
, 
O_WRONLY
|
O_CREAT
|
O_TRUNC
, 0664);

247 
	`doşo£
(
·th
, 
fd
);

248 
	}
}

252 
	$dÜemove
(cÚ¡ *
·th
)

254 
nÜemove
;

256 ià(
nÜemove
) {

260 ià(
	`»move
(
·th
) < 0) {

261 ià(
”ºo
 =ğ
ENOSYS
) {

263 
nÜemove
 = 1;

265 
	`com¶aš
("%s:„emove", 
·th
);

267 
	}
}

270 
off_t


271 
	$g‘size
(cÚ¡ *
·th
)

273 
¡©
 
buf
;

274 
fd
;

275 
no_¡©
, 
no_f¡©
;

277 ià(!
no_¡©
) {

278 ià(
	`¡©
(
·th
, &
buf
) == 0) {

279  
buf
.
¡_size
;

281 ià(
”ºo
 !ğ
ENOSYS
) {

282 
	`com¶aš
("%s: st", 
·th
);

283 
	`ex™
(1);

286 
no_¡©
 = 1;

289 
fd
 = 
	`doİ’
(
·th
, 
O_RDONLY
, 0);

290 ià(!
no_f¡©
) {

291 ià(
	`f¡©
(
fd
, &
buf
) == 0) {

292 
	`şo£
(
fd
);

293  
buf
.
¡_size
;

295 ià(
”ºo
 !ğ
ENOSYS
) {

296 
	`com¶aš
("%s: st", 
·th
);

297 
	`ex™
(1);

300 
no_f¡©
 = 1;

304 ià(
	`l£ek
(
fd
, 0, 
SEEK_END
) >= 0) {

305 
buf
.
¡_size
 = 
	`l£ek
(
fd
, 0, 
SEEK_CUR
);

306 ià(
buf
.
¡_size
 >= 0) {

307  
buf
.
¡_size
;

310 
	`com¶aš
("%s: g‘tšg fsizw™h†£ek", 
·th
);

311 
	`şo£
(
fd
);

312 
	`ex™
(1);

313 
	}
}

316 
size_t


317 
	$dÜ—d
(cÚ¡ *
·th
, 
fd
, *
buf
, 
size_t
 
Ën
)

319 
»suÉ
;

321 
»suÉ
 = 
	`»ad
(
fd
, 
buf
, 
Ën
);

322 ià(
»suÉ
 < 0) {

323 
	`com¶aš
("%s:„—d", 
·th
);

324 
	`ex™
(1);

326  (
size_t
è
»suÉ
;

327 
	}
}

331 
	$dÛxaù»ad
(cÚ¡ *
·th
, 
fd
, *
buf
, 
size_t
 
Ën
)

333 
size_t
 
»suÉ
;

335 
»suÉ
 = 
	`dÜ—d
(
·th
, 
fd
, 
buf
, 
Ën
);

336 ià(
»suÉ
 !ğ
Ën
) {

337 
	`com¶ašx
("%s:„—d: shÜˆcouÁ", 
·th
);

338 
	`ex™
(1);

340 
	}
}

344 
	$dowr™e
(cÚ¡ *
·th
, 
fd
, cÚ¡ *
buf
, 
size_t
 
Ën
)

346 
»suÉ
;

348 
»suÉ
 = 
	`wr™e
(
fd
, 
buf
, 
Ën
);

349 ià(
»suÉ
 < 0) {

350 
	`com¶aš
("%s: wr™e", 
·th
);

351 
	`ex™
(1);

353 ià((
size_t
è
»suÉ
 !ğ
Ën
) {

354 
	`com¶ašx
("%s: wr™e: shÜˆcouÁ", 
·th
);

355 
	`ex™
(1);

357 
	}
}

361 
	$dŞ£ek
(cÚ¡ *
Çme
, 
fd
, 
off_t
 
off£t
, 
wh’û
)

363 ià(
	`l£ek
(
fd
, 
off£t
, 
wh’û
) < 0) {

364 
	`com¶aš
("%s:†£ek", 
Çme
);

365 
	`ex™
(1);

367 
	}
}

372 
	$dochdœ
(cÚ¡ *
·th
)

374 ià(
	`chdœ
(
·th
) < 0) {

375 
	`com¶aš
("%s: chdœ", 
·th
);

376 
	`ex™
(1);

378 
	}
}

382 
	$domkdœ
(cÚ¡ *
·th
, 
mode
)

384 ià(
	`mkdœ
(
·th
, 
mode
) < 0) {

385 
	`com¶aš
("%s: mkdœ", 
·th
);

386 
	`ex™
(1);

388 
	}
}

392 
pid_t


393 
	$dofÜk
()

395 
pid_t
 
pid
;

397 
pid
 = 
	`fÜk
();

398 ià(
pid
 < 0) {

399 
	`com¶aš
("fork");

403  
pid
;

404 
	}
}

410 
	$dowa™
(
guy
, 
pid_t
 
pid
)

412 
¡©us
, 
»suÉ
;

414 
»suÉ
 = 
	`wa™pid
(
pid
, &
¡©us
, 0);

415 ià(
»suÉ
 < 0) {

416 
	`com¶aš
("waitpid");

419 ià(
	`WIFSIGNALED
(
¡©us
)) {

420 
	`com¶ašx
("´oø%d: sigÇÈ%d", 
guy
, 
	`WTERMSIG
(
¡©us
));

423 
	`as£¹
(
	`WIFEXITED
(
¡©us
));

424 
¡©us
 = 
	`WEXITSTATUS
(status);

425 ià(
¡©us
) {

426 
	`com¶ašx
("´oø%d:ƒx™ %d", 
guy
, 
¡©us
);

430 
	}
}

434 
dofÜk®l
(cÚ¡ *
pha£Çme
, (*
func
)())

436 
i
, 
bad
 = 0;

437 
pid_t
 
pids
[
num´ocs
];

439 
i
=0; i<
num´ocs
; i++) {

440 
pids
[
i
] = 
	`dofÜk
();

441 ià(
pids
[
i
] < 0) {

442 
bad
 = 1;

444 ià(
pids
[
i
] == 0) {

446 
me
 = 
i
;

447 
	`func
();

448 
	`ex™
(0);

452 
i
=0; i<
num´ocs
; i++) {

453 ià(
pids
[
i
] > 0 && 
	`dowa™
(i,…ids[i])) {

454 
bad
 = 1;

458 ià(
bad
) {

459 
	`com¶ašx
("% çed.", 
pha£Çme
);

460 
	`ex™
(1);

462 
	}
}

466 
	$£ekmy¶aû
(cÚ¡ *
Çme
, 
fd
)

468 
keys_³r
, 
myfœ¡
;

469 
off_t
 
off£t
;

471 
keys_³r
 = 
numkeys
 / 
num´ocs
;

472 
myfœ¡
 = 
me
*
keys_³r
;

473 
off£t
 = 
myfœ¡
 * ();

475 
	`dŞ£ek
(
Çme
, 
fd
, 
off£t
, 
SEEK_SET
);

476 
	}
}

480 
	$g‘mykeys
()

482 
keys_³r
, 
myfœ¡
, 
mykeys
;

484 
keys_³r
 = 
numkeys
 / 
num´ocs
;

485 
myfœ¡
 = 
me
*
keys_³r
;

486 
mykeys
 = (
me
 < 
num´ocs
-1è? 
keys_³r
 : 
numkeys
 - 
myfœ¡
;

488  
mykeys
;

489 
	}
}

495 
	$checksum_fe
(cÚ¡ *
·th
)

497 
fd
;

498 
buf
[512];

499 
size_t
 
couÁ
, 
i
;

500 
sum
 = 0;

502 
fd
 = 
	`doİ’
(
·th
, 
O_RDONLY
, 0);

504 (
couÁ
 = 
	`dÜ—d
(
·th
, 
fd
, 
buf
, (buf))) > 0) {

505 
i
=0; i<
couÁ
; i++) {

506 
sum
 +ğ(è
buf
[
i
];

510 
	`doşo£
(
·th
, 
fd
);

512  
sum
;

513 
	}
}

517 *
	g£eds
;

521 
	$g’keys_sub
()

523 
fd
, 
i
, 
mykeys
, 
keys_dÚe
, 
keys_to_do
, 
v®ue
;

525 
fd
 = 
	`doİ’
(
PATH_KEYS
, 
O_WRONLY
, 0);

527 
mykeys
 = 
	`g‘mykeys
();

528 
	`£ekmy¶aû
(
PATH_KEYS
, 
fd
);

530 
	`¤ªdom
(
£eds
[
me
]);

531 
keys_dÚe
 = 0;

532 
keys_dÚe
 < 
mykeys
) {

533 
keys_to_do
 = 
mykeys
 - 
keys_dÚe
;

534 ià(
keys_to_do
 > 
WORKNUM
) {

535 
keys_to_do
 = 
WORKNUM
;

538 
i
=0; i<
keys_to_do
; i++) {

539 
v®ue
 = 
	`¿ndom
();

542 
	`as£¹
(
v®ue
 >= 0);

543 
	`as£¹
(
v®ue
 <ğ
RANDOM_MAX
);

546 
v®ue
 =ğ0 || v®u=ğ
RANDOM_MAX
) {

547 
v®ue
 = 
	`¿ndom
();

550 
wÜk¥aû
[
i
] = 
v®ue
;

553 
	`dowr™e
(
PATH_KEYS
, 
fd
, 
wÜk¥aû
, 
keys_to_do
*());

554 
keys_dÚe
 +ğ
keys_to_do
;

557 
	`doşo£
(
PATH_KEYS
, 
fd
);

558 
	}
}

562 
	$g’keys
()

564 
£ed¥aû
[
num´ocs
];

565 
i
;

568 
	`doü—‹
(
PATH_KEYS
);

571 
	`¤ªdom
(
¿ndom£ed
);

572 
i
=0; i<
num´ocs
; i++) {

573 
£ed¥aû
[
i
] = 
	`¿ndom
();

577 
£eds
 = 
£ed¥aû
;

578 
	`dofÜk®l
("In™Ÿliz©iÚ", 
g’keys_sub
);

579 
£eds
 = 
NULL
;

582 ià(
	`g‘size
(
PATH_KEYS
è!ğ
cÜ»ùsize
) {

583 
	`com¶ašx
("%s: fi wrÚg size", 
PATH_KEYS
);

584 
	`ex™
(1);

588 
checksum
 = 
	`checksum_fe
(
PATH_KEYS
);

589 
	`com¶ašx
("Checksum oàunsÜ‹d keys: %ld", 
checksum
);

590 
	}
}

596 
	$bšÇme
(
a
, 
b
)

598 
rv
[32];

599 
	`¢´štf
(
rv
, Ôv), "bš-%d-%d", 
a
, 
b
);

600  
rv
;

601 
	}
}

605 
	$m”gedÇme
(
a
)

607 
rv
[32];

608 
	`¢´štf
(
rv
, Ôv), "m”ged-%d", 
a
);

609  
rv
;

610 
	}
}

614 
	$bš
()

616 
šfd
, 
outfds
[
num´ocs
];

617 cÚ¡ *
Çme
;

618 
i
, 
mykeys
, 
keys_dÚe
, 
keys_to_do
;

619 
key
, 
pivÙ
, 
bšnum
;

621 
šfd
 = 
	`doİ’
(
PATH_KEYS
, 
O_RDONLY
, 0);

623 
mykeys
 = 
	`g‘mykeys
();

624 
	`£ekmy¶aû
(
PATH_KEYS
, 
šfd
);

626 
i
=0; i<
num´ocs
; i++) {

627 
Çme
 = 
	`bšÇme
(
me
, 
i
);

628 
outfds
[
i
] = 
	`doİ’
(
Çme
, 
O_WRONLY
|
O_CREAT
|
O_TRUNC
, 0664);

631 
pivÙ
 = (
RANDOM_MAX
 / 
num´ocs
);

633 
keys_dÚe
 = 0;

634 
keys_dÚe
 < 
mykeys
) {

635 
keys_to_do
 = 
mykeys
 - 
keys_dÚe
;

636 ià(
keys_to_do
 > 
WORKNUM
) {

637 
keys_to_do
 = 
WORKNUM
;

640 
	`dÛxaù»ad
(
PATH_KEYS
, 
šfd
, 
wÜk¥aû
,

641 
keys_to_do
 * ());

643 
i
=0; i<
keys_to_do
; i++) {

644 
key
 = 
wÜk¥aû
[
i
];

646 
bšnum
 = 
key
 / 
pivÙ
;

647 ià(
key
 <= 0) {

648 
	`com¶ašx
("´oø%d: g¬bagkey %d", 
me
, 
key
);

649 
key
 = 0;

651 
	`as£¹
(
bšnum
 >= 0);

652 
	`as£¹
(
bšnum
 < 
num´ocs
);

653 
	`dowr™e
("bš", 
outfds
[
bšnum
], &
key
, (key));

656 
keys_dÚe
 +ğ
keys_to_do
;

658 
	`doşo£
(
PATH_KEYS
, 
šfd
);

660 
i
=0; i<
num´ocs
; i++) {

661 
	`doşo£
(
	`bšÇme
(
me
, 
i
), 
outfds
[i]);

663 
	}
}

667 
	$sÜtbšs
()

669 cÚ¡ *
Çme
;

670 
i
, 
fd
;

671 
off_t
 
bšsize
;

673 
i
=0; i<
num´ocs
; i++) {

674 
Çme
 = 
	`bšÇme
(
me
, 
i
);

675 
bšsize
 = 
	`g‘size
(
Çme
);

676 ià(
bšsize
 % () != 0) {

677 
	`com¶ašx
("%s: bš siz%ld‚Øgood", 
Çme
,

678 (è
bšsize
);

679 
	`ex™
(1);

681 ià(
bšsize
 > (
off_t
è(
wÜk¥aû
)) {

682 
	`com¶ašx
("´oø%d: %s: bšoØÏrge", 
me
, 
Çme
);

683 
	`ex™
(1);

686 
fd
 = 
	`doİ’
(
Çme
, 
O_RDWR
, 0);

687 
	`dÛxaù»ad
(
Çme
, 
fd
, 
wÜk¥aû
, 
bšsize
);

689 
	`sÜtšts
(
wÜk¥aû
, 
bšsize
/());

691 
	`dŞ£ek
(
Çme
, 
fd
, 0, 
SEEK_SET
);

692 
	`dowr™e
(
Çme
, 
fd
, 
wÜk¥aû
, 
bšsize
);

693 
	`doşo£
(
Çme
, 
fd
);

695 
	}
}

699 
	$m”gebšs
()

701 
šfds
[
num´ocs
], 
outfd
;

702 
v®ues
[
num´ocs
], 
»ady
[numprocs];

703 cÚ¡ *
Çme
, *
ouŠame
;

704 
i
, 
»suÉ
;

705 
num»ady
, 
¶aû
, 
v®
, 
wÜknum
;

707 
ouŠame
 = 
	`m”gedÇme
(
me
);

708 
outfd
 = 
	`doİ’
(
ouŠame
, 
O_WRONLY
|
O_CREAT
|
O_TRUNC
, 0664);

710 
i
=0; i<
num´ocs
; i++) {

711 
Çme
 = 
	`bšÇme
(
i
, 
me
);

712 
šfds
[
i
] = 
	`doİ’
(
Çme
, 
O_RDONLY
, 0);

713 
v®ues
[
i
] = 0;

714 
»ady
[
i
] = 0;

717 
wÜknum
 = 0;

720 
num»ady
 = 0;

721 
i
=0; i<
num´ocs
; i++) {

722 ià(
šfds
[
i
] < 0) {

726 ià(!
»ady
[
i
]) {

727 
»suÉ
 = 
	`dÜ—d
("bš", 
šfds
[
i
],

728 &
v®
, ());

729 ià(
»suÉ
 == 0) {

730 
	`doşo£
("bš", 
šfds
[
i
]);

731 
šfds
[
i
] = -1;

734 ià((
size_t
è
»suÉ
 != ()) {

735 
	`com¶ašx
("%s:„ead: short count",

736 
	`bšÇme
(
i
, 
me
));

737 
	`ex™
(1);

739 
v®ues
[
i
] = 
v®
;

740 
»ady
[
i
] = 1;

742 
num»ady
++;

744 ià(
num»ady
 == 0) {

749 
¶aû
 = -1;

750 
i
=0; i<
num´ocs
; i++) {

751 ià(!
»ady
[
i
]) {

754 ià(
¶aû
 < 0 || 
v®ues
[
i
] < 
v®
) {

755 
v®
 = 
v®ues
[
i
];

756 
¶aû
 = 
i
;

759 
	`as£¹
(
¶aû
 >= 0);

761 
wÜk¥aû
[
wÜknum
++] = 
v®
;

762 ià(
wÜknum
 >ğ
WORKNUM
) {

763 
	`as£¹
(
wÜknum
 =ğ
WORKNUM
);

764 
	`dowr™e
(
ouŠame
, 
outfd
, 
wÜk¥aû
,

765 
wÜknum
 * ());

766 
wÜknum
 = 0;

768 
»ady
[
¶aû
] = 0;

771 
	`dowr™e
(
ouŠame
, 
outfd
, 
wÜk¥aû
, 
wÜknum
 * ());

772 
	`doşo£
(
ouŠame
, 
outfd
);

774 
i
=0; i<
num´ocs
; i++) {

775 
	`as£¹
(
šfds
[
i
] < 0);

777 
	}
}

781 
	$as£mbË
()

783 
off_t
 
mypos
;

784 
i
, 
fd
;

785 cÚ¡ *
¬gs
[3];

787 
mypos
 = 0;

788 
i
=0; i<
me
; i++) {

789 
mypos
 +ğ
	`g‘size
(
	`m”gedÇme
(
i
));

792 
fd
 = 
	`doİ’
(
PATH_SORTED
, 
O_WRONLY
, 0);

793 
	`dŞ£ek
(
PATH_SORTED
, 
fd
, 
mypos
, 
SEEK_SET
);

795 ià(
	`dup2
(
fd
, 
STDOUT_FILENO
) < 0) {

796 
	`com¶aš
("dup2");

797 
	`ex™
(1);

800 
	`doşo£
(
PATH_SORTED
, 
fd
);

802 
¬gs
[0] = "cat";

803 
¬gs
[1] = 
	`m”gedÇme
(
me
);

804 
¬gs
[2] = 
NULL
;

805 
	`execv
("/bš/ÿt", (**è
¬gs
);

806 
	`com¶aš
("/bin/cat:ƒxec");

807 
	`ex™
(1);

808 
	}
}

812 
	$checksize_bšs
()

814 
off_t
 
tÙsize
;

815 
i
, 
j
;

817 
tÙsize
 = 0;

818 
i
=0; i<
num´ocs
; i++) {

819 
j
=0; j<
num´ocs
; j++) {

820 
tÙsize
 +ğ
	`g‘size
(
	`bšÇme
(
i
, 
j
));

823 ià(
tÙsize
 !ğ
cÜ»ùsize
) {

824 
	`com¶aš
("Sum of bin sizes is wrong (%ld, should be %ld)",

825 (è
tÙsize
, (è
cÜ»ùsize
);

826 
	`ex™
(1);

828 
	}
}

832 
	$checksize_m”ge
()

834 
off_t
 
tÙsize
;

835 
i
;

837 
tÙsize
 = 0;

838 
i
=0; i<
num´ocs
; i++) {

839 
tÙsize
 +ğ
	`g‘size
(
	`m”gedÇme
(
i
));

841 ià(
tÙsize
 !ğ
cÜ»ùsize
) {

842 
	`com¶aš
("Sum of merged sizes is wrong (%ld, should be %ld)",

843 (è
tÙsize
, (è
cÜ»ùsize
);

844 
	`ex™
(1);

846 
	}
}

850 
	$sÜt
()

852 
sÜ‹dsum
;

853 
i
, 
j
;

856 
	`dofÜk®l
("Tossšg", 
bš
);

857 
	`checksize_bšs
();

858 
	`com¶ašx
("Doneossing into bins.");

861 
	`dofÜk®l
("SÜtšg", 
sÜtbšs
);

862 
	`checksize_bšs
();

863 
	`com¶ašx
("Done sortinghe bins.");

866 
	`dofÜk®l
("M”gšg", 
m”gebšs
);

867 
	`checksize_m”ge
();

868 
	`com¶ašx
("Done merginghe bins.");

871 
i
=0; i<
num´ocs
; i++) {

872 
j
=0; j<
num´ocs
; j++) {

873 
	`dÜemove
(
	`bšÇme
(
i
, 
j
));

878 
	`doü—‹
(
PATH_SORTED
);

879 
	`dofÜk®l
("Fš®‡s£mbly", 
as£mbË
);

880 ià(
	`g‘size
(
PATH_SORTED
è!ğ
cÜ»ùsize
) {

881 
	`com¶ašx
("%s: fi wrÚg size", 
PATH_SORTED
);

882 
	`ex™
(1);

886 
i
=0; i<
num´ocs
; i++) {

887 
	`dÜemove
(
	`m”gedÇme
(
i
));

891 
sÜ‹dsum
 = 
	`checksum_fe
(
PATH_SORTED
);

892 
	`com¶ašx
("Checksum oàsÜ‹d keys: %ld", 
sÜ‹dsum
);

894 ià(
sÜ‹dsum
 !ğ
checksum
) {

895 
	`com¶ašx
("Sums do‚ot match");

896 
	`ex™
(1);

898 
	}
}

904 
	$v®idÇme
(
a
)

906 
rv
[32];

907 
	`¢´štf
(
rv
, Ôv), "v®id-%d", 
a
);

908  
rv
;

909 
	}
}

913 
	$checksize_v®id
()

915 
off_t
 
tÙvsize
, 
cÜ»ùvsize
;

916 
i
;

918 
cÜ»ùvsize
 = (
off_t
è
num´ocs
*2*();

920 
tÙvsize
 = 0;

921 
i
=0; i<
num´ocs
; i++) {

922 
tÙvsize
 +ğ
	`g‘size
(
	`v®idÇme
(
i
));

924 ià(
tÙvsize
 !ğ
cÜ»ùvsize
) {

925 
	`com¶ašx
("Sum of validation sizes is wrong "

927 (è
tÙvsize
, (è
cÜ»ùvsize
);

928 
	`ex™
(1);

930 
	}
}

934 
	$dov®id©e
()

936 cÚ¡ *
Çme
;

937 
fd
, 
i
, 
mykeys
, 
keys_dÚe
, 
keys_to_do
;

938 
key
, 
sm®Ë¡
, 
Ïrge¡
;

940 
Çme
 = 
PATH_SORTED
;

941 
fd
 = 
	`doİ’
(
Çme
, 
O_RDONLY
, 0);

943 
mykeys
 = 
	`g‘mykeys
();

944 
	`£ekmy¶aû
(
Çme
, 
fd
);

946 
sm®Ë¡
 = 
RANDOM_MAX
;

947 
Ïrge¡
 = 0;

949 
keys_dÚe
 = 0;

950 
keys_dÚe
 < 
mykeys
) {

951 
keys_to_do
 = 
mykeys
 - 
keys_dÚe
;

952 ià(
keys_to_do
 > 
WORKNUM
) {

953 
keys_to_do
 = 
WORKNUM
;

956 
	`dÛxaù»ad
(
Çme
, 
fd
, 
wÜk¥aû
, 
keys_to_do
 * ());

958 
i
=0; i<
keys_to_do
; i++) {

959 
key
 = 
wÜk¥aû
[
i
];

961 ià(
key
 < 0) {

962 
	`com¶aš
("%s: found‚eg©ivkey", 
Çme
);

963 
	`ex™
(1);

965 ià(
key
 == 0) {

966 
	`com¶aš
("%s: found z”Økey", 
Çme
);

967 
	`ex™
(1);

969 ià(
key
 >ğ
RANDOM_MAX
) {

970 
	`com¶aš
("%s: foundoo-Ïrgkey", 
Çme
);

971 
	`ex™
(1);

974 ià(
key
 < 
sm®Ë¡
) {

975 
sm®Ë¡
 = 
key
;

977 ià(
key
 > 
Ïrge¡
) {

978 
Ïrge¡
 = 
key
;

982 
keys_dÚe
 +ğ
keys_to_do
;

984 
	`doşo£
(
Çme
, 
fd
);

986 
Çme
 = 
	`v®idÇme
(
me
);

987 
fd
 = 
	`doİ’
(
Çme
, 
O_WRONLY
|
O_CREAT
|
O_TRUNC
, 0664);

988 
	`dowr™e
(
Çme
, 
fd
, &
sm®Ë¡
, (smallest));

989 
	`dowr™e
(
Çme
, 
fd
, &
Ïrge¡
, (largest));

990 
	`doşo£
(
Çme
, 
fd
);

991 
	}
}

995 
	$v®id©e
()

997 
sm®Ë¡
, 
Ïrge¡
, 
´ev_Ïrge¡
;

998 
i
, 
fd
;

999 cÚ¡ *
Çme
;

1001 
	`dofÜk®l
("V®id©iÚ", 
dov®id©e
);

1002 
	`checksize_v®id
();

1004 
´ev_Ïrge¡
 = 1;

1006 
i
=0; i<
num´ocs
; i++) {

1007 
Çme
 = 
	`v®idÇme
(
i
);

1008 
fd
 = 
	`doİ’
(
Çme
, 
O_RDONLY
, 0);

1010 
	`dÛxaù»ad
(
Çme
, 
fd
, &
sm®Ë¡
, ());

1011 
	`dÛxaù»ad
(
Çme
, 
fd
, &
Ïrge¡
, ());

1013 ià(
sm®Ë¡
 < 1) {

1014 
	`com¶ašx
("V®id©iÚ: block %d: bad SMALLEST", 
i
);

1015 
	`ex™
(1);

1017 ià(
Ïrge¡
 >ğ
RANDOM_MAX
) {

1018 
	`com¶ašx
("V®id©iÚ: block %d: bad LARGEST", 
i
);

1019 
	`ex™
(1);

1021 ià(
sm®Ë¡
 > 
Ïrge¡
) {

1022 
	`com¶ašx
("Validation: block %d: SMALLEST > LARGEST",

1023 
i
);

1024 
	`ex™
(1);

1027 ià(
sm®Ë¡
 < 
´ev_Ïrge¡
) {

1028 
	`com¶aš
("Validation: block %d smallest key %d",

1029 
i
, 
sm®Ë¡
);

1030 
	`com¶aš
("Validation:…revious block†argest key %d",

1031 
´ev_Ïrge¡
);

1032 
	`com¶aš
("Validation failed");

1033 
	`ex™
(1);

1038 
i
=0; i<
num´ocs
; i++) {

1039 
	`dÜemove
(
	`v®idÇme
(
i
));

1041 
	}
}

1047 
	$£tdœ
()

1050 
	`domkdœ
(
PATH_TESTDIR
, 0775);

1051 
	`dochdœ
(
PATH_TESTDIR
);

1053 
	}
}

1057 
	$un£tdœ
()

1059 
	`dÜemove
(
PATH_KEYS
);

1060 
	`dÜemove
(
PATH_SORTED
);

1062 
	`dochdœ
("..");

1064 ià(
	`rmdœ
(
PATH_TESTDIR
) < 0) {

1065 
	`com¶aš
("%s:„mdœ", 
PATH_TESTDIR
);

1069 
	}
}

1075 
	$¿ndomize
()

1077 
fd
;

1079 
fd
 = 
	`doİ’
(
PATH_RANDOM
, 
O_RDONLY
, 0);

1080 
	`dÛxaù»ad
(
PATH_RANDOM
, 
fd
, &
¿ndom£ed
, (randomseed));

1081 
	`doşo£
(
PATH_RANDOM
, 
fd
);

1082 
	}
}

1086 
	$u§ge
()

1088 
	`com¶aš
("U§ge: % [-°´ocs] [-k keys] [- £ed] [-r]", 
´ogÇme
);

1089 
	`ex™
(1);

1090 
	}
}

1094 
	$dßrgs
(
¬gc
, *
¬gv
[])

1096 
i
, 
ch
, 
v®
, 
¬g
;

1098 
i
=1; i<
¬gc
; i++) {

1099 ià(
¬gv
[
i
][0] != '-') {

1100 
	`u§ge
();

1103 
ch
 = 
¬gv
[
i
][1];

1104 
ch
) {

1105 'p': 
¬g
 = 1; ;

1106 'k': 
¬g
 = 1; ;

1107 's': 
¬g
 = 1; ;

1108 'r': 
¬g
 = 0; ;

1109 : 
	`u§ge
(); ;

1111 ià(
¬g
) {

1112 ià(
¬gv
[
i
][2]) {

1113 
v®
 = 
	`©oi
(
¬gv
[
i
]+2);

1116 
i
++;

1117 ià(!
¬gv
[
i
]) {

1118 
	`com¶aš
("Option -%c„equires‡n "

1119 "¬gum’t", 
ch
);

1120 
	`ex™
(1);

1122 
v®
 = 
	`©oi
(
¬gv
[
i
]);

1124 
ch
) {

1125 'p': 
num´ocs
 = 
v®
; ;

1126 'k': 
numkeys
 = 
v®
; ;

1127 's': 
¿ndom£ed
 = 
v®
; ;

1128 : 
	`as£¹
(0); ;

1132 
ch
) {

1133 'r': 
	`¿ndomize
(); ;

1134 : 
	`as£¹
(0); ;

1138 
	}
}

1141 
	$maš
(
¬gc
, *
¬gv
[])

1143 
	`š™´ogÇme
(
¬gc
 > 0 ? 
¬gv
[0] : 
NULL
);

1145 
	`dßrgs
(
¬gc
, 
¬gv
);

1146 
cÜ»ùsize
 = (
off_t
è(
numkeys
*());

1148 
	`£tdœ
();

1150 
	`g’keys
();

1151 
	`sÜt
();

1152 
	`v®id©e
();

1153 
	`com¶ašx
("Succeeded.");

1155 
	`un£tdœ
();

1158 
	}
}

	@randcall/calls.c

2 
	~<sys/ty³s.h
>

3 
	~<sys/¡©.h
>

4 
	~<as£¹.h
>

5 
	~<uni¡d.h
>

6 
	~<¡dio.h
>

7 
	~<¡dlib.h
>

8 
	~<”ºo.h
>

9 
	~<”r.h
>

11 
	~"ex‹º.h
"

13 (*
	tŒyfunc
)(
	tdofÜk
);

17 
	$Œy_execv
(
dofÜk
)

19 * 
a0
 = 
	`¿nd±r
();

20 * 
a1
 = 
	`¿nd±r
();

21 
»suÉ
, 
pid
, 
¡©us
;

22 
buf
[128];

24 
	`¢´štf
(
buf
, (buf), "execv(%p, %p)",

25 (
a0
), (
a1
));

26 
	`´štf
("%-47s", 
buf
);

28 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

29 ià(
pid
<0) {

30 
	`”r
(1, "fork");

32 ià(
pid
>0) {

33 
	`wa™pid
(
pid
, &
¡©us
, 0);

37 
»suÉ
 = 
	`execv
(
a0
, 
a1
);

38 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

39 ià(
dofÜk
) {

40 
	`ex™
(0);

42 
	}
}

46 
	$Œy_wa™pid
(
dofÜk
)

48 
a0
 = 
	`¿ndšt
();

49 * 
a1
 = 
	`¿nd±r
();

50 
a2
 = 
	`¿ndšt
();

51 
»suÉ
, 
pid
, 
¡©us
;

52 
buf
[128];

54 
	`¢´štf
(
buf
, (buf), "waitpid(%d, %p, %d)",

55 (
a0
), (
a1
), (
a2
));

56 
	`´štf
("%-47s", 
buf
);

58 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

59 ià(
pid
<0) {

60 
	`”r
(1, "fork");

62 ià(
pid
>0) {

63 
	`wa™pid
(
pid
, &
¡©us
, 0);

67 
»suÉ
 = 
	`wa™pid
(
a0
, 
a1
, 
a2
);

68 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

69 ià(
dofÜk
) {

70 
	`ex™
(0);

72 
	}
}

76 
	$Œy_İ’
(
dofÜk
)

78 * 
a0
 = 
	`¿nd±r
();

79 
a1
 = 
	`¿ndšt
();

80 
a2
 = 
	`¿ndšt
();

81 
»suÉ
, 
pid
, 
¡©us
;

82 
buf
[128];

84 
	`¢´štf
(
buf
, (buf), "open(%p, %d, %d)",

85 (
a0
), (
a1
), (
a2
));

86 
	`´štf
("%-47s", 
buf
);

88 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

89 ià(
pid
<0) {

90 
	`”r
(1, "fork");

92 ià(
pid
>0) {

93 
	`wa™pid
(
pid
, &
¡©us
, 0);

97 
»suÉ
 = 
	`İ’
(
a0
, 
a1
, 
a2
);

98 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

99 ià(
dofÜk
) {

100 
	`ex™
(0);

102 
	}
}

106 
	$Œy_»ad
(
dofÜk
)

108 
a0
 = 
	`¿ndšt
();

109 * 
a1
 = 
	`¿nd±r
();

110 
size_t
 
a2
 = 
	`¿ndsize
();

111 
»suÉ
, 
pid
, 
¡©us
;

112 
buf
[128];

114 
	`¢´štf
(
buf
, (buf), "read(%d, %p, %lu)",

115 (
a0
), (
a1
), ()(
a2
));

116 
	`´štf
("%-47s", 
buf
);

118 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

119 ià(
pid
<0) {

120 
	`”r
(1, "fork");

122 ià(
pid
>0) {

123 
	`wa™pid
(
pid
, &
¡©us
, 0);

127 
»suÉ
 = 
	`»ad
(
a0
, 
a1
, 
a2
);

128 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

129 ià(
dofÜk
) {

130 
	`ex™
(0);

132 
	}
}

136 
	$Œy_wr™e
(
dofÜk
)

138 
a0
 = 
	`¿ndšt
();

139 * 
a1
 = 
	`¿nd±r
();

140 
size_t
 
a2
 = 
	`¿ndsize
();

141 
»suÉ
, 
pid
, 
¡©us
;

142 
buf
[128];

144 
	`¢´štf
(
buf
, (buf), "write(%d, %p, %lu)",

145 (
a0
), (
a1
), ()(
a2
));

146 
	`´štf
("%-47s", 
buf
);

148 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

149 ià(
pid
<0) {

150 
	`”r
(1, "fork");

152 ià(
pid
>0) {

153 
	`wa™pid
(
pid
, &
¡©us
, 0);

157 
»suÉ
 = 
	`wr™e
(
a0
, 
a1
, 
a2
);

158 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

159 ià(
dofÜk
) {

160 
	`ex™
(0);

162 
	}
}

166 
	$Œy_şo£
(
dofÜk
)

168 
a0
 = 
	`¿ndšt
();

169 
»suÉ
, 
pid
, 
¡©us
;

170 
buf
[128];

172 
	`¢´štf
(
buf
, (buf), "close(%d)",

173 (
a0
));

174 
	`´štf
("%-47s", 
buf
);

176 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

177 ià(
pid
<0) {

178 
	`”r
(1, "fork");

180 ià(
pid
>0) {

181 
	`wa™pid
(
pid
, &
¡©us
, 0);

185 
»suÉ
 = 
	`şo£
(
a0
);

186 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

187 ià(
dofÜk
) {

188 
	`ex™
(0);

190 
	}
}

194 
	$Œy_ioùl
(
dofÜk
)

196 
a0
 = 
	`¿ndšt
();

197 
a1
 = 
	`¿ndšt
();

198 * 
a2
 = 
	`¿nd±r
();

199 
»suÉ
, 
pid
, 
¡©us
;

200 
buf
[128];

202 
	`¢´štf
(
buf
, (buf), "ioctl(%d, %d, %p)",

203 (
a0
), (
a1
), (
a2
));

204 
	`´štf
("%-47s", 
buf
);

206 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

207 ià(
pid
<0) {

208 
	`”r
(1, "fork");

210 ià(
pid
>0) {

211 
	`wa™pid
(
pid
, &
¡©us
, 0);

215 
»suÉ
 = 
	`ioùl
(
a0
, 
a1
, 
a2
);

216 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

217 ià(
dofÜk
) {

218 
	`ex™
(0);

220 
	}
}

224 
	$Œy_l£ek
(
dofÜk
)

226 
a0
 = 
	`¿ndšt
();

227 
off_t
 
a1
 = 
	`¿ndoff
();

228 
a2
 = 
	`¿ndšt
();

229 
»suÉ
, 
pid
, 
¡©us
;

230 
buf
[128];

232 
	`¢´štf
(
buf
, (buf), "lseek(%d, %ld, %d)",

233 (
a0
), ()(
a1
), (
a2
));

234 
	`´štf
("%-47s", 
buf
);

236 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

237 ià(
pid
<0) {

238 
	`”r
(1, "fork");

240 ià(
pid
>0) {

241 
	`wa™pid
(
pid
, &
¡©us
, 0);

245 
»suÉ
 = 
	`l£ek
(
a0
, 
a1
, 
a2
);

246 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

247 ià(
dofÜk
) {

248 
	`ex™
(0);

250 
	}
}

254 
	$Œy_fsync
(
dofÜk
)

256 
a0
 = 
	`¿ndšt
();

257 
»suÉ
, 
pid
, 
¡©us
;

258 
buf
[128];

260 
	`¢´štf
(
buf
, (buf), "fsync(%d)",

261 (
a0
));

262 
	`´štf
("%-47s", 
buf
);

264 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

265 ià(
pid
<0) {

266 
	`”r
(1, "fork");

268 ià(
pid
>0) {

269 
	`wa™pid
(
pid
, &
¡©us
, 0);

273 
»suÉ
 = 
	`fsync
(
a0
);

274 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

275 ià(
dofÜk
) {

276 
	`ex™
(0);

278 
	}
}

282 
	$Œy_árunÿ‹
(
dofÜk
)

284 
a0
 = 
	`¿ndšt
();

285 
off_t
 
a1
 = 
	`¿ndoff
();

286 
»suÉ
, 
pid
, 
¡©us
;

287 
buf
[128];

289 
	`¢´štf
(
buf
, (buf), "ftruncate(%d, %ld)",

290 (
a0
), ()(
a1
));

291 
	`´štf
("%-47s", 
buf
);

293 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

294 ià(
pid
<0) {

295 
	`”r
(1, "fork");

297 ià(
pid
>0) {

298 
	`wa™pid
(
pid
, &
¡©us
, 0);

302 
»suÉ
 = 
	`árunÿ‹
(
a0
, 
a1
);

303 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

304 ià(
dofÜk
) {

305 
	`ex™
(0);

307 
	}
}

311 
	$Œy_f¡©
(
dofÜk
)

313 
a0
 = 
	`¿ndšt
();

314 * 
a1
 = 
	`¿nd±r
();

315 
»suÉ
, 
pid
, 
¡©us
;

316 
buf
[128];

318 
	`¢´štf
(
buf
, (buf), "fstat(%d, %p)",

319 (
a0
), (
a1
));

320 
	`´štf
("%-47s", 
buf
);

322 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

323 ià(
pid
<0) {

324 
	`”r
(1, "fork");

326 ià(
pid
>0) {

327 
	`wa™pid
(
pid
, &
¡©us
, 0);

331 
»suÉ
 = 
	`f¡©
(
a0
, 
a1
);

332 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

333 ià(
dofÜk
) {

334 
	`ex™
(0);

336 
	}
}

340 
	$Œy_»move
(
dofÜk
)

342 * 
a0
 = 
	`¿nd±r
();

343 
»suÉ
, 
pid
, 
¡©us
;

344 
buf
[128];

346 
	`¢´štf
(
buf
, (buf), "remove(%p)",

347 (
a0
));

348 
	`´štf
("%-47s", 
buf
);

350 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

351 ià(
pid
<0) {

352 
	`”r
(1, "fork");

354 ià(
pid
>0) {

355 
	`wa™pid
(
pid
, &
¡©us
, 0);

359 
»suÉ
 = 
	`»move
(
a0
);

360 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

361 ià(
dofÜk
) {

362 
	`ex™
(0);

364 
	}
}

368 
	$Œy_»Çme
(
dofÜk
)

370 * 
a0
 = 
	`¿nd±r
();

371 * 
a1
 = 
	`¿nd±r
();

372 
»suÉ
, 
pid
, 
¡©us
;

373 
buf
[128];

375 
	`¢´štf
(
buf
, (buf), "rename(%p, %p)",

376 (
a0
), (
a1
));

377 
	`´štf
("%-47s", 
buf
);

379 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

380 ià(
pid
<0) {

381 
	`”r
(1, "fork");

383 ià(
pid
>0) {

384 
	`wa™pid
(
pid
, &
¡©us
, 0);

388 
»suÉ
 = 
	`»Çme
(
a0
, 
a1
);

389 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

390 ià(
dofÜk
) {

391 
	`ex™
(0);

393 
	}
}

397 
	$Œy_lšk
(
dofÜk
)

399 * 
a0
 = 
	`¿nd±r
();

400 * 
a1
 = 
	`¿nd±r
();

401 
»suÉ
, 
pid
, 
¡©us
;

402 
buf
[128];

404 
	`¢´štf
(
buf
, (buf), "link(%p, %p)",

405 (
a0
), (
a1
));

406 
	`´štf
("%-47s", 
buf
);

408 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

409 ià(
pid
<0) {

410 
	`”r
(1, "fork");

412 ià(
pid
>0) {

413 
	`wa™pid
(
pid
, &
¡©us
, 0);

417 
»suÉ
 = 
	`lšk
(
a0
, 
a1
);

418 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

419 ià(
dofÜk
) {

420 
	`ex™
(0);

422 
	}
}

426 
	$Œy_mkdœ
(
dofÜk
)

428 * 
a0
 = 
	`¿nd±r
();

429 
a1
 = 
	`¿ndšt
();

430 
»suÉ
, 
pid
, 
¡©us
;

431 
buf
[128];

433 
	`¢´štf
(
buf
, (buf), "mkdir(%p, %d)",

434 (
a0
), (
a1
));

435 
	`´štf
("%-47s", 
buf
);

437 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

438 ià(
pid
<0) {

439 
	`”r
(1, "fork");

441 ià(
pid
>0) {

442 
	`wa™pid
(
pid
, &
¡©us
, 0);

446 
»suÉ
 = 
	`mkdœ
(
a0
, 
a1
);

447 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

448 ià(
dofÜk
) {

449 
	`ex™
(0);

451 
	}
}

455 
	$Œy_rmdœ
(
dofÜk
)

457 * 
a0
 = 
	`¿nd±r
();

458 
»suÉ
, 
pid
, 
¡©us
;

459 
buf
[128];

461 
	`¢´štf
(
buf
, (buf), "rmdir(%p)",

462 (
a0
));

463 
	`´štf
("%-47s", 
buf
);

465 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

466 ià(
pid
<0) {

467 
	`”r
(1, "fork");

469 ià(
pid
>0) {

470 
	`wa™pid
(
pid
, &
¡©us
, 0);

474 
»suÉ
 = 
	`rmdœ
(
a0
);

475 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

476 ià(
dofÜk
) {

477 
	`ex™
(0);

479 
	}
}

483 
	$Œy_chdœ
(
dofÜk
)

485 * 
a0
 = 
	`¿nd±r
();

486 
»suÉ
, 
pid
, 
¡©us
;

487 
buf
[128];

489 
	`¢´štf
(
buf
, (buf), "chdir(%p)",

490 (
a0
));

491 
	`´štf
("%-47s", 
buf
);

493 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

494 ià(
pid
<0) {

495 
	`”r
(1, "fork");

497 ià(
pid
>0) {

498 
	`wa™pid
(
pid
, &
¡©us
, 0);

502 
»suÉ
 = 
	`chdœ
(
a0
);

503 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

504 ià(
dofÜk
) {

505 
	`ex™
(0);

507 
	}
}

511 
	$Œy_g‘dœ’Œy
(
dofÜk
)

513 
a0
 = 
	`¿ndšt
();

514 * 
a1
 = 
	`¿nd±r
();

515 
size_t
 
a2
 = 
	`¿ndsize
();

516 
»suÉ
, 
pid
, 
¡©us
;

517 
buf
[128];

519 
	`¢´štf
(
buf
, (buf), "getdirentry(%d, %p, %lu)",

520 (
a0
), (
a1
), ()(
a2
));

521 
	`´štf
("%-47s", 
buf
);

523 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

524 ià(
pid
<0) {

525 
	`”r
(1, "fork");

527 ià(
pid
>0) {

528 
	`wa™pid
(
pid
, &
¡©us
, 0);

532 
»suÉ
 = 
	`g‘dœ’Œy
(
a0
, 
a1
, 
a2
);

533 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

534 ià(
dofÜk
) {

535 
	`ex™
(0);

537 
	}
}

541 
	$Œy_symlšk
(
dofÜk
)

543 * 
a0
 = 
	`¿nd±r
();

544 * 
a1
 = 
	`¿nd±r
();

545 
»suÉ
, 
pid
, 
¡©us
;

546 
buf
[128];

548 
	`¢´štf
(
buf
, (buf), "symlink(%p, %p)",

549 (
a0
), (
a1
));

550 
	`´štf
("%-47s", 
buf
);

552 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

553 ià(
pid
<0) {

554 
	`”r
(1, "fork");

556 ià(
pid
>0) {

557 
	`wa™pid
(
pid
, &
¡©us
, 0);

561 
»suÉ
 = 
	`symlšk
(
a0
, 
a1
);

562 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

563 ià(
dofÜk
) {

564 
	`ex™
(0);

566 
	}
}

570 
	$Œy_»adlšk
(
dofÜk
)

572 * 
a0
 = 
	`¿nd±r
();

573 * 
a1
 = 
	`¿nd±r
();

574 
size_t
 
a2
 = 
	`¿ndsize
();

575 
»suÉ
, 
pid
, 
¡©us
;

576 
buf
[128];

578 
	`¢´štf
(
buf
, (buf), "readlink(%p, %p, %lu)",

579 (
a0
), (
a1
), ()(
a2
));

580 
	`´štf
("%-47s", 
buf
);

582 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

583 ià(
pid
<0) {

584 
	`”r
(1, "fork");

586 ià(
pid
>0) {

587 
	`wa™pid
(
pid
, &
¡©us
, 0);

591 
»suÉ
 = 
	`»adlšk
(
a0
, 
a1
, 
a2
);

592 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

593 ià(
dofÜk
) {

594 
	`ex™
(0);

596 
	}
}

600 
	$Œy_dup2
(
dofÜk
)

602 
a0
 = 
	`¿ndšt
();

603 
a1
 = 
	`¿ndšt
();

604 
»suÉ
, 
pid
, 
¡©us
;

605 
buf
[128];

607 
	`¢´štf
(
buf
, (buf), "dup2(%d, %d)",

608 (
a0
), (
a1
));

609 
	`´štf
("%-47s", 
buf
);

611 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

612 ià(
pid
<0) {

613 
	`”r
(1, "fork");

615 ià(
pid
>0) {

616 
	`wa™pid
(
pid
, &
¡©us
, 0);

620 
»suÉ
 = 
	`dup2
(
a0
, 
a1
);

621 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

622 ià(
dofÜk
) {

623 
	`ex™
(0);

625 
	}
}

629 
	$Œy_pe
(
dofÜk
)

631 * 
a0
 = 
	`¿nd±r
();

632 
»suÉ
, 
pid
, 
¡©us
;

633 
buf
[128];

635 
	`¢´štf
(
buf
, (buf), "pipe(%p)",

636 (
a0
));

637 
	`´štf
("%-47s", 
buf
);

639 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

640 ià(
pid
<0) {

641 
	`”r
(1, "fork");

643 ià(
pid
>0) {

644 
	`wa™pid
(
pid
, &
¡©us
, 0);

648 
»suÉ
 = 
	`pe
(
a0
);

649 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

650 ià(
dofÜk
) {

651 
	`ex™
(0);

653 
	}
}

657 
	$Œy___time
(
dofÜk
)

659 * 
a0
 = 
	`¿nd±r
();

660 * 
a1
 = 
	`¿nd±r
();

661 
»suÉ
, 
pid
, 
¡©us
;

662 
buf
[128];

664 
	`¢´štf
(
buf
, (buf), "__time(%p, %p)",

665 (
a0
), (
a1
));

666 
	`´štf
("%-47s", 
buf
);

668 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

669 ià(
pid
<0) {

670 
	`”r
(1, "fork");

672 ià(
pid
>0) {

673 
	`wa™pid
(
pid
, &
¡©us
, 0);

677 
»suÉ
 = 
	`__time
(
a0
, 
a1
);

678 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

679 ià(
dofÜk
) {

680 
	`ex™
(0);

682 
	}
}

686 
	$Œy___g‘cwd
(
dofÜk
)

688 * 
a0
 = 
	`¿nd±r
();

689 
size_t
 
a1
 = 
	`¿ndsize
();

690 
»suÉ
, 
pid
, 
¡©us
;

691 
buf
[128];

693 
	`¢´štf
(
buf
, (buf), "__getcwd(%p, %lu)",

694 (
a0
), ()(
a1
));

695 
	`´štf
("%-47s", 
buf
);

697 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

698 ià(
pid
<0) {

699 
	`”r
(1, "fork");

701 ià(
pid
>0) {

702 
	`wa™pid
(
pid
, &
¡©us
, 0);

706 
»suÉ
 = 
	`__g‘cwd
(
a0
, 
a1
);

707 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

708 ià(
dofÜk
) {

709 
	`ex™
(0);

711 
	}
}

715 
	$Œy_¡©
(
dofÜk
)

717 * 
a0
 = 
	`¿nd±r
();

718 * 
a1
 = 
	`¿nd±r
();

719 
»suÉ
, 
pid
, 
¡©us
;

720 
buf
[128];

722 
	`¢´štf
(
buf
, (buf), "stat(%p, %p)",

723 (
a0
), (
a1
));

724 
	`´štf
("%-47s", 
buf
);

726 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

727 ià(
pid
<0) {

728 
	`”r
(1, "fork");

730 ià(
pid
>0) {

731 
	`wa™pid
(
pid
, &
¡©us
, 0);

735 
»suÉ
 = 
	`¡©
(
a0
, 
a1
);

736 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

737 ià(
dofÜk
) {

738 
	`ex™
(0);

740 
	}
}

744 
	$Œy_l¡©
(
dofÜk
)

746 * 
a0
 = 
	`¿nd±r
();

747 * 
a1
 = 
	`¿nd±r
();

748 
»suÉ
, 
pid
, 
¡©us
;

749 
buf
[128];

751 
	`¢´štf
(
buf
, (buf), "lstat(%p, %p)",

752 (
a0
), (
a1
));

753 
	`´štf
("%-47s", 
buf
);

755 
pid
 = 
dofÜk
 ? 
	`fÜk
() : 0;

756 ià(
pid
<0) {

757 
	`”r
(1, "fork");

759 ià(
pid
>0) {

760 
	`wa™pid
(
pid
, &
¡©us
, 0);

764 
»suÉ
 = 
	`l¡©
(
a0
, 
a1
);

765 
	`´štf
("„esuÉ %d,ƒ¼nØ%d\n", 
»suÉ
, 
”ºo
);

766 ià(
dofÜk
) {

767 
	`ex™
(0);

769 
	}
}

771 
Œyfunc
 
	gfuncs2
[] = {

772 
Œy_execv
,

773 
Œy_wa™pid
,

774 
Œy_İ’
,

775 
Œy_»ad
,

776 
Œy_wr™e
,

777 
Œy_şo£
,

778 
Œy_l£ek
,

779 
Œy_chdœ
,

780 
Œy_dup2
,

781 
Œy___g‘cwd
,

782 
NULL


785 
Œyfunc
 
	gfuncs3
[] = {

786 
Œy_execv
,

787 
Œy_wa™pid
,

788 
Œy_İ’
,

789 
Œy_»ad
,

790 
Œy_wr™e
,

791 
Œy_şo£
,

792 
Œy_l£ek
,

793 
Œy_chdœ
,

794 
Œy_dup2
,

795 
Œy___g‘cwd
,

796 
NULL


799 
Œyfunc
 
	gfuncs4
[] = {

800 
Œy_execv
,

801 
Œy_wa™pid
,

802 
Œy_İ’
,

803 
Œy_»ad
,

804 
Œy_wr™e
,

805 
Œy_şo£
,

806 
Œy_l£ek
,

807 
Œy_fsync
,

808 
Œy_árunÿ‹
,

809 
Œy_f¡©
,

810 
Œy_»move
,

811 
Œy_»Çme
,

812 
Œy_mkdœ
,

813 
Œy_rmdœ
,

814 
Œy_chdœ
,

815 
Œy_g‘dœ’Œy
,

816 
Œy_dup2
,

817 
Œy___g‘cwd
,

818 
NULL


821 
Œyfunc
 
	gfuncs5
[] = {

822 
Œy_execv
,

823 
Œy_wa™pid
,

824 
Œy_İ’
,

825 
Œy_»ad
,

826 
Œy_wr™e
,

827 
Œy_şo£
,

828 
Œy_ioùl
,

829 
Œy_l£ek
,

830 
Œy_fsync
,

831 
Œy_árunÿ‹
,

832 
Œy_f¡©
,

833 
Œy_»move
,

834 
Œy_»Çme
,

835 
Œy_lšk
,

836 
Œy_mkdœ
,

837 
Œy_rmdœ
,

838 
Œy_chdœ
,

839 
Œy_g‘dœ’Œy
,

840 
Œy_symlšk
,

841 
Œy_»adlšk
,

842 
Œy_dup2
,

843 
Œy_pe
,

844 
Œy___time
,

845 
Œy___g‘cwd
,

846 
Œy_¡©
,

847 
Œy_l¡©
,

848 
NULL


851 
Œyfunc
 *
	gbËs
[4] = {

852 
funcs2
,

853 
funcs3
,

854 
funcs4
,

855 
funcs5
,

859 
	$ŒyÿÎs
(
as¡
, 
dofÜk
, 
couÁ
)

861 
Œyfunc
 *
li¡
;

862 
i
, 
j
;

864 
	`as£¹
(
as¡
>=2 &&‡sst<=5);

865 
li¡
 = 
bËs
[
as¡
-2];

867 
i
=0; i<
couÁ
; i++) {

868 
j
=0; 
li¡
[j]; j++) {

869 (*
li¡
[
j
])(
dofÜk
);

872 
	}
}

	@randcall/extern.h

30 
	~<sys/ty³s.h
>

32 *
¿nd±r
();

33 
¿ndšt
();

34 
off_t
 
¿ndoff
();

35 
size_t
 
¿ndsize
();

37 
ŒyÿÎs
(
as¡
, 
dofÜk
, 
couÁ
);

	@randcall/main.c

30 
	~<¡dlib.h
>

31 
	~<¡dio.h
>

32 
	~<¡ršg.h
>

34 
	~"ex‹º.h
"

38 
	$¿ndch¬
(*
c
)

40 #ià
RAND_MAX
 != 0x7fffffff

44 
lb™s
 = 0;

45 
Êum
 = 0;

47 
b™
;

48 
ù
 = 0;

50 *
c
 = 0;

52 
ù
 < 
CHAR_BIT
) {

53 ià(
Êum
==0) {

54 
lb™s
 = 
	`¿ndom
();

55 
Êum
 = 31;

58 
b™
 = 
lb™s
 & 1;

59 ià(
b™
) {

60 (*
c
) |= 1;

62 (*
c
) <<= 1;

63 
ù
++;

64 
lb™s
 >>= 1;

65 
Êum
--;

67 
	}
}

71 
	$fÌªd
(*
p
, 
size_t
 
Ën
)

73 
size_t
 
i
;

74 *
ı
 = 
p
;

75 
i
=0; i<
Ën
; i++) {

76 
	`¿ndch¬
(&
ı
[
i
]);

78 
	}
}

81 
	$¿nd±r
()

83 *
x
;

84 
	`fÌªd
(&
x
, (x));

85  
x
;

86 
	}
}

89 
	$¿ndšt
()

91 
x
;

92 
	`fÌªd
(&
x
, (x));

93  
x
;

94 
	}
}

96 
off_t


97 
	$¿ndoff
()

99 
off_t
 
x
;

100 
	`fÌªd
(&
x
, (x));

101  
x
;

102 
	}
}

104 
size_t


105 
	$¿ndsize
()

107 
size_t
 
x
;

108 
	`fÌªd
(&
x
, (x));

109  
x
;

110 
	}
}

114 
	$u§ge
()

116 
	`´štf
("Usage:„andcall [-f] [-c count] [-r seed] 2|3|4|all\n");

117 
	`´štf
(" -f suppress forking\n");

118 
	`´štf
(" -c set iteration count (default 100)\n");

119 
	`´štf
(" -r set…seudorandom seed (default 0)\n");

120 
	`ex™
(1);

121 
	}
}

124 
	$maš
(
¬gc
, *
¬gv
[])

126 
couÁ
=100, 
£ed
 = 0, 
dofÜk
 = 1;

127 
ª
, 
i
;

129 
i
=1; i<
¬gc
; i++) {

130 ià(!
	`¡rcmp
(
¬gv
[
i
], "-f")) {

131 
dofÜk
 = 0;

133 ià(!
	`¡rcmp
(
¬gv
[
i
], "-c"è&& i<
¬gc
-1) {

134 
couÁ
 = 
	`©oi
(
¬gv
[++
i
]);

136 ià(!
	`¡rcmp
(
¬gv
[
i
], "-r"è&& i<
¬gc
-1) {

137 
£ed
 = 
	`©oi
(
¬gv
[++
i
]);

139 ià(
¬gv
[
i
][0] == '-') {

140 
	`u§ge
();

146 ià(
i
 !ğ
¬gc
-1) {

147 
	`u§ge
();

150 ià(!
	`¡rcmp
(
¬gv
[
i
], "all")) {

151 
ª
 = 5;

154 
ª
 = 
	`©oi
(
¬gv
[
i
]);

155 ià(
ª
 <2 ||‡n > 4) {

156 
	`u§ge
();

160 
	`´štf
("S“d: %d CouÁ: %d\n", 
£ed
, 
couÁ
);

162 
	`¤ªdom
(
£ed
);

163 
	`ŒyÿÎs
(
ª
, 
dofÜk
, 
couÁ
);

166 
	}
}

	@rmdirtest/rmdirtest.c

39 
	~<sys/ty³s.h
>

40 
	~<sys/¡©.h
>

41 
	~<¡dio.h
>

42 
	~<¡ršg.h
>

43 
	~<uni¡d.h
>

44 
	~<fú.h
>

45 
	~<”ºo.h
>

46 
	~<lim™s.h
>

47 
	~<”r.h
>

50 cÚ¡ 
	g‹¡dœ
[] = "testdir";

51 
	g¡¬ošt
[
PATH_MAX
 - (
‹¡dœ
)];

60 
	$¡¬tup
()

62 ià(
	`g‘cwd
(
¡¬ošt
, (¡¬ošt))==
NULL
) {

63 
	`”r
(1, "getcwd (not inest dir)");

66 ià(
	`mkdœ
(
‹¡dœ
, 0775) < 0) {

67 
	`”r
(1, "%s: mkdœ", 
‹¡dœ
);

70 ià(
	`chdœ
(
‹¡dœ
) < 0) {

71 
	`”r
(1, "%s: chdœ", 
‹¡dœ
);

73 
	}
}

85 
	$kldœ
()

87 
tmp
[
PATH_MAX
];

89 
	`¢´štf
(
tmp
, Ñmp), "%s/%s", 
¡¬ošt
, 
‹¡dœ
);

90 ià(
	`rmdœ
(
tmp
)<0) {

91 
	`”r
(1, "%s:„mdœ", 
tmp
);

93 
	}
}

102 
	$fšish
()

104 ià(
	`chdœ
(
¡¬ošt
)<0) {

105 
	`”r
(1, "%s: chdœ", 
¡¬ošt
);

107 
	}
}

117 
	$‹¡1
()

119 
	`´štf
("Makšg %s\n", 
‹¡dœ
);

120 
	`¡¬tup
();

122 
	`´štf
("Removšg % whš it\n", 
‹¡dœ
);

123 
	`kldœ
();

125 
	`´štf
("Leavingheest directory\n");

126 
	`fšish
();

127 
	}
}

135 
	$‹¡2
()

137 
fd
;

139 
	`´štf
("Nowrying withhe directory open...\n");

140 
	`¡¬tup
();

141 
fd
 = 
	`İ’
(".", 
O_RDONLY
);

142 ià(
fd
<0) {

143 
	`”r
(1, ".: open");

145 
	`kldœ
();

146 
	`fšish
();

149 ià(
	`şo£
(
fd
)<0) {

150 
	`”r
(1, "»moved %s: clo£", 
‹¡dœ
);

152 
	}
}

160 
	$‹¡3
()

162 
buf
[
PATH_MAX
];

163 
fd
;

165 
	`´štf
("Checking if .ƒxists‡fter„mdir\n");

166 
	`¡¬tup
();

167 
	`kldœ
();

169 
fd
 = 
	`İ’
(".", 
O_RDONLY
);

170 ià(
fd
<0) {

171 
”ºo
) {

172 
EINVAL
:

173 
EIO
:

174 
ENOENT
:

177 
	`”r
(1, ".");

182 
	`şo£
(
fd
);

185 
fd
 = 
	`İ’
("..", 
O_RDONLY
);

186 ià(
fd
<0) {

187 
”ºo
) {

188 
EINVAL
:

189 
EIO
:

190 
ENOENT
:

193 
	`”r
(1, "..");

198 
	`w¬nx
("..: openable‡fter„mdir - might be bad");

199 
	`şo£
(
fd
);

202 
	`¢´štf
(
buf
, (buf), "../%s", 
‹¡dœ
);

203 
fd
 = 
	`İ’
(
buf
, 
O_RDONLY
);

204 ià(
fd
<0) {

205 
”ºo
) {

206 
EINVAL
:

207 
EIO
:

208 
ENOENT
:

211 
	`”r
(1, "%s", 
buf
);

216 
	`”rx
(1, "%s: wÜk aá”„mdœ", 
buf
);

219 
	`fšish
();

220 
	}
}

228 
	$‹¡4
()

230 
buf
[4096];

231 
fd
;

233 
	`´štf
("Checking if creating files works‡fter„mdir...\n");

234 
	`¡¬tup
();

235 
	`kldœ
();

237 
fd
 = 
	`İ’
("Ãwfe", 
O_WRONLY
|
O_CREAT
|
O_TRUNC
, 0664);

238 ià(
fd
<0) {

239 
”ºo
) {

240 
EINVAL
:

241 
EIO
:

242 
ENOENT
:

245 
	`”r
(1, "%s", 
buf
);

250 
	`w¬nx
("newfile: creating files‡fter„mdir works");

251 
	`w¬nx
("(this is only ok ifhe space gets„eclaimed)");

256 
	`mem£t
(
buf
, 'J', (buf));

257 
	`wr™e
(
fd
, 
buf
, (buf));

258 
	`wr™e
(
fd
, 
buf
, (buf));

259 
	`wr™e
(
fd
, 
buf
, (buf));

260 
	`wr™e
(
fd
, 
buf
, (buf));

261 
	`şo£
(
fd
);

264 
	`fšish
();

265 
	}
}

273 
	$‹¡5
()

275 
	`´štf
("Checking if creating subdirs works‡fter„mdir...\n");

276 
	`¡¬tup
();

277 
	`kldœ
();

279 ià(
	`mkdœ
("newdir", 0775)<0) {

280 
”ºo
) {

281 
EINVAL
:

282 
EIO
:

283 
ENOENT
:

286 
	`”r
(1, "mkdir in„emoved dir");

291 
	`w¬nx
("newfile: creating directories‡fter„mdir works");

292 
	`w¬nx
("(this is only ok ifhe space gets„eclaimed)");

297 
	`mkdœ
("newdir/t0", 0775);

298 
	`mkdœ
("newdir/t1", 0775);

299 
	`mkdœ
("newdir/t2", 0775);

300 
	`mkdœ
("newdir/t3", 0775);

301 
	`mkdœ
("newdir/t4", 0775);

302 
	`mkdœ
("newdir/t5", 0775);

305 
	`fšish
();

306 
	}
}

313 
	$‹¡6
()

315 
buf
[
PATH_MAX
];

316 
fd
, 
Ën
;

318 
	`´štf
("Nowryingo†isthe directory...\n");

319 
	`¡¬tup
();

320 
fd
 = 
	`İ’
(".", 
O_RDONLY
);

321 ià(
fd
<0) {

322 
	`”r
(1, ".: open");

324 
	`kldœ
();

326 (
Ën
 = 
	`g‘dœ’Œy
(
fd
, 
buf
, (buf)-1))>0) {

327 ià(()
Ën
 >ğ(
buf
)-1) {

328 
	`”rx
(1, ".: getdirentry:„eturned invalid†ength");

330 
buf
[
Ën
] = 0;

331 ià(!
	`¡rcmp
(
buf
, ".") || !strcmp(buf, "..")) {

335 
	`”rx
(1, ".: g‘dœ’Œy:„‘uºed uÃx³ùed‚am%s", 
buf
);

337 ià(
Ën
==0) {

341 
”ºo
) {

342 
EINVAL
:

343 
EIO
:

346 
	`”r
(1, ".: getdirentry");

351 
	`fšish
();

354 ià(
	`şo£
(
fd
)<0) {

355 
	`”r
(1, "»moved %s: clo£", 
‹¡dœ
);

357 
	}
}

364 
	$‹¡7
()

366 
buf
[
PATH_MAX
];

368 
	`¡¬tup
();

369 
	`kldœ
();

370 ià(
	`g‘cwd
(
buf
, (buf))==
NULL
) {

371 
”ºo
) {

372 
EINVAL
:

373 
EIO
:

374 
ENOENT
:

377 
	`”r
(1, "g‘cwd‡á”„emovšg %s", 
‹¡dœ
);

382 
	`”rx
(1, "getcwd‡fter„emoving %s: succeeded (got %s)",

383 
‹¡dœ
, 
buf
);

386 
	`fšish
();

387 
	}
}

392 
	$maš
()

394 
	`‹¡1
();

395 
	`‹¡2
();

396 
	`‹¡3
();

397 
	`‹¡4
();

398 
	`‹¡5
();

399 
	`‹¡6
();

400 
	`‹¡7
();

402 
	`´štf
("Whew... survived.\n");

404 
	}
}

	@rmtest/rmtest.c

39 
	~<¡dio.h
>

40 
	~<¡dlib.h
>

41 
	~<¡ršg.h
>

42 
	~<uni¡d.h
>

43 
	~<”ºo.h
>

44 
	~<”r.h
>

46 
	#TEST
 "rmd©a"

	)

47 
	#TESTDATA
 "I wish I wa ¨h—dlight. -- J”ry G¬cŸ"

	)

48 
	#TESTLEN
 ((
TESTDATA
)-1)

	)

52 
	$dÜm
(
fd
)

63 
pid_t
 
pid
;

64 
¡©us
;

66 
pid
 = 
	`fÜk
();

67 ià(
pid
<0) {

68 
	`”r
(1, "fork");

70 ià(
pid
==0) {

72 
	`şo£
(
fd
);

73 ià(
	`»move
(
TEST
)) {

74 
	`”r
(1, "%s:„emove", 
TEST
);

76 
	`_ex™
(0);

79 ià(
	`wa™pid
(
pid
, &
¡©us
, 0)<0) {

80 
	`”r
(1, "waitpid");

82 ià(
	`WIFSIGNALED
(
¡©us
)) {

83 
	`w¬n
("chd…roûs ex™ed w™h sigÇÈ%d", 
	`WTERMSIG
(
¡©us
));

85 ià(
	`WEXITSTATUS
(
¡©us
) != 0) {

86 
	`w¬nx
("chd…roûs ex™ed w™h cod%d",
	`WEXITSTATUS
(
¡©us
));

88 
	}
}

92 
	$§me
(cÚ¡ *
a
, cÚ¡ *
b
, 
Ën
)

94 
Ën
-- > 0) {

95 ià(*
a
++ !ğ*
b
++)  0;

98 
	}
}

101 
	$maš
()

103 
fe
, 
Ën
;

104 
buf
[
TESTLEN
];

107 
fe
 = 
	`İ’
(
TEST
, 
O_WRONLY
 | 
O_CREAT
 | 
O_TRUNC
, 0664);

108 
	`wr™e
(
fe
, 
TESTDATA
, 
TESTLEN
);

109 
	`şo£
(
fe
);

112 
fe
 = 
	`İ’
(
TEST
, 
O_RDONLY
);

113 
Ën
 = 
	`»ad
(
fe
, 
buf
, 
TESTLEN
);

114 ià(
Ën
 < 0) {

115 
	`w¬n
("read: before deletion");

117 ià(
Ën
 < ()
TESTLEN
) {

118 
	`w¬nx
("»ad: befÜd–‘iÚ: shÜˆcouÁ %d", 
Ën
);

120 ià(!
	`§me
(
buf
, 
TESTDATA
, 
TESTLEN
)) {

121 
	`”rx
(1, "Failed: data„ead back was‚othe same");

125 ià(
	`l£ek
(
fe
, 0, 
SEEK_SET
)) {

126 
	`”r
(1, "lseek");

130 
	`dÜm
(
fe
);

133 
	`mem£t
(
buf
, '\0', 
TESTLEN
);

134 
Ën
 = 
	`»ad
(
fe
, 
buf
, 
TESTLEN
);

135 ià(
Ën
 < 0) {

136 
	`w¬n
("read:‡fter deletion");

138 ià(
Ën
 < ()
TESTLEN
) {

139 
	`w¬nx
("»ad:‡á” d–‘iÚ: shÜˆcouÁ %d", 
Ën
);

142 ià(!
	`§me
(
buf
, 
TESTDATA
, 
TESTLEN
)) {

143 
	`”rx
(1, "Failed: data„ead‡fter deletion was‚othe same");

147 
	`şo£
(
fe
);

150 
fe
 = 
	`İ’
(
TEST
, 
O_RDONLY
);

151 ià(
fe
 >= 0) {

152 
	`şo£
(
fe
);

153 
	`”rx
(1, "Failed:he file could still be opened");

156 ià(
”ºo
!=
ENOENT
) {

157 
	`”r
(1, "Unexpectedƒrror„eopeninghe file");

160 
	`´štf
("Succeeded!\n");

163 
	}
}

	@sink/sink.c

38 
	~<uni¡d.h
>

39 
	~<”r.h
>

42 
	$maš
()

44 
ch
=0;

45 
r
;

47 
ch
!='q') {

48 
r
 = 
	`»ad
(
STDIN_FILENO
, &
ch
, 1);

49 ià(
r
<0) {

50 
	`”r
(1, "stdin");

52 ià(
r
==0) {

59 
	}
}

	@sort/sort.c

39 
	~<¡dlib.h
>

40 
	~<¡ršg.h
>

41 
	~<”r.h
>

44 
	#SIZE
 (144*1024)

	)

59 
	$sÜt
(*
¬r
, 
size
)

61 
tmp
[
SIZE
];

62 
pivÙ
, 
i
, 
j
, 
k
;

64 ià(
size
<2) {

68 
pivÙ
 = 
size
/2;

69 
	`sÜt
(
¬r
, 
pivÙ
);

70 
	`sÜt
(&
¬r
[
pivÙ
], 
size
-pivot);

72 
i
 = 0;

73 
j
 = 
pivÙ
;

74 
k
 = 0;

75 
i
<
pivÙ
 && 
j
<
size
) {

76 ià(
¬r
[
i
] <‡¼[
j
]) {

77 
tmp
[
k
++] = 
¬r
[
i
++];

80 
tmp
[
k
++] = 
¬r
[
j
++];

83 
i
<
pivÙ
) {

84 
tmp
[
k
++] = 
¬r
[
i
++];

86 
j
<
size
) {

87 
tmp
[
k
++] = 
¬r
[
j
++];

90 
	`memıy
(
¬r
, 
tmp
, 
size
*());

91 
	}
}

95 
	gA
[
SIZE
];

99 
	$š™¬¿y
()

101 
i
;

106 
	`¤ªdom
(533);

108 
i
 = 0; i < 
SIZE
; i++) {

109 
A
[
i
] = 
	`¿ndom
();

111 
	}
}

115 
	$check
()

117 
i
;

119 
i
=0; i<
SIZE
-1; i++) {

120 ià(
A
[
i
] > A[i+1]) {

121 
	`”rx
(1, "Failed: A[%d] is %d, A[%d] is %d",

122 
i
, 
A
[i], i+1, A[i+1]);

125 
	`w¬nx
("Passed.");

126 
	}
}

129 
	$maš
()

131 
	`š™¬¿y
();

132 
	`sÜt
(
A
, 
SIZE
);

133 
	`check
();

135 
	}
}

	@sty/sty.c

39 
	~<uni¡d.h
>

40 
	~<”r.h
>

42 *
	gh¬gv
[2] = { (*)"hog", 
NULL
 };

44 
	#MAXPROCS
 6

	)

45 
	gpids
[
MAXPROCS
], 
	gÅids
;

49 
	$hog
()

51 
pid
 = 
	`fÜk
();

52 
pid
) {

54 
	`”r
(1, "fork");

57 
	`execv
("/‹¡bš/hog", 
h¬gv
);

58 
	`”r
(1, "/testbin/hog");

61 
pids
[
Åids
++] = 
pid
;

64 
	}
}

68 
	$wa™®l
()

70 
i
, 
¡©us
;

71 
i
=0; i<
Åids
; i++) {

72 ià(
	`wa™pid
(
pids
[
i
], &
¡©us
, 0)<0) {

73 
	`w¬n
("wa™pid fÜ %d", 
pids
[
i
]);

75 ià(
	`WIFSIGNALED
(
¡©us
)) {

76 
	`w¬nx
("pid %d: sigÇÈ%d", 
pids
[
i
], 
	`WTERMSIG
(
¡©us
));

78 ià(
	`WEXITSTATUS
(
¡©us
) != 0) {

79 
	`w¬nx
("pid %d:ƒx™ %d", 
pids
[
i
], 
	`WEXITSTATUS
(
¡©us
));

82 
	}
}

85 
	$maš
()

87 
	`hog
();

88 
	`hog
();

89 
	`hog
();

90 
	`hog
();

91 
	`hog
();

92 
	`hog
();

94 
	`wa™®l
();

96 
	}
}

	@tail/tail.c

39 
	~<uni¡d.h
>

40 
	~<¡dlib.h
>

41 
	~<”r.h
>

43 
	#BUFSIZE
 1000

	)

48 
	gbufãr
[
BUFSIZE
];

52 
	$
(
fe
, 
off_t
 
wh”e
, cÚ¡ *
f’ame
)

54 
Ën
;

56 ià(
	`l£ek
(
fe
, 
wh”e
, 
SEEK_SET
)<0) {

57 
	`”r
(1, "%s", 
f’ame
);

60 (
Ën
 = 
	`»ad
(
fe
, 
bufãr
, (buffer))) > 0) {

61 
	`wr™e
(
STDOUT_FILENO
, 
bufãr
, 
Ën
);

63 
	}
}

66 
	$maš
(
¬gc
, **
¬gv
)

68 
fe
;

70 ià(
¬gc
 < 3) {

71 
	`”rx
(1, "Usage:ail <file> <location>");

73 
fe
 = 
	`İ’
(
¬gv
[1], 
O_RDONLY
);

74 ià(
fe
 < 0) {

75 
	`”r
(1, "%s", 
¬gv
[1]);

77 
	`
(
fe
, 
	`©oi
(
¬gv
[2]),‡rgv[1]);

78 
	`şo£
(
fe
);

80 
	}
}

	@tictac/tictac.c

41 
	~<¡dio.h
>

42 
	~<uni¡d.h
>

44 
	#NEWLINE
 012

	)

45 
	#EMPTY
 0

	)

46 
	#X_PLAYER
 1

	)

47 
	#O_PLAYER
 2

	)

48 
	#X_MARKER
 1

	)

49 
	#O_MARKER
 2

	)

50 
	#DIM
 3

	)

51 
	#DIMCHAR
 "2"

	)

52 
	#MAXSTRING
 100

	)

54 ’um { 
	mFALSE
, 
	mTRUE
 } 
	tboŞ
;

57 
boŞ
 
ask_ye¢o
(cÚ¡ *
msg
);

58 
boŞ
 
do_move
(
¶ay”
);

59 
š™Ÿlize_bßrd
();

60 
boŞ
 
is_wš
(
x
, 
y
);

61 
»ad_¡ršg
(*
buf
, 
Ëngth
);

62 
´št_bßrd
();

63 
´št_š¡ruùiÚs
();

64 
boŞ
 
wš_cŞumn
(
y
, 
m¬k”
);

65 
boŞ
 
wš_dŸg_Ëá
(
x
, 
y
, 
m¬k”
);

66 
boŞ
 
wš_dŸg_right
(
x
, 
y
, 
m¬k”
);

67 
boŞ
 
wš_row
(
x
, 
m¬k”
);

68 
boŞ
 
SŒcmp
(cÚ¡ *
a
, cÚ¡ *
b
);

74 
	gbßrd
[
DIM
][DIM];

79 
	$maš
()

81 
boŞ
 
wš
 = 
FALSE
;

82 
move
, 
max_moves
;

83 
¶ay”
;

85 
	`´št_š¡ruùiÚs
();

86 
max_moves
 = 
DIM
 * DIM;

88 
TRUE
) {

89 
	`š™Ÿlize_bßrd
();

90 
move
 = 1; mov<ğ
max_moves
; move++) {

91 
¶ay”
 = 
move
 % 2 == 0 ? 2 : 1;

92 
wš
 = 
	`do_move
(
¶ay”
);

93 
	`´št_bßrd
();

94 ià(
wš
) {

95 
	`´štf
("PÏy” %d, you WON!\n\n", 
¶ay”
);

103 ià(!
wš
)

104 
	`´štf
("Tie Game!\n\n");

105 ià(!
	`ask_ye¢o
("Do you wisho…lay‡gain?"))

109 
	}
}

122 
	$´št_š¡ruùiÚs
()

124 
	`´štf
("Welcomeoic-tac-toe!\n");

125 
	`´štf
("Player 1‡lways…lays X‡nd…layer 2‡lways…lay O\n");

126 
	`´štf
("Good†uck!\n\n\n");

127 
	}
}

140 
	$´št_bßrd
()

142 
i
, 
j
;

145 
	`´štf
("\n 0 1 2\n");

147 
i
 = 0; i < 
DIM
; i++) {

149 
	`´štf
(" %d ", 
i
);

150 
j
 = 0; j < 
DIM
; j++) {

151 
bßrd
[
i
][
j
]) {

152 
EMPTY
: 
	`´štf
(" "); ;

153 
X_MARKER
: 
	`´štf
(" X "); ;

154 
O_MARKER
: 
	`´štf
(" O "); ;

155 : 
	`´štf
("???"); ;

158 
	`´štf
("\n");

160 
	`´štf
("\n");

161 
	}
}

178 
boŞ


179 
	$ask_ye¢o
(cÚ¡ *
msg
)

181 
ªsw”
[
MAXSTRING
];

183 
TRUE
) {

184 
	`´štf
("% [yes/no] ", 
msg
);

185 ià(
	`»ad_¡ršg
(
ªsw”
, 
MAXSTRING
) < 0)

186 (
FALSE
);

187 ià(
	`SŒcmp
(
ªsw”
, "yes"))

188 (
TRUE
);

189 ià(
	`SŒcmp
(
ªsw”
, "no"))

190 (
FALSE
);

192 
	`´štf
("Please‡nswerƒither yes or‚o\n");

194 
	}
}

212 
boŞ


213 
	$do_move
(
¶ay”
)

215 
x
, 
y
;

216 
boŞ
 
fœ¡
;

217 
ªsw”
[
MAXSTRING
];

218 
cx
;

220 
fœ¡
 = 
TRUE
;

221 
	`´štf
("PÏy” %d (%c), you¸move\n", 
¶ay”
,

222 
¶ay”
 =ğ
X_PLAYER
 ? 'X' : 'O');

224 
TRUE
) {

225 
	`´štf
("Which„ow [0-%d]: ", 
DIM
-1);

226 ià(
	`»ad_¡ršg
(
ªsw”
, 
MAXSTRING
) < 0)

227 (
FALSE
);

228 
cx
 = 
ªsw”
[0];

229 
x
 = 
cx
 - '0';

230 ià(
x
 < 0 || x >ğ
DIM
) {

231 
	`´štf
("Inv®id„ow; mu¡ b>ğ0‡nd < %d\n", 
DIM
-1);

234 
	`´štf
("Which cŞumÀ[0-%d]: ", 
DIM
-1);

235 ià(
	`»ad_¡ršg
(
ªsw”
, 
MAXSTRING
) < 0)

236 (
FALSE
);

237 
cx
 = 
ªsw”
[0];

238 
y
 = 
cx
 - '0';

239 ià(
y
 < 0 || y >ğ
DIM
) {

240 
	`´štf
("Invalid column; must be >= 0‡nd < %d\n",

241 
DIM
-1);

245 ià(
bßrd
[
x
][
y
] !ğ
EMPTY
) {

246 
	`´štf
("That†ocation is occupied;…leasery‡gain\n");

247 
	`´št_bßrd
();

251 
bßrd
[
x
][
y
] = 
¶ay”
 =ğ
X_PLAYER
 ? 
X_MARKER
 : 
O_MARKER
;

253 (
	`is_wš
(
x
, 
y
));

255 
	}
}

279 
boŞ


280 
	$is_wš
(
x
, 
y
)

282 
m¬k”
;

284 
m¬k”
 = 
bßrd
[
x
][
y
];

292 (
	`wš_row
(
x
, 
m¬k”
è|| 
	`wš_cŞumn
(
y
, marker) ||

293 
	`wš_dŸg_Ëá
(
x
, 
y
, 
m¬k”
è|| 
	`wš_dŸg_right
(x, y, marker));

294 
	}
}

299 
boŞ


300 
	$wš_cŞumn
(
y
, 
m¬k”
)

302 
i
;

303 
i
 = 0; i < 
DIM
; i++)

304 ià(
bßrd
[
i
][
y
] !ğ
m¬k”
)

305 (
FALSE
);

306 (
TRUE
);

307 
	}
}

309 
boŞ


310 
	$wš_row
(
x
, 
m¬k”
)

312 
i
;

313 
i
 = 0; i < 
DIM
; i++)

314 ià(
bßrd
[
x
][
i
] !ğ
m¬k”
)

315 (
FALSE
);

316 (
TRUE
);

317 
	}
}

319 
boŞ


320 
	$wš_dŸg_Ëá
(
x
, 
y
, 
m¬k”
)

322 
i
;

325 ià(
x
 !ğ
y
)

326 (
FALSE
);

328 
i
 = 0; i < 
DIM
; i++)

329 ià(
bßrd
[
i
][i] !ğ
m¬k”
)

330 (
FALSE
);

331 (
TRUE
);

332 
	}
}

334 
boŞ


335 
	$wš_dŸg_right
(
x
, 
y
, 
m¬k”
)

337 
i
;

340 ià(
x
 + 
y
 !ğ
DIM
 - 1)

341 (
FALSE
);

342 
i
 = 0; i < 
DIM
; i++)

343 ià(
bßrd
[
i
][
DIM
 - 1 - i] !ğ
m¬k”
)

344 (
FALSE
);

345 (
TRUE
);

346 
	}
}

349 
	$š™Ÿlize_bßrd
()

351 
i
, 
j
;

353 
i
 = 0; i < 
DIM
; i++)

354 
j
 = 0; j < 
DIM
; j++)

355 
bßrd
[
i
][
j
] = 
EMPTY
;

356 
	}
}

359 
	$»ad_¡ršg
(*
buf
, 
Ëngth
)

361 
ch¬_»ad
;

362 
i
;

364 
i
 = 0;

365 (
ch¬_»ad
 = 
	`g‘ch¬
()è!ğ
EOF
 && ch¬_»ad !ğ
NEWLINE
 &&

366 
i
 < 
Ëngth
) {

367 
buf
[
i
] = (è
ch¬_»ad
;

368 
i
++;

369 
	`putch¬
(
ch¬_»ad
);

372 ià(
ch¬_»ad
 =ğ
EOF
)

379 ià(
i
 >ğ
Ëngth
)

380 
i
--;

381 
buf
[
i
] = 0;

382 (
i
);

383 
	}
}

385 
boŞ


386 
	$SŒcmp
(cÚ¡ *
a
, cÚ¡ *
b
)

388 ià(
a
 =ğ
NULL
)

389 (
b
 =ğ
NULL
);

390 ià(
b
 =ğ
NULL
)

391 (
FALSE
);

393 *
a
 && *
b
)

394 ià(*
a
++ !ğ*
b
++)

395 (
FALSE
);

397 (*
a
 =ğ*
b
);

399 
	}
}

	@triplehuge/triple.c

36 
	~<¡dio.h
>

37 
	~<uni¡d.h
>

38 
	~<”r.h
>

39 
	~"ŒË.h
"

42 
pid_t


43 
	$¥awnv
(cÚ¡ *
´og
, **
¬gv
)

45 
pid_t
 
pid
 = 
	`fÜk
();

46 
pid
) {

48 
	`”r
(1, "fork");

51 
	`execv
(
´og
, 
¬gv
);

52 
	`”r
(1, "%s:ƒxecv", 
´og
);

57  
pid
;

58 
	}
}

62 
	$dowa™
(
šdex
, 
pid
)

64 
¡©us
;

66 ià(
	`wa™pid
(
pid
, &
¡©us
, 0)<0) {

67 
	`w¬n
("wa™pid fÜ cİy #%d (pid %d)", 
šdex
, 
pid
);

70 ià(
	`WIFSIGNALED
(
¡©us
)) {

71 
	`w¬nx
("cİy #%d (pid %d): sigÇÈ%d", 
šdex
, 
pid
,

72 
	`WTERMSIG
(
¡©us
));

75 ià(
	`WEXITSTATUS
(
¡©us
) != 0) {

76 
	`w¬nx
("cİy #%d (pid %d):ƒx™ %d", 
šdex
, 
pid
,

77 
	`WEXITSTATUS
(
¡©us
));

81 
	}
}

84 
	$ŒË
(cÚ¡ *
´og
)

86 
pid_t
 
pids
[3];

87 
i
, 
çu»s
 = 0;

88 *
¬gs
[2];

91 
¬gs
[0]=(*)
´og
;

92 
¬gs
[1]=
NULL
;

94 
	`w¬nx
("S¹šg:„uÂšgh»cİ› oà%s...", 
´og
);

96 
i
=0; i<3; i++) {

97 
pids
[
i
]=
	`¥awnv
(
¬gs
[0],‡rgs);

100 
i
=0; i<3; i++) {

101 
çu»s
 +ğ
	`dowa™
(
i
, 
pids
[i]);

104 ià(
çu»s
 > 0) {

105 
	`w¬nx
("%d fau»s", 
çu»s
);

108 
	`w¬nx
("Congratulations! You…assed.");

110 
	}
}

	@triplehuge/triple.h

30 
ŒË
(cÚ¡ *
´og
);

	@triplehuge/triplehuge.c

38 
	~"ŒË.h
"

41 
	$maš
()

43 
	`ŒË
("/testbin/huge");

45 
	}
}

	@triplemat/triple.c

36 
	~<¡dio.h
>

37 
	~<uni¡d.h
>

38 
	~<”r.h
>

39 
	~"ŒË.h
"

42 
pid_t


43 
	$¥awnv
(cÚ¡ *
´og
, **
¬gv
)

45 
pid_t
 
pid
 = 
	`fÜk
();

46 
pid
) {

48 
	`”r
(1, "fork");

51 
	`execv
(
´og
, 
¬gv
);

52 
	`”r
(1, "%s:ƒxecv", 
´og
);

57  
pid
;

58 
	}
}

62 
	$dowa™
(
šdex
, 
pid
)

64 
¡©us
;

66 ià(
	`wa™pid
(
pid
, &
¡©us
, 0)<0) {

67 
	`w¬n
("wa™pid fÜ cİy #%d (pid %d)", 
šdex
, 
pid
);

70 ià(
	`WIFSIGNALED
(
¡©us
)) {

71 
	`w¬nx
("cİy #%d (pid %d): sigÇÈ%d", 
šdex
, 
pid
,

72 
	`WTERMSIG
(
¡©us
));

75 ià(
	`WEXITSTATUS
(
¡©us
) != 0) {

76 
	`w¬nx
("cİy #%d (pid %d):ƒx™ %d", 
šdex
, 
pid
,

77 
	`WEXITSTATUS
(
¡©us
));

81 
	}
}

84 
	$ŒË
(cÚ¡ *
´og
)

86 
pid_t
 
pids
[3];

87 
i
, 
çu»s
 = 0;

88 *
¬gs
[2];

91 
¬gs
[0]=(*)
´og
;

92 
¬gs
[1]=
NULL
;

94 
	`w¬nx
("S¹šg:„uÂšgh»cİ› oà%s...", 
´og
);

96 
i
=0; i<3; i++) {

97 
pids
[
i
]=
	`¥awnv
(
¬gs
[0],‡rgs);

100 
i
=0; i<3; i++) {

101 
çu»s
 +ğ
	`dowa™
(
i
, 
pids
[i]);

104 ià(
çu»s
 > 0) {

105 
	`w¬nx
("%d fau»s", 
çu»s
);

108 
	`w¬nx
("Congratulations! You…assed.");

110 
	}
}

	@triplemat/triple.h

30 
ŒË
(cÚ¡ *
´og
);

	@triplemat/triplemat.c

38 
	~"ŒË.h
"

41 
	$maš
()

43 
	`ŒË
("/testbin/matmult");

45 
	}
}

	@triplesort/triple.c

36 
	~<¡dio.h
>

37 
	~<uni¡d.h
>

38 
	~<”r.h
>

39 
	~"ŒË.h
"

42 
pid_t


43 
	$¥awnv
(cÚ¡ *
´og
, **
¬gv
)

45 
pid_t
 
pid
 = 
	`fÜk
();

46 
pid
) {

48 
	`”r
(1, "fork");

51 
	`execv
(
´og
, 
¬gv
);

52 
	`”r
(1, "%s:ƒxecv", 
´og
);

57  
pid
;

58 
	}
}

62 
	$dowa™
(
šdex
, 
pid
)

64 
¡©us
;

66 ià(
	`wa™pid
(
pid
, &
¡©us
, 0)<0) {

67 
	`w¬n
("wa™pid fÜ cİy #%d (pid %d)", 
šdex
, 
pid
);

70 ià(
	`WIFSIGNALED
(
¡©us
)) {

71 
	`w¬nx
("cİy #%d (pid %d): sigÇÈ%d", 
šdex
, 
pid
,

72 
	`WTERMSIG
(
¡©us
));

75 ià(
	`WEXITSTATUS
(
¡©us
) != 0) {

76 
	`w¬nx
("cİy #%d (pid %d):ƒx™ %d", 
šdex
, 
pid
,

77 
	`WEXITSTATUS
(
¡©us
));

81 
	}
}

84 
	$ŒË
(cÚ¡ *
´og
)

86 
pid_t
 
pids
[3];

87 
i
, 
çu»s
 = 0;

88 *
¬gs
[2];

91 
¬gs
[0]=(*)
´og
;

92 
¬gs
[1]=
NULL
;

94 
	`w¬nx
("S¹šg:„uÂšgh»cİ› oà%s...", 
´og
);

96 
i
=0; i<3; i++) {

97 
pids
[
i
]=
	`¥awnv
(
¬gs
[0],‡rgs);

100 
i
=0; i<3; i++) {

101 
çu»s
 +ğ
	`dowa™
(
i
, 
pids
[i]);

104 ià(
çu»s
 > 0) {

105 
	`w¬nx
("%d fau»s", 
çu»s
);

108 
	`w¬nx
("Congratulations! You…assed.");

110 
	}
}

	@triplesort/triple.h

30 
ŒË
(cÚ¡ *
´og
);

	@triplesort/triplesort.c

38 
	~"ŒË.h
"

41 
	$maš
()

43 
	`ŒË
("/testbin/sort");

45 
	}
}

	@userthreads/userthreads.c

52 
	~<uni¡d.h
>

53 
	~<¡dio.h
>

55 
	#NTHREADS
 3

	)

56 
	#MAX
 1<<25

	)

61 vŞ©
	gcouÁ
 = 0;

64 
Th»adRuÂ”
();

65 
BÏdeRuÂ”
();

68 
	$maš
(
¬gc
, *
¬gv
[])

70 
i
;

72 ()
¬gc
;

73 ()
¬gv
;

75 
i
=0; i<
NTHREADS
; i++) {

76 ià(
i
)

77 
	`th»adfÜk
(
Th»adRuÂ”
);

79 
	`th»adfÜk
(
BÏdeRuÂ”
);

82 
	`´štf
("Parent has†eft.\n");

84 
	}
}

92 
	$BÏdeRuÂ”
()

94 
couÁ
 < 
MAX
) {

95 ià(
couÁ
 % 500 == 0)

96 
	`´štf
("Blade ");

97 
couÁ
++;

99 
	}
}

102 
	$Th»adRuÂ”
()

104 
couÁ
 < 
MAX
) {

105 ià(
couÁ
 % 513 == 0)

106 
	`´štf
(" Runner\n");

107 
couÁ
++;

109 
	}
}

	@zero/zero.c

38 
	~<¡dio.h
>

39 
	~<uni¡d.h
>

40 
	~<”ºo.h
>

41 
	~<”r.h
>

47 
	gd©a_¡uff
[] = {

60 
	#SUM_OF_DATA_STUFF
 525

	)

66 
	gbss_¡uff
[3000];

70 
	$check_d©a
()

72 
i
, 
num
, 
k
;

74 
num
 = (
d©a_¡uff
) / (data_stuff[0]);

75 
k
=
i
=0; i<
num
; i++) {

76 
k
 +ğ
d©a_¡uff
[
i
];

78 ià(
k
 !ğ
SUM_OF_DATA_STUFF
) {

79 
	`w¬nx
("My initialized data sumsohe wrong value!");

80 
	`w¬nx
("GÙ: %u Ex³ùed: %u", 
k
, 
SUM_OF_DATA_STUFF
);

81 
	`”rx
(1, "FAILED");

83 
	}
}

87 
	$check_bss
()

89 
i
, 
num
;

91 
num
 = (
bss_¡uff
) / (bss_stuff[0]);

92 
i
=0; i<
num
; i++) {

93 ià(
bss_¡uff
[
i
] != 0) {

94 
	`w¬nx
("BSSƒntry‡t index %u (address %p)‚ot zero!",

95 
i
, &
bss_¡uff
[i]);

96 
	`w¬nx
("Found: 0x%x", 
bss_¡uff
[
i
]);

97 
	`”rx
(1, "FAILED");

100 
	}
}

104 
	$check_sbrk
()

106 *
ba£
;

107 
i
;

110 
	#SBRK_SIZE
 10000

	)

112 
ba£
 = 
	`sbrk
(
SBRK_SIZE
);

113 ià(
ba£
 == (*)-1) {

114 ià(
”ºo
 =ğ
EUNIMP
) {

115 
	`´štf
("I guess you haven't implemented sbrk yet.\n");

118 
	`”r
(1, "sbrk");

121 
i
=0; i<
SBRK_SIZE
; i++) {

122 ià(
ba£
[
i
] != 0) {

123 
	`w¬nx
("Byte‡t offset %u (address %p)‚ot zero",

124 
i
, &
ba£
[i]);

125 
	`w¬nx
("GÙ: 0x%x", ()
ba£
[
i
]);

126 
	`w¬nx
("Ba£ oàsbrk„egiÚ: %p", 
ba£
);

127 
	`”rx
(1, "FAILED");

130 
	}
}

134 
	$maš
()

136 
	`´štf
("zero:…hase 1: checking .bss\n");

137 
	`check_d©a
();

138 
	`check_bss
();

140 
	`´štf
("zero:…hase 2: checking sbrk()\n");

141 
	`check_sbrk
();

143 
	`´štf
("zero:…assed\n");

145 
	}
}

	@
1
.
0
82
1506
add/add.c
argtest/argtest.c
badcall/bad_chdir.c
badcall/bad_close.c
badcall/bad_dup2.c
badcall/bad_execv.c
badcall/bad_fsync.c
badcall/bad_ftruncate.c
badcall/bad_getcwd.c
badcall/bad_getdirentry.c
badcall/bad_ioctl.c
badcall/bad_link.c
badcall/bad_lseek.c
badcall/bad_mkdir.c
badcall/bad_open.c
badcall/bad_pipe.c
badcall/bad_read.c
badcall/bad_readlink.c
badcall/bad_reboot.c
badcall/bad_remove.c
badcall/bad_rename.c
badcall/bad_rmdir.c
badcall/bad_sbrk.c
badcall/bad_stat.c
badcall/bad_symlink.c
badcall/bad_time.c
badcall/bad_waitpid.c
badcall/bad_write.c
badcall/common_buf.c
badcall/common_fds.c
badcall/common_path.c
badcall/config.h
badcall/driver.c
badcall/test.h
bigfile/bigfile.c
conman/conman.c
crash/crash.c
ctest/ctest.c
dirconc/dirconc.c
dirseek/dirseek.c
dirtest/dirtest.c
f_test/f_hdr.h
f_test/f_read.c
f_test/f_test.c
f_test/f_write.c
farm/farm.c
faulter/faulter.c
filetest/filetest.c
forkbomb/forkbomb.c
forktest/forktest.c
guzzle/guzzle.c
hash/hash.c
hog/hog.c
huge/huge.c
kitchen/kitchen.c
malloctest/malloctest.c
matmult/matmult-orig.c
matmult/matmult.c
palin/palin.c
parallelvm/parallelvm.c
psort/psort.c
randcall/calls.c
randcall/extern.h
randcall/main.c
rmdirtest/rmdirtest.c
rmtest/rmtest.c
sink/sink.c
sort/sort.c
sty/sty.c
tail/tail.c
tictac/tictac.c
triplehuge/triple.c
triplehuge/triple.h
triplehuge/triplehuge.c
triplemat/triple.c
triplemat/triple.h
triplemat/triplemat.c
triplesort/triple.c
triplesort/triple.h
triplesort/triplesort.c
userthreads/userthreads.c
zero/zero.c
